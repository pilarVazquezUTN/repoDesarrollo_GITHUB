//[buscarHuesped/page.tsx]
'use client';

import React, { useState } from "react";
import { useRouter } from "next/navigation";
import axios from "axios";
import Link from "next/link";
import CartelNoEncontrado from "../carteles/huespedNoEncontrado";
import { esSoloLetras, esSoloNumeros, validarDNI } from "../validaciones/validaciones";
import { TipoHuesped } from "../tabla/page";

type SortKey = keyof TipoHuesped | "dni" | "tipoDocumento";

export default function BuscarHuesped() {
    const router = useRouter();
    
    // Estados del formulario
    const [apellido, setApellido] = useState("");
    const [nombre, setNombre] = useState("");
    const [tipoDoc, setTipoDoc] = useState("");
    const [numeroDoc, setNumeroDoc] = useState("");
    
    // Estados de resultados
    const [huespedes, setHuespedes] = useState<TipoHuesped[]>([]);
    const [huespedSeleccionado, setHuespedSeleccionado] = useState<TipoHuesped | null>(null);
    const [mostrarCartel, setMostrarCartel] = useState(false);
    
    // Estados de errores
    const [errorNombre, setErrorNombre] = useState(false);
    const [errorApellido, setErrorApellido] = useState(false);
    const [errorNumeroDoc, setErrorNumeroDoc] = useState(false);
    
    // Estado de ordenamiento
    const [sortConfig, setSortConfig] = useState<{ key: SortKey | null; direction: 'asc' | 'desc' }>({
        key: "apellido",
        direction: 'asc'
    });

    // Validaciones en tiempo real
    React.useEffect(() => {
        setErrorNombre(nombre !== "" && !esSoloLetras(nombre));
    }, [nombre]);

    React.useEffect(() => {
        setErrorApellido(apellido !== "" && !esSoloLetras(apellido));
    }, [apellido]);

    React.useEffect(() => {
        setErrorNumeroDoc(numeroDoc !== "" && (!esSoloNumeros(numeroDoc) || !validarDNI(numeroDoc)));
    }, [numeroDoc]);

    // Funci√≥n de b√∫squeda
    const buscarHuesped = async (e: React.FormEvent) => {
        e.preventDefault();

        // Validaciones
        const nombreInvalido = nombre !== "" && !esSoloLetras(nombre);
        const apellidoInvalido = apellido !== "" && !esSoloLetras(apellido);
        const numeroDocInvalido = numeroDoc !== "" && (!esSoloNumeros(numeroDoc) || !validarDNI(numeroDoc));

        setErrorNombre(nombreInvalido);
        setErrorApellido(apellidoInvalido);
        setErrorNumeroDoc(numeroDocInvalido);

        if (nombreInvalido || apellidoInvalido || numeroDocInvalido) {
            return;
        }

        try {
            // Construir par√°metros - siempre enviar todos, incluso si est√°n vac√≠os
            // Ejemplo: http://localhost:8080/huespedes?nombre=&apellido=M&tipoDocumento&dni=
            const params: any = {
                apellido: apellido || "",
                nombre: nombre || "",
                tipoDocumento: tipoDoc || "",
                dni: numeroDoc || ""
            };

            const response = await axios.get("http://localhost:8080/huespedes", {
                params
            });

            setHuespedes(response.data || []);
            setHuespedSeleccionado(null);

            if (!response.data || response.data.length === 0) {
                setMostrarCartel(true);
            }
        } catch (error) {
            console.error("Error al buscar hu√©spedes:", error);
            setHuespedes([]);
            setMostrarCartel(true);
        }
    };

    // Funci√≥n de ordenamiento
    const handleSort = (key: SortKey) => {
        let direction: 'asc' | 'desc' = 'asc';
        if (sortConfig.key === key && sortConfig.direction === 'asc') {
            direction = 'desc';
        }
        setSortConfig({ key, direction });
    };

    // Hu√©spedes ordenados
    const sortedHuespedes = [...huespedes].sort((a, b) => {
        if (!sortConfig.key) return 0;

        const key = sortConfig.key;
        let aValue: any;
        let bValue: any;

        if (key === "dni") {
            aValue = a.huespedID.dni;
            bValue = b.huespedID.dni;
        } else if (key === "tipoDocumento") {
            aValue = a.huespedID.tipoDocumento;
            bValue = b.huespedID.tipoDocumento;
        } else {
            aValue = a[key];
            bValue = b[key];
        }

        if (aValue < bValue) return sortConfig.direction === "asc" ? -1 : 1;
        if (aValue > bValue) return sortConfig.direction === "asc" ? 1 : -1;
        return 0;
    });

    // Seleccionar hu√©sped
    const setSeleccionado = (huesped: TipoHuesped) => {
        setHuespedSeleccionado(huesped);
    };

    // Navegaci√≥n seg√∫n el caso de uso
    const handleSiguiente = () => {
        // Si no hay selecci√≥n o no hay resultados, ir a Dar Alta (CU11)
        if (huespedSeleccionado === null || huespedes.length === 0) {
            router.push("/darAltaHuesped");
            return;
        }

        // Si hay selecci√≥n, guardar en sessionStorage y ir a Modificar (CU10)
        if (huespedSeleccionado) {
            sessionStorage.setItem('huespedSeleccionado', JSON.stringify(huespedSeleccionado));
            router.push("/modificarHuesped");
        }
    };

    // Manejar Enter en botones
    const handleKeyDown = (e: React.KeyboardEvent, action: () => void) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            action();
        }
    };

    // Manejar Shift+Tab para retroceder
    const handleKeyDownInput = (e: React.KeyboardEvent<HTMLInputElement | HTMLSelectElement>) => {
        if (e.key === "Tab" && e.shiftKey) {
            e.preventDefault();
            const form = e.currentTarget.form;
            if (form) {
                const inputs = Array.from(form.querySelectorAll("input, select"));
                const index = inputs.indexOf(e.currentTarget);
                if (index > 0) {
                    (inputs[index - 1] as HTMLElement).focus();
                }
            }
        }
    };

    return (
        <main className="flex gap-8 px-8 py-8 items-start bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
            {/* FORMULARIO DE B√öSQUEDA */}
            <div className="bg-white rounded-xl shadow-lg p-6 w-80 h-fit sticky top-4">
                <h2 className="text-2xl font-bold text-indigo-950 mb-6 pb-3 border-b-2 border-indigo-200">
                    Criterios de B√∫squeda
                </h2>
                <form onSubmit={buscarHuesped} className="flex flex-col space-y-4">
                    <div>
                        <label className="text-indigo-950 font-semibold mb-2 block text-sm">Apellido:</label>
                        <input
                            type="text"
                            value={apellido}
                            onChange={(e) => setApellido(e.target.value.toUpperCase())}
                            onKeyDown={handleKeyDownInput}
                            className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                                errorApellido
                                    ? "border-red-500 bg-red-50"
                                    : "border-gray-300 hover:border-indigo-400"
                            }`}
                            placeholder="Ingrese el apellido"
                        />
                        {errorApellido && (
                            <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                                <span>‚ö†</span> Ingrese solo letras.
                            </p>
                        )}
                    </div>

                    <div>
                        <label className="text-indigo-950 font-semibold mb-2 block text-sm">Nombres:</label>
                        <input
                            type="text"
                            value={nombre}
                            onChange={(e) => setNombre(e.target.value.toUpperCase())}
                            onKeyDown={handleKeyDownInput}
                            className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                                errorNombre
                                    ? "border-red-500 bg-red-50"
                                    : "border-gray-300 hover:border-indigo-400"
                            }`}
                            placeholder="Ingrese el nombre"
                        />
                        {errorNombre && (
                            <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                                <span>‚ö†</span> Ingrese solo letras.
                            </p>
                        )}
                    </div>

                    <div>
                        <label className="text-indigo-950 font-semibold mb-2 block text-sm">Tipo de Documento:</label>
                        <select
                            value={tipoDoc}
                            onChange={(e) => setTipoDoc(e.target.value)}
                            onKeyDown={handleKeyDownInput}
                            className="w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent border-gray-300 hover:border-indigo-400 bg-white"
                        >
                            <option value="">Seleccionar tipo</option>
                            <option value="DNI">DNI</option>
                            <option value="LE">LE</option>
                            <option value="LC">LC</option>
                            <option value="PASAPORTE">Pasaporte</option>
                            <option value="OTRO">Otro</option>
                        </select>
                    </div>

                    <div>
                        <label className="text-indigo-950 font-semibold mb-2 block text-sm">N√∫mero de Documento:</label>
                        <input
                            type="text"
                            value={numeroDoc}
                            onChange={(e) => setNumeroDoc(e.target.value)}
                            onKeyDown={handleKeyDownInput}
                            className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                                errorNumeroDoc
                                    ? "border-red-500 bg-red-50"
                                    : "border-gray-300 hover:border-indigo-400"
                            }`}
                            placeholder="Ingrese el n√∫mero"
                        />
                        {errorNumeroDoc && (
                            <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                                <span>‚ö†</span> Ingrese un DNI v√°lido.
                            </p>
                        )}
                    </div>

                    <button
                        type="submit"
                        onKeyDown={(e) => handleKeyDown(e, buscarHuesped)}
                        className="w-full px-6 py-3 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105"
                    >
                        Buscar
                    </button>
                </form>
            </div>

            {/* TABLA DE RESULTADOS */}
            <section className="flex-1">
                <div className="bg-white rounded-xl shadow-xl overflow-hidden">
                    <div className="p-6 border-b-2 border-indigo-200">
                        <h2 className="text-2xl font-bold text-indigo-950">
                            Resultados de B√∫squeda
                        </h2>
                        <p className="text-sm text-gray-600 mt-1">
                            {huespedes.length > 0 
                                ? `${huespedes.length} hu√©sped(es) encontrado(s)` 
                                : "No hay resultados para mostrar"}
                        </p>
                    </div>

                    {huespedes.length > 0 ? (
                        <div className="max-h-[600px] overflow-y-auto overflow-x-auto">
                            <table className="w-full border-collapse">
                                <thead className="bg-gradient-to-r from-indigo-950 to-indigo-900 text-white sticky top-0 z-10 shadow-md">
                                    <tr>
                                        <th className="p-4 font-semibold text-left">Seleccionar</th>
                                        <th 
                                            className="p-4 font-semibold text-left cursor-pointer hover:bg-indigo-800 transition-colors"
                                            onClick={() => handleSort("apellido")}
                                        >
                                            Apellido {sortConfig.key === "apellido" ? (sortConfig.direction === "asc" ? "‚Üë" : "‚Üì") : "‚Üë‚Üì"}
                                        </th>
                                        <th 
                                            className="p-4 font-semibold text-left cursor-pointer hover:bg-indigo-800 transition-colors"
                                            onClick={() => handleSort("nombre")}
                                        >
                                            Nombre {sortConfig.key === "nombre" ? (sortConfig.direction === "asc" ? "‚Üë" : "‚Üì") : "‚Üë‚Üì"}
                                        </th>
                                        <th 
                                            className="p-4 font-semibold text-left cursor-pointer hover:bg-indigo-800 transition-colors"
                                            onClick={() => handleSort("tipoDocumento")}
                                        >
                                            Tipo Documento {sortConfig.key === "tipoDocumento" ? (sortConfig.direction === "asc" ? "‚Üë" : "‚Üì") : "‚Üë‚Üì"}
                                        </th>
                                        <th 
                                            className="p-4 font-semibold text-left cursor-pointer hover:bg-indigo-800 transition-colors"
                                            onClick={() => handleSort("dni")}
                                        >
                                            N√∫mero Documento {sortConfig.key === "dni" ? (sortConfig.direction === "asc" ? "‚Üë" : "‚Üì") : "‚Üë‚Üì"}
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {sortedHuespedes.map((h) => {
                                        const isSelected = huespedSeleccionado?.huespedID.dni === h.huespedID.dni && 
                                                          huespedSeleccionado?.huespedID.tipoDocumento === h.huespedID.tipoDocumento;
                                        return (
                                            <tr
                                                key={`${h.huespedID.tipoDocumento}-${h.huespedID.dni}`}
                                                className={`hover:bg-indigo-50 transition-colors ${
                                                    isSelected ? "bg-indigo-100" : "bg-white"
                                                }`}
                                            >
                                                <td className="p-4 border-b border-gray-200 text-center">
                                                    <input
                                                        type="radio"
                                                        name="seleccion"
                                                        checked={isSelected}
                                                        onChange={() => setSeleccionado(h)}
                                                        className="w-4 h-4 text-indigo-950 focus:ring-indigo-500"
                                                    />
                                                </td>
                                                <td className="p-4 border-b border-gray-200 font-medium text-indigo-950">
                                                    {h.apellido}
                                                </td>
                                                <td className="p-4 border-b border-gray-200 text-gray-700">
                                                    {h.nombre}
                                                </td>
                                                <td className="p-4 border-b border-gray-200 text-gray-700">
                                                    {h.huespedID.tipoDocumento}
                                                </td>
                                                <td className="p-4 border-b border-gray-200 text-gray-700">
                                                    {h.huespedID.dni}
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>
                    ) : (
                        <div className="p-12 text-center">
                            <div className="text-gray-400 text-lg mb-2">
                                üîç Complete los criterios de b√∫squeda y presione "Buscar"
                            </div>
                            <p className="text-sm text-gray-500">
                                Puede ingresar ninguno, uno o varios criterios de b√∫squeda
                            </p>
                        </div>
                    )}
                </div>

                {/* BOTONES DE ACCI√ìN */}
                <div className="flex justify-center gap-4 mt-6">
                    <Link href="/menu">
                        <button
                            onKeyDown={(e) => handleKeyDown(e, () => router.push("/menu"))}
                            className="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all shadow-md hover:shadow-lg font-semibold"
                        >
                            Cancelar
                        </button>
                    </Link>

                    <button
                        onClick={handleSiguiente}
                        onKeyDown={(e) => handleKeyDown(e, handleSiguiente)}
                        className="px-6 py-3 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105"
                    >
                        Siguiente
                    </button>
                </div>
            </section>

            {/* CARTEL DE NO ENCONTRADO */}
            {mostrarCartel && (
                <CartelNoEncontrado onClose={() => setMostrarCartel(false)} />
            )}
        </main>
    );
}
//[cancelarReserva/page.tsx]
'use client';

import React, { useState, useEffect } from "react";
import { useRouter } from "next/navigation";
import axios from "axios";
import Link from "next/link";
import { format, parseISO } from "date-fns";
import { esSoloLetras, esObligatorio } from "../validaciones/validaciones";
import ReservaCancelada from "../carteles/reservaCancelada";

interface ReservaDTO {
  id_reserva: number;
  fecha_desde: string;
  fecha_hasta: string;
  estado: string;
  nombre: string;
  apellido: string;
  telefono: string;
  habitacion: {
    numero: number;
    estado: string;
    precio: number;
    cantidadPersonas: number;
    tipohabitacion: string;
  };
}

export default function CancelarReserva() {
  const router = useRouter();
  
  // Estados del formulario
  const [apellido, setApellido] = useState("");
  const [nombre, setNombre] = useState("");
  
  // Estados de resultados
  const [reservas, setReservas] = useState<ReservaDTO[]>([]);
  const [reservasSeleccionadas, setReservasSeleccionadas] = useState<number[]>([]);
  const [mostrarCartel, setMostrarCartel] = useState(false);
  const [mostrarModalConfirmacion, setMostrarModalConfirmacion] = useState(false);
  const [mostrarCartelCancelacion, setMostrarCartelCancelacion] = useState(false);
  const [mostrarCartelError, setMostrarCartelError] = useState(false);
  const [mensajeError, setMensajeError] = useState("");
  const [cantidadCanceladas, setCantidadCanceladas] = useState(1);
  const [buscando, setBuscando] = useState(false);
  const [cancelando, setCancelando] = useState(false);
  
  // Estados de errores
  const [errorNombre, setErrorNombre] = useState(false);
  const [errorApellido, setErrorApellido] = useState(false);
  const [errorApellidoObligatorio, setErrorApellidoObligatorio] = useState(false);

  // Validaciones en tiempo real
  useEffect(() => {
    setErrorNombre(nombre !== "" && !esSoloLetras(nombre));
  }, [nombre]);

  useEffect(() => {
    setErrorApellido(apellido !== "" && !esSoloLetras(apellido));
  }, [apellido]);

  useEffect(() => {
    setErrorApellidoObligatorio(false);
  }, [apellido]);

  // Funci√≥n de b√∫squeda
  const buscarReservas = async (e: React.FormEvent) => {
    e.preventDefault();

    // Validar apellido obligatorio
    const apellidoVacio = !esObligatorio(apellido);
    setErrorApellidoObligatorio(apellidoVacio);
    
    if (apellidoVacio) {
      const inputApellido = document.querySelector('input[placeholder*="apellido"]') as HTMLInputElement;
      if (inputApellido) {
        inputApellido.focus();
      }
      return;
    }

    // Validaciones de formato
    const nombreInvalido = nombre !== "" && !esSoloLetras(nombre);
    const apellidoInvalido = !esSoloLetras(apellido);

    setErrorNombre(nombreInvalido);
    setErrorApellido(apellidoInvalido);

    if (nombreInvalido || apellidoInvalido) {
      return;
    }

    setBuscando(true);
    try {
      const params: any = {
        apellido: apellido || "",
        nombre: nombre || ""
      };

      const response = await axios.get("http://localhost:8080/reservas/buscar", {
        params
      });

      const reservasData = response.data || [];
      
      // Filtrar solo reservas en estado PENDIENTE (puede venir como "Pendiente" o "PENDIENTE")
      const reservasPendientes = reservasData.filter((r: ReservaDTO) => 
        r.estado?.toUpperCase() === "PENDIENTE"
      );
      
      setReservas(reservasPendientes);
      setReservasSeleccionadas([]);

      if (reservasPendientes.length === 0) {
        setMostrarCartel(true);
      }
    } catch (error) {
      console.error("Error al buscar reservas:", error);
      setReservas([]);
      setMostrarCartel(true);
    } finally {
      setBuscando(false);
    }
  };

  // Toggle selecci√≥n de reserva
  const toggleSeleccionReserva = (idReserva: number) => {
    setReservasSeleccionadas((prev) => {
      if (prev.includes(idReserva)) {
        return prev.filter((id) => id !== idReserva);
      } else {
        return [...prev, idReserva];
      }
    });
  };

  // Funci√≥n para mostrar modal de confirmaci√≥n
  const mostrarConfirmacionCancelacion = () => {
    if (reservasSeleccionadas.length === 0) {
      return;
    }
    setMostrarModalConfirmacion(true);
  };

  // Funci√≥n para cancelar reservas
  const cancelarReservas = async () => {
    if (reservasSeleccionadas.length === 0) {
      return;
    }

    setMostrarModalConfirmacion(false);
    setCancelando(true);
    
    try {
      // Cancelar todas las reservas seleccionadas una por una para capturar errores espec√≠ficos
      const reservasACancelar = [...reservasSeleccionadas];
      const reservasCanceladasExitosas: number[] = [];
      
      for (const idReserva of reservasACancelar) {
        try {
          const dto = {
            id_reserva: idReserva
          };
          
          await axios.put("http://localhost:8080/reservas/cancelar", dto, {
            headers: {
              "Content-Type": "application/json"
            }
          });
          
          reservasCanceladasExitosas.push(idReserva);
        } catch (error: any) {
          // Si es un error 400, extraer el mensaje del backend
          if (error.response && error.response.status === 400) {
            let mensajeError = "";
            
            // Intentar extraer el mensaje de diferentes formatos posibles
            if (typeof error.response.data === 'string') {
              mensajeError = error.response.data;
            } else if (error.response.data?.message) {
              mensajeError = error.response.data.message;
            } else if (error.response.data?.error) {
              mensajeError = error.response.data.error;
            } else {
              // Si no hay mensaje, construir uno con el estado de la reserva
              const reservaFallida = reservas.find(r => r.id_reserva === idReserva);
              const estado = reservaFallida?.estado || "DESCONOCIDO";
              mensajeError = `Solo se pueden cancelar reservas en estado PENDIENTE. La reserva actual est√° en estado: ${estado}`;
            }
            
            // Si el mensaje no menciona el estado, agregarlo
            if (!mensajeError.includes("estado") && !mensajeError.includes("PENDIENTE")) {
              const reservaFallida = reservas.find(r => r.id_reserva === idReserva);
              const estado = reservaFallida?.estado || "DESCONOCIDO";
              mensajeError = `Solo se pueden cancelar reservas en estado PENDIENTE. La reserva actual est√° en estado: ${estado}`;
            }
            
            setMensajeError(mensajeError);
            setMostrarCartelError(true);
            setCancelando(false);
            return;
          }
          
          // Si es otro tipo de error, lanzarlo para que se capture en el catch externo
          throw error;
        }
      }

      // Si todas las cancelaciones fueron exitosas
      if (reservasCanceladasExitosas.length > 0) {
        const cantidad = reservasCanceladasExitosas.length;
        setCantidadCanceladas(cantidad);

        // Eliminar las reservas canceladas de la lista
        setReservas((prev) => prev.filter((r) => !reservasCanceladasExitosas.includes(r.id_reserva)));
        setReservasSeleccionadas([]);
        setMostrarCartelCancelacion(true);
      }
    } catch (error: any) {
      console.error("Error al cancelar reservas:", error);
      
      // Si es un error 400, ya fue manejado arriba
      if (error.response && error.response.status === 400) {
        return;
      }
      
      // Para otros errores, mostrar mensaje gen√©rico
      setMensajeError("Hubo un error al cancelar las reservas.");
      setMostrarCartelError(true);
    } finally {
      setCancelando(false);
    }
  };

  // Formatear fecha
  const formatearFecha = (fecha: string) => {
    try {
      return format(parseISO(fecha), "dd/MM/yyyy");
    } catch {
      return fecha;
    }
  };

  // Manejar Enter en botones
  const handleKeyDown = (e: React.KeyboardEvent, action: () => void) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      action();
    }
  };

  // Manejar Shift+Tab para retroceder
  const handleKeyDownInput = (e: React.KeyboardEvent<HTMLInputElement>) => {
    if (e.key === "Tab" && e.shiftKey) {
      e.preventDefault();
      const form = e.currentTarget.form;
      if (form) {
        const inputs = Array.from(form.querySelectorAll("input"));
        const index = inputs.indexOf(e.currentTarget);
        if (index > 0) {
          (inputs[index - 1] as HTMLElement).focus();
        }
      }
    }
  };

  return (
    <main className="flex gap-8 px-8 py-8 items-start bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
      {/* FORMULARIO DE B√öSQUEDA */}
      <div className="bg-white rounded-xl shadow-lg p-6 w-80 h-fit sticky top-4">
        <h2 className="text-2xl font-bold text-indigo-950 mb-6 pb-3 border-b-2 border-indigo-200">
          Criterios de B√∫squeda
        </h2>
        <form onSubmit={buscarReservas} className="flex flex-col space-y-4">
          <div>
            <label className="text-indigo-950 font-semibold mb-2 block text-sm">Apellido:</label>
            <input
              type="text"
              value={apellido}
              onChange={(e) => {
                const valor = e.target.value.toUpperCase();
                setApellido(valor);
                setErrorApellidoObligatorio(false);
              }}
              onKeyDown={handleKeyDownInput}
              className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                errorApellido || errorApellidoObligatorio
                  ? "border-red-500 bg-red-50"
                  : "border-gray-300 hover:border-indigo-400"
              }`}
              placeholder="Ingrese el apellido"
            />
            {errorApellido && (
              <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                <span>‚ö†</span> Ingrese solo letras.
              </p>
            )}
            {errorApellidoObligatorio && (
              <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                <span>‚ö†</span> El campo apellido no puede estar vac√≠o.
              </p>
            )}
          </div>

          <div>
            <label className="text-indigo-950 font-semibold mb-2 block text-sm">Nombre:</label>
            <input
              type="text"
              value={nombre}
              onChange={(e) => setNombre(e.target.value.toUpperCase())}
              onKeyDown={handleKeyDownInput}
              className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                errorNombre
                  ? "border-red-500 bg-red-50"
                  : "border-gray-300 hover:border-indigo-400"
              }`}
              placeholder="Ingrese el nombre"
            />
            {errorNombre && (
              <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                <span>‚ö†</span> Ingrese solo letras.
              </p>
            )}
          </div>

          <button
            type="submit"
            disabled={buscando}
            onKeyDown={(e) => handleKeyDown(e, buscarReservas)}
            className={`w-full px-6 py-3 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105 ${
              buscando ? "opacity-50 cursor-not-allowed" : ""
            }`}
          >
            {buscando ? "Buscando..." : "Buscar"}
          </button>
        </form>
      </div>

      {/* TABLA DE RESULTADOS */}
      <section className="flex-1">
        <div className="bg-white rounded-xl shadow-xl overflow-hidden">
          <div className="p-6 border-b-2 border-indigo-200">
            <h2 className="text-2xl font-bold text-indigo-950">
              Reservas Pendientes
            </h2>
            <p className="text-sm text-gray-600 mt-1">
              {reservas.length > 0 
                ? `${reservas.length} reserva(s) pendiente(s) encontrada(s)` 
                : "No hay resultados para mostrar"}
            </p>
            <p className="text-xs text-gray-500 mt-1">
              Solo se pueden cancelar reservas en estado PENDIENTE
            </p>
          </div>

          {reservas.length > 0 ? (
            <div className="max-h-[600px] overflow-y-auto overflow-x-auto">
              <table className="w-full border-collapse">
                <thead className="bg-gradient-to-r from-indigo-950 to-indigo-900 text-white sticky top-0 z-10 shadow-md">
                  <tr>
                    <th className="p-4 font-semibold text-left">Seleccionar</th>
                    <th className="p-4 font-semibold text-left">ID Reserva</th>
                    <th className="p-4 font-semibold text-left">Apellido</th>
                    <th className="p-4 font-semibold text-left">Nombre</th>
                    <th className="p-4 font-semibold text-left">Tel√©fono</th>
                    <th className="p-4 font-semibold text-left">Habitaci√≥n</th>
                    <th className="p-4 font-semibold text-left">Tipo</th>
                    <th className="p-4 font-semibold text-left">Desde</th>
                    <th className="p-4 font-semibold text-left">Hasta</th>
                    <th className="p-4 font-semibold text-left">Estado</th>
                  </tr>
                </thead>
                <tbody>
                  {reservas.map((r) => {
                    const isSelected = reservasSeleccionadas.includes(r.id_reserva);
                    return (
                      <tr
                        key={r.id_reserva}
                        className={`hover:bg-indigo-50 transition-colors ${
                          isSelected ? "bg-indigo-100" : "bg-white"
                        }`}
                      >
                        <td className="p-4 border-b border-gray-200 text-center">
                          <input
                            type="checkbox"
                            checked={isSelected}
                            onChange={() => toggleSeleccionReserva(r.id_reserva)}
                            className="w-4 h-4 text-indigo-950 focus:ring-indigo-500"
                          />
                        </td>
                        <td className="p-4 border-b border-gray-200 font-medium text-indigo-950">
                          {r.id_reserva}
                        </td>
                        <td className="p-4 border-b border-gray-200 text-gray-700">
                          {r.apellido}
                        </td>
                        <td className="p-4 border-b border-gray-200 text-gray-700">
                          {r.nombre}
                        </td>
                        <td className="p-4 border-b border-gray-200 text-gray-700">
                          {r.telefono}
                        </td>
                        <td className="p-4 border-b border-gray-200 text-gray-700 font-semibold">
                          {r.habitacion?.numero || "N/A"}
                        </td>
                        <td className="p-4 border-b border-gray-200 text-gray-700">
                          {r.habitacion?.tipohabitacion || "N/A"}
                        </td>
                        <td className="p-4 border-b border-gray-200 text-gray-700">
                          {formatearFecha(r.fecha_desde)}
                        </td>
                        <td className="p-4 border-b border-gray-200 text-gray-700">
                          {formatearFecha(r.fecha_hasta)}
                        </td>
                        <td className="p-4 border-b border-gray-200">
                          <span className="px-2 py-1 rounded-full text-xs font-semibold bg-yellow-100 text-yellow-800">
                            {r.estado}
                          </span>
                        </td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
          ) : (
            <div className="p-12 text-center">
              <div className="text-gray-400 text-lg mb-2">
                üîç Complete los criterios de b√∫squeda y presione "Buscar"
              </div>
              <p className="text-sm text-gray-500">
                Ingrese el apellido para buscar reservas pendientes
              </p>
            </div>
          )}
        </div>

        {/* BOTONES DE ACCI√ìN */}
        <div className="flex justify-center gap-4 mt-6">
          <Link href="/menu">
            <button
              onKeyDown={(e) => handleKeyDown(e, () => router.push("/menu"))}
              className="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all shadow-md hover:shadow-lg font-semibold"
            >
              Cancelar
            </button>
          </Link>

          <button
            onClick={mostrarConfirmacionCancelacion}
            disabled={reservasSeleccionadas.length === 0 || cancelando}
            onKeyDown={(e) => handleKeyDown(e, mostrarConfirmacionCancelacion)}
            className={`px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-lg hover:from-red-700 hover:to-red-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105 ${
              reservasSeleccionadas.length === 0 || cancelando ? "opacity-50 cursor-not-allowed" : ""
            }`}
          >
            {cancelando ? "Cancelando..." : "Aceptar"}
          </button>
        </div>
      </section>

      {/* CARTEL DE NO ENCONTRADO */}
      {mostrarCartel && (
        <div className="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-[9999]">
          <div className="relative bg-white rounded-xl shadow-xl p-8 w-auto min-w-[400px]">
            <img
              src="/imagenError.png"
              alt="Error"
              className="absolute top-4 left-4 w-12 h-12"
            />
            <button
              className="absolute top-4 right-4 text-gray-700 hover:text-black text-xl font-bold"
              onClick={() => setMostrarCartel(false)}
            >
              ‚úï
            </button>
            <h2 className="text-xl font-bold text-red-700 text-center mb-4 mt-8">
              No existen reservas para los criterios de b√∫squeda
            </h2>
            <div className="flex justify-center mt-6">
              <button
                onClick={() => {
                  setMostrarCartel(false);
                  const inputApellido = document.querySelector('input[placeholder*="apellido"]') as HTMLInputElement;
                  if (inputApellido) {
                    inputApellido.focus();
                  }
                }}
                className="px-6 py-2 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
              >
                Aceptar
              </button>
            </div>
          </div>
        </div>
      )}

      {/* MODAL DE CONFIRMACI√ìN */}
      {mostrarModalConfirmacion && (
        <div className="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-[9999]">
          <div className="relative bg-white rounded-xl shadow-xl p-8 w-auto min-w-[400px]">
            <img
              src="/imagenInformacion.png"
              alt="Info"
              className="absolute top-4 left-4 w-12 h-12"
            />
            <h2 className="text-xl font-bold text-indigo-950 text-center mb-4 mt-8">
              Confirmar Cancelaci√≥n
            </h2>
            <p className="text-gray-700 text-center mb-6">
              ¬øEst√° seguro que desea cancelar {reservasSeleccionadas.length} reserva(s) seleccionada(s)?
            </p>
            <div className="flex justify-center gap-4 mt-6">
              <button
                onClick={() => {
                  setMostrarModalConfirmacion(false);
                }}
                className="px-6 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 transition"
              >
                CANCELAR
              </button>
              <button
                onClick={cancelarReservas}
                className="px-6 py-2 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
              >
                ACEPTAR
              </button>
            </div>
          </div>
        </div>
      )}

      {/* CARTEL DE ERROR DE CANCELACI√ìN */}
      {mostrarCartelError && (
        <div className="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-[9999]">
          <div className="relative bg-white rounded-xl shadow-xl p-8 w-auto min-w-[500px] max-w-[600px]">
            <img
              src="/imagenError.png"
              alt="Error"
              className="absolute top-4 left-4 w-12 h-12"
            />
            <button
              className="absolute top-4 right-4 text-gray-700 hover:text-black text-xl font-bold"
              onClick={() => setMostrarCartelError(false)}
            >
              ‚úï
            </button>
            <h2 className="text-xl font-bold text-red-700 text-center mb-4 mt-8">
              Error al cancelar reserva
            </h2>
            <p className="text-gray-700 text-center mb-6 whitespace-pre-line">
              {mensajeError}
            </p>
            <div className="flex justify-center mt-6">
              <button
                onClick={() => {
                  setMostrarCartelError(false);
                  setMensajeError("");
                }}
                className="px-6 py-2 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
              >
                Aceptar
              </button>
            </div>
          </div>
        </div>
      )}

      {/* CARTEL DE RESERVA CANCELADA */}
      {mostrarCartelCancelacion && (
        <ReservaCancelada 
          cantidad={cantidadCanceladas}
          onClose={() => {
            setMostrarCartelCancelacion(false);
          }} 
        />
      )}
    </main>
  );
}
//[carteles/cancelarAltaHuesped.tsx]
"use client";

import Link from "next/link";

type Props = {
  onClose: () => void;
};

export default function CancelarAltaHuepsed({ onClose }: Props) {
  return (
    <div className="fixed inset-0 flex items-center justify-center z-50">

      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL MODAL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140"> 

        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img src="/imagenAdvertencia.png"  alt="Advertencia" className="absolute top-3 left-3 w-10 h-10" />

        <h2 className="text-xl font-bold text-center mb-4 text-indigo-950">
          ¬øDesea cancelar el alta del huesped?
        </h2>

        {/* Botones SI / NO */}
        <div className="mt-6 justify-center sticky bottom-0 flex gap-4">
          <nav>
            <Link href="/menu">
              <button
                type="button"
                className="px-7 py-1 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
                onClick={onClose}
              >
                SI
              </button>
            </Link>
          </nav>

          <button
            type="button"
            className="px-7 py-1 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
            onClick={onClose}
          >
            NO
          </button>
        </div>
      </div>
    </div>
  );
}
//[carteles/cancelarModificacion.tsx]
"use client";
import Link from "next/link";

type Props = {
  onSi: () => void;
  onNo: () => void;
};

export default function CancelarModificacion({ onSi, onNo }: Props) {
  return (
    <div className="fixed inset-0 z-[9999] flex items-center justify-center">
      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL CARTEL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140 text-center">
        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img src="/imagenAdvertencia.png" alt="Advertencia" className="absolute top-3 left-3 w-10 h-10" />

        <div className="pl-10">
          <h2 className="text-xl font-bold text-center mb-4 text-indigo-950">
            ¬øDesea cancelar la modificaci√≥n del hu√©sped?
          </h2>
        </div>

        {/* BOTONES SI / NO */}
        <div className="mt-6 flex justify-center gap-4">
          <Link href="/menu">
            <button
              type="button"
              className="px-6 py-2 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold"
              onClick={onSi}
            >
              Si
            </button>
          </Link>

          <button
            type="button"
            className="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all shadow-md hover:shadow-lg font-semibold"
            onClick={onNo}
          >
            No
          </button>
        </div>
      </div>
    </div>
  );
}
//[carteles/cartelHabitacionesOcupadas.tsx]
"use client";

import React from "react";

interface Props {
  lista: string[];
  seleccionados?: string[];
  desdeFecha: string;
  hastaFecha: string;
  onClose: () => void;
  onConfirm?: () => void;
}

export default function CartelHabitacionesOcupadas({
  lista,
  desdeFecha,
  hastaFecha,
  onClose,
  onConfirm
}: Props) {

  const habitacionesUnicas = Array.from(
    new Set(lista.map((item) => item.split("|")[1]))
  ).sort((a, b) => Number(a) - Number(b));

  const handleConfirmar = () => {
    if (onConfirm) {
      onConfirm();
    }
    onClose();
  };

  return (
    <div className="fixed inset-0 flex items-center justify-center z-50">
      
      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL MODAL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140">

        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img
          src="/imagenInformacion.png"
          alt="Informacion"
          className="absolute top-3 left-3 w-10 h-10"
        />

        {/* TITULO */}
        <h2 className="text-xl font-bold text-center mb-4 text-indigo-950">
          Confirmar selecci√≥n de habitaciones
        </h2>

        {/* CONTENIDO DEL MENSAJE */}
        <div className="text-gray-700 text-center space-y-4">

          {/* Fechas seleccionadas */}
          <div className="grid grid-cols-2 gap-4 bg-gray-50 p-3 rounded-md text-sm">
            <div>
              <span className="block text-xs text-gray-500 uppercase font-semibold">
                Desde
              </span>
              <span className="font-medium text-indigo-900">{desdeFecha}</span>
            </div>
            <div>
              <span className="block text-xs text-gray-500 uppercase font-semibold">
                Hasta
              </span>
              <span className="font-medium text-indigo-900">{hastaFecha}</span>
            </div>
          </div>

          {/* Info */}
          <p>
            Se han seleccionado{" "}
            <span className="font-bold">{lista.length}</span> bloques de ocupaci√≥n.
          </p>

          {/* Habitaciones afectadas */}
          {habitacionesUnicas.length > 0 && (
            <div>
              <p className="text-xs text-gray-500 uppercase font-semibold mb-1">
                Habitaciones afectadas:
              </p>

              <div className="flex flex-wrap justify-center gap-2">
                {habitacionesUnicas.map((num) => (
                  <span
                    key={num}
                    className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800"
                  >
                    Hab. {num}
                  </span>
                ))}
              </div>
            </div>
          )}
        </div>

        {/* BOTONES */}
        <div className="mt-6 justify-center flex gap-4">
          <button
            type="button"
            className="px-7 py-1 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
            onClick={onClose}
          >
            Volver
          </button>

          <button
            type="button"
            className="px-7 py-1 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
            onClick={handleConfirmar}
          >
            Confirmar
          </button>
        </div>

      </div>
    </div>
  );
}
//[carteles/CartelHabitacionNoDisponible.tsx]
// components/carteles/CartelAviso.tsx
"use client";

interface Props {
  mensaje: string;
  onClose: () => void;
}

export default function CartelAviso({ mensaje, onClose }: Props) {
  return (
    <div className="fixed inset-0 flex items-center justify-center z-[9999]">

      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL MODAL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140 text-center">

        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img
          src="/imagenAdvertencia.png"
          alt="Advertencia"
          className="absolute top-3 left-3 w-10 h-10"
        />

        {/* Bot√≥n de cerrar */}
        <button
          type="button"
          onClick={onClose}
          className="absolute top-2 right-2 text-black font-bold text-lg hover:text-gray-700"
        >
          ‚úï
        </button>

        {/* TEXTO DEL MENSAJE */}
        <p className="text-xl font-semibold text-indigo-950 mt-4">
          {mensaje}
        </p>
      </div>
    </div>
  );
}
//[carteles/cartelListaHabitaciones.tsx]
'use client';

import { useRouter } from "next/navigation";
import { format, parseISO } from "date-fns";
import { es } from "date-fns/locale";

interface Props {
  lista: any[];
  seleccionados: string[];
  rangos: { numero: number; desde: string; hasta: string }[];
  desdeFecha: string;
  hastaFecha: string;
  onClose: () => void;
  onAceptar: () => void;
}

export default function CartelListaHabitaciones({
  lista,
  rangos,
  seleccionados,
  desdeFecha,
  hastaFecha,
  onClose,
  onAceptar
}: Props) {
  const router = useRouter();

  const formatearFecha = (fecha: string) => {
    try {
      const fechaDate = parseISO(fecha);
      const nombreDia = format(fechaDate, "EEEE", { locale: es });
      const fechaFormateada = format(fechaDate, "dd/MM/yyyy");
      return { nombreDia: nombreDia.charAt(0).toUpperCase() + nombreDia.slice(1), fechaFormateada };
    } catch {
      return { nombreDia: "", fechaFormateada: fecha };
    }
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-[9999]">
      <div className="relative bg-white w-[700px] max-h-[80vh] overflow-auto rounded-xl p-8 shadow-xl border">

        {/* √çcono de informaci√≥n */}
        <img
          src="/imagenInformacion.png"
          alt="Info"
          className="absolute top-4 left-4 w-12 h-12"
        />

        {/* Bot√≥n cerrar */}
        <button
          className="absolute top-4 right-4 text-gray-700 hover:text-black text-xl font-bold"
          onClick={onClose}
        >
          ‚úï
        </button>

        {/* T√≠tulo */}
        <h2 className="text-center text-2xl font-bold text-[#1D4F73] mb-6">
          HABITACIONES SELECCIONADAS:
        </h2>

        {/* Lista con formato del caso de uso */}
        <div className="space-y-6">
          {lista.map((item: any, index: number) => {
            const rango = rangos.find(r => r.numero === item.numero);
            if (!rango) return null;

            const fechaDesde = formatearFecha(rango.desde);
            const fechaHasta = formatearFecha(rango.hasta);

            return (
              <div key={index} className="text-[#1D4F73] text-lg leading-relaxed border-b pb-4">
                <p className="font-semibold">‚Ä¢ Tipo de Habitaci√≥n: {item.tipo}</p>
                <p>‚Ä¢ Ingreso: {fechaDesde.nombreDia}, {fechaDesde.fechaFormateada}, 12:00hs.</p>
                <p>‚Ä¢ Egreso: {fechaHasta.nombreDia}, {fechaHasta.fechaFormateada}, 10:00hs</p>
              </div>
            );
          })}
        </div>

        {/* Botones ACEPTAR y RECHAZAR */}
        <div className="flex justify-center gap-6 mt-8">
          <button 
            className="px-6 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition"
            onClick={() => {
              onClose();
            }}
          >
            RECHAZAR
          </button>

          <button
            className="px-6 py-2 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
            onClick={onAceptar}
          >
            ACEPTAR
          </button>
        </div>
      </div>
    </div>
  );
}
//[carteles/CartelNoSeleccionoHuesped.tsx]
"use client";
import React from "react";

interface Props {
  onAceptar: () => void;
}

export default function CartelNoSeleccionoHuesped({ onAceptar }: Props) {
  return (
    <div className="fixed inset-0 z-[9999] flex items-center justify-center">

      {/* FONDO OSCURECIDO */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140 text-center">

        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img
          src="/imagenError.png"
          alt="Error"
          className="absolute top-3 left-3 w-10 h-10"
        />

        {/* TEXTO CENTRADO CON PADDING */}
        <div className="pl-10">
          <h2 className="text-red-700 font-bold text-center mb-4">
            No se seleccion√≥ ning√∫n hu√©sped
          </h2>

          <h3 className="text-indigo-950">
            Debe seleccionar un hu√©sped antes de continuar.
          </h3>
        </div>

        {/* BOT√ìN */}
        <div className="mt-6 flex justify-center">
          <button
            type="button"
            className="px-6 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition"
            onClick={onAceptar}
          >
            Aceptar
          </button>
        </div>

      </div>
    </div>
  );
}
//[carteles/CartelPresioneTecla.tsx]
"use client";

import Link from "next/link";

type Props = {
  onClose: () => void;
};

export default function CartelPresioneTecla({ onClose }: Props) {
  return (
    <div className="fixed inset-0 flex items-center justify-center z-[9999]">

      {/* CONTENIDO */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-120">

        {/* ICONO INFORMACI√ìN */}
        <img
          src="/imagenInformacion.png"
          alt="Info"
          className="absolute top-3 left-3 w-10 h-10"
        />

        {/* T√çTULO */}
        <h2 className="text-xl font-bold text-center mb-4 text-indigo-950">
          Las habitaciones seleccionadas fueron marcadas como ocupadas.
        </h2>

        {/* TEXTO / INDICACI√ìN */}
        <p className="text-center text-gray-700 mb-6">
          Presione aceptar para continuar‚Ä¶
        </p>

        {/* BOT√ìN */}
        <div className="flex justify-center">
          
          <Link href="/ocuparHabitacion/tablaHuespedes"> 
            <button type="button" onClick={onClose} className="px-6 py-2 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"> Aceptar </button>
          </Link>

        </div>
      </div>
    </div>
  );
}
//[carteles/confirmarEliminarHuesped.tsx]
"use client";

type Props = {
  nombre: string;
  apellido: string;
  tipoDocumento: string;
  dni: string;
  onEliminar: () => void;
  onCancelar: () => void;
};

export default function ConfirmarEliminarHuesped({ nombre, apellido, tipoDocumento, dni, onEliminar, onCancelar }: Props) {
  return (
    <div className="fixed inset-0 z-[9999] flex items-center justify-center">
      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL CARTEL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140 text-center">
        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img src="/imagenAdvertencia.png" alt="Advertencia" className="absolute top-3 left-3 w-10 h-10" />

        <div className="pl-10">
          <h2 className="text-xl font-bold text-center mb-4 text-indigo-950">
            Los datos del hu√©sped <strong>{nombre} {apellido}</strong>, {tipoDocumento} {dni} ser√°n eliminados del sistema
          </h2>
        </div>

        {/* BOTONES */}
        <div className="mt-6 flex justify-center gap-4">
          <button
            type="button"
            className="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all shadow-md hover:shadow-lg font-semibold"
            onClick={onCancelar}
          >
            Cancelar
          </button>

          <button
            type="button"
            className="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all shadow-md hover:shadow-lg font-semibold"
            onClick={onEliminar}
          >
            Eliminar
          </button>
        </div>
      </div>
    </div>
  );
}
//[carteles/eliminarHuesped.tsx]
"use client";

type Props = {
  onClose: () => void;
};

export default function EliminarHuesped({ onClose }: Props) {

  return (
    <div className="fixed inset-0 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg shadow-lg p-6 w-140 text-center">
        <h2 className="text-xl font-bold text-center mb-4 text-indigo-950">El huesped <br /> NOMBRE Y APELLIDO TIPODOC:NUMDOC <br /> sera eliminado del sistema</h2>
        {/*/  Botones de Aceptar y Cancelar  */}
        <div className=" mt-6 justify-center sticky bottom-0 flex gap-4 ">
            <button type="button" className="px-7 py-1 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition" onClick={onClose}>Rechazar</button>
            <button type="button" className="px-7 py-1 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition" onClick={onClose}>Aceptar</button>
        </div>
      </div>
    </div>
  );
}
//[carteles/errorDniExistente.tsx]
import React from "react";

interface Props {
  mensaje: string;
  onCorregir: () => void;
  onAceptar: () => void;
}

export default function ErrorDniExistente({ mensaje, onCorregir, onAceptar }: Props) {
  return (
    <div className="fixed inset-0 z-[9999] flex items-center justify-center">

      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL CARTEL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140 text-center">

        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img
          src="/imagenError.png"
          alt="Error"
          className="absolute top-3 left-3 w-10 h-10"
        />

        {/* CONTENEDOR DEL TEXTO - con padding para centrarlo visualmente */}
        <div className="pl-10"> 
          <h2 className="text-red-700 font-bold text-center mb-4">
            {mensaje}
          </h2>
          <h3> El tipo y n√∫mero de documento ya existen en el sistema </h3>
        </div>

        {/* BOTONES */}
        <div className="mt-6 flex justify-center gap-4">
          <button
            type="button"
            className="px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition"
            onClick={onCorregir}
          >
            Corregir
          </button>

          <button
            type="button"
            className="px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition"
            onClick={onAceptar}
          >
            Aceptar Igualmente
          </button>
        </div>
      </div>
    </div>
  );
}
//[carteles/facturarUnTercero.tsx]
"use client";

import { useState, ChangeEvent } from "react";
import axios from "axios";

type Props = {
  onClose: () => void;
  onAceptar: (cuit: string, razonSocial: string) => void;
};

export default function FacturarUnTerceroModal({ onClose, onAceptar }: Props) {
  const [cuit, setCuit] = useState("");
  const [razonSocial, setRazonSocial] = useState("");
  const [error, setError] = useState("");
  const [buscando, setBuscando] = useState(false);

  const buscarRazonSocial = async () => {
    if (!cuit.trim()) {
      setError("El CUIT no puede estar vac√≠o");
      return;
    }

    setBuscando(true);
    setError("");

    try {
      // Buscar responsable de pago por CUIT
      const response = await axios.get(`http://localhost:8080/responsablesPago`, {
        params: { cuit: cuit.trim() }
      });

      if (response.data && response.data.length > 0) {
        setRazonSocial(response.data[0].razonSocial || "");
      } else {
        setError("No se encontr√≥ un responsable de pago con ese CUIT");
        setRazonSocial("");
      }
    } catch (error) {
      console.error("Error al buscar CUIT:", error);
      setError("Error al buscar el CUIT. Verifique que sea correcto.");
      setRazonSocial("");
    } finally {
      setBuscando(false);
    }
  };

  const handleAceptar = () => {
    if (!cuit.trim()) {
      setError("El CUIT no puede estar vac√≠o");
      return;
    }

    if (!razonSocial) {
      setError("Debe buscar la raz√≥n social primero");
      return;
    }

    onAceptar(cuit, razonSocial);
  };

  return (
    <div className="fixed inset-0 z-[9999] flex items-center justify-center">
      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL CARTEL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140">
        <h2 className="text-xl font-bold text-center mb-4 text-indigo-950">Facturar a un Tercero</h2>
        
        {/* Campo para ingresar CUIT */}
        <div className="mb-4">
          <label className="text-indigo-950 font-semibold mb-2 block text-sm">CUIT:</label>
          <div className="flex gap-2">
            <input
              type="text"
              value={cuit}
              onChange={(e) => {
                setCuit(e.target.value.toUpperCase());
                setRazonSocial("");
                setError("");
              }}
              placeholder="XX-XXXXXXXX-X"
              className="flex-1 p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent border-gray-300 hover:border-indigo-400"
              onKeyDown={(e) => {
                if (e.key === 'Enter') {
                  e.preventDefault();
                  buscarRazonSocial();
                }
              }}
            />
            <button
              type="button"
              onClick={buscarRazonSocial}
              disabled={buscando}
              className="px-4 py-2 bg-indigo-950 text-white rounded-lg hover:bg-indigo-800 transition-all disabled:bg-gray-400 disabled:cursor-not-allowed"
            >
              {buscando ? "Buscando..." : "Buscar"}
            </button>
          </div>
          {error && <p className="text-red-600 text-xs mt-1">{error}</p>}
        </div>

        {/* Mostrar Raz√≥n Social */}
        {razonSocial && (
          <div className="mb-4">
            <label className="text-indigo-950 font-semibold mb-2 block text-sm">Raz√≥n Social:</label>
            <p className="p-3 bg-gray-50 border-2 border-gray-300 rounded-lg text-indigo-950 font-medium">
              {razonSocial}
            </p>
          </div>
        )}

        {/* Botones */}
        <div className="mt-6 flex justify-center gap-4">
          <button
            onClick={onClose}
            className="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all shadow-md hover:shadow-lg font-semibold"
          >
            Cancelar
          </button>
          <button
            onClick={handleAceptar}
            disabled={!razonSocial}
            className="px-6 py-2 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold disabled:bg-gray-400 disabled:cursor-not-allowed"
          >
            Aceptar
          </button>
        </div>
      </div>
    </div>
  );
}
//[carteles/habitacionCargadaCorrectamente.tsx]
// components/carteles/CartelAviso.tsx
'use client';

interface Props {
  mensaje: string;
  onClose: () => void;
}

export default function CartelAviso({ mensaje, onClose }: Props) {
  return (
    <div
      className="fixed inset-0 flex items-center justify-center z-[9999]"
      style={{ background: "transparent" }}
    >
      <div className="bg-yellow-300 border-2 border-yellow-600 rounded-xl shadow-xl p-6 max-w-sm text-center relative">

        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img src="/imagenInformacion.png"  alt="Informacion" className="absolute top-3 left-3 w-10 h-10" />

        {/* Bot√≥n de cerrar */}
        <button
          type="button"
          onClick={onClose}
          className="absolute top-2 right-2 text-black font-bold text-lg hover:text-gray-800"
        >
          ‚úï
        </button>

        <p className="text-lg font-semibold">{"Habitacion cargada. Texto de prueba"}</p>
      </div>
    </div>
  );
}
//[carteles/habitacionesSeleccionadas.tsx]
// components/carteles/CartelAviso.tsx
'use client';

interface Props {
  mensaje: string;
  onClose: () => void;
}

export default function CartelAviso({ mensaje, onClose }: Props) {
  return (
    <div
      className="fixed inset-0 flex items-center justify-center z-[9999]"
      style={{ background: "transparent" }}
    >
      <div className="bg-yellow-300 border-2 border-yellow-600 rounded-xl shadow-xl p-6 max-w-sm text-center relative">

        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img src="/imagenInformacion.png"  alt="Informacion" className="absolute top-3 left-3 w-10 h-10" />

        {/* Bot√≥n de cerrar */}
        <button
          type="button"
          onClick={onClose}
          className="absolute top-2 right-2 text-black font-bold text-lg hover:text-gray-800"
        >
          ‚úï
        </button>

        <p className="text-lg font-semibold">{"Habitaciones seleccionadas. Texto de prueba"}</p>
      </div>
    </div>
  );
}
//[carteles/habitacionReservadaOcuparIgual.tsx]
"use client";

interface Props {
  onClose: () => void;
  onConfirm: () => void;
  mensajeExtra: string;
}

export default function HabitacionReservadaOcuparIgual({
  onClose,
  onConfirm,
  mensajeExtra
}: Props) {
  return (
    <div className="fixed inset-0 flex items-center justify-center z-[9999]">
      
      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140">

        {/* ICONO */}
        <img
          src="/imagenAdvertencia.png"
          alt="Advertencia"
          className="absolute top-3 left-3 w-10 h-10"
        />

        {/* TITULO */}
        <h2 className="text-xl font-bold text-center mb-4 text-indigo-950 mt-8">
          Habitaci√≥n Reservada
        </h2>

        {/* TEXTO PRINCIPAL */}
        <p className="text-center text-indigo-950 mb-4">
          La habitaci√≥n seleccionada ya posee una reserva en el rango indicado.
        </p>

        {/* MENSAJE DIN√ÅMICO */}
        <p className="text-center font-semibold text-indigo-950 whitespace-pre-line mb-6">
          {mensajeExtra}
        </p>

        {/* BOTONES */}
        <div className="mt-6 justify-center flex gap-4">
          <button
            type="button"
            className="px-7 py-1 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
            onClick={onClose}
          >
            Volver
          </button>

          <button
            type="button"
            className="px-7 py-1 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
            onClick={onConfirm}
          >
            Ocupar igual
          </button>
        </div>
      </div>
    </div>
  );
}
//[carteles/huespedCargadoSatisfacoriamente.tsx]
"use client";

import Link from "next/link";

type Props = {
  onClose: () => void;
  onNuevo: () => void;  // üëà NUEVO
  nombre: string;
  apellido: string;
};

export default function CargarOtroHuesped({ onClose, onNuevo, nombre, apellido }: Props) {
  return (
    <div className="fixed inset-0 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg shadow-lg p-6 w-140 text-center">
        
        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img src="/imagenInformacion.png"  alt="Informacion" className="absolute top-3 left-3 w-10 h-10" />

        <h2 className="text-xl font-bold text-center mb-4 text-indigo-950">
          El huesped <strong>{nombre} {apellido}</strong> ha sido cargado satisfactoriamente
        </h2>

        <strong>¬øDesea cargar otro huesped?</strong>

        <div className="mt-6 justify-center sticky bottom-0 flex gap-4">
          
          {/* SI ‚Üí limpiar campos sin salir de la p√°gina */}
          <button 
            type="button" 
            className="px-7 py-1 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
            onClick={() => {
              onNuevo();   // üëâ Limpia todo
              onClose();   // üëâ Cierra cartel
            }}
          >
            SI
          </button>

          {/* NO ‚Üí volver al men√∫ */}
          <Link href="/menu">
            <button 
              type="button" 
              className="px-7 py-1 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
              onClick={onClose}
            >
              NO
            </button>
          </Link>

        </div>
      </div>
    </div>
  );
}
//[carteles/huespedEliminado.tsx]
"use client";
import { useEffect } from "react";
import Link from "next/link";

type Props = {
  nombre: string;
  apellido: string;
  tipoDocumento: string;
  dni: string;
  onClose: () => void;
};

export default function HuespedEliminado({ nombre, apellido, tipoDocumento, dni, onClose }: Props) {
  useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      event.preventDefault();
      onClose();
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => {
      window.removeEventListener("keydown", handleKeyDown);
    };
  }, [onClose]);

  return (
    <div className="fixed inset-0 z-[9999] flex items-center justify-center">
      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL CARTEL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140 text-center">
        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img src="/imagenInformacion.png" alt="Informaci√≥n" className="absolute top-3 left-3 w-10 h-10" />

        <div className="pl-10">
          <h2 className="text-xl font-bold text-center mb-4 text-indigo-950">
            Los datos del hu√©sped <strong>{nombre} {apellido}</strong>, {tipoDocumento} {dni} han sido eliminados del sistema.
          </h2>
          <p className="text-gray-700 mb-6">Presione cualquier tecla para continuar‚Ä¶</p>
        </div>
      </div>
    </div>
  );
}
//[carteles/huespedNoEncontrado.tsx]
"use client";
import Link from "next/link";

interface Props {
  onClose: () => void;
}

export default function huespedNoEncontrado({ onClose }: Props) {
  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center">

      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL CARTEL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140">

        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img src="/imagenError.png"  alt="Error" className="absolute top-3 left-3 w-10 h-10" />

        <h2 className="text-red-700 font-bold text-center mb-4">
          No se encontraron hu√©spedes con esos datos.<br />
        </h2>

        <p className="text-gray-700 text-center mb-6">
          Presione <b>Dar Alta Hu√©sped</b> si desea cargarlo.
        </p>

        {/* BOTONES M√ÅS JUNTOS */}
        <div className="mt-6 flex justify-center gap-4">
          <button
            onClick={onClose}
            className="px-4 py-2 bg-indigo-950 text-white rounded hover:bg-gray-500 transition"
          >
            Cancelar
          </button>

          <Link
            href="/darAltaHuesped"
            className="px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition"
          >
            Dar Alta Hu√©sped
          </Link>
        </div>
      </div>
    </div>
  );
}
//[carteles/menorEdad.tsx]
"use client";

type Props = {
  onClose: () => void;
};

export default function MenorEdad({ onClose }: Props) {
  return (
    <div className="fixed inset-0 z-[9999] flex items-center justify-center">
      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL CARTEL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140 text-center">
        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img src="/imagenError.png" alt="Error" className="absolute top-3 left-3 w-10 h-10" />

        <div className="pl-10">
          <h2 className="text-xl font-bold text-center mb-4 text-red-700">
            La persona seleccionada es menor de edad. Por favor elija otra
          </h2>
        </div>

        {/* BOT√ìN */}
        <div className="mt-6 flex justify-center">
          <button
            type="button"
            className="px-6 py-2 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold"
            onClick={onClose}
          >
            Aceptar
          </button>
        </div>
      </div>
    </div>
  );
}

//[carteles/modificacionExitosa.tsx]
"use client";
import Link from "next/link";

type Props = {
  onClose: () => void;
};

export default function ModificacionExitosa({ onClose }: Props) {
  return (
    <div className="fixed inset-0 z-[9999] flex items-center justify-center">
      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL CARTEL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140 text-center">
        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img src="/imagenInformacion.png" alt="Informaci√≥n" className="absolute top-3 left-3 w-10 h-10" />

        <div className="pl-10">
          <h2 className="text-xl font-bold text-center mb-4 text-indigo-950">
            La operaci√≥n ha culminado con √©xito
          </h2>
        </div>

        {/* BOT√ìN */}
        <div className="mt-6 flex justify-center">
          <Link href="/menu">
            <button
              type="button"
              className="px-6 py-2 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold"
              onClick={onClose}
            >
              Aceptar
            </button>
          </Link>
        </div>
      </div>
    </div>
  );
}
//[carteles/noSePuedeEliminarHUesped.tsx]
"use client";
import { useEffect } from "react";

type Props = {
  onClose: () => void;
};

export default function NoSePuedeEliminarHuesped({ onClose }: Props) {
    useEffect(() => {
        // Funci√≥n que se ejecuta cuando se aprieta una tecla
        const handleKeyDown = (event: KeyboardEvent) => {
            event.preventDefault();  // evita que el ENTER sea capturado por formularios
            onClose();
        };

        // Agregar listener
        window.addEventListener("keydown", handleKeyDown);

        // Sacar listener cuando el modal se destruye
        return () => {
        window.removeEventListener("keydown", handleKeyDown);
        };
    }, [onClose]);

  return (
    <div className="fixed inset-0 flex items-center justify-center bg-black/50 z-50">
      <div className="bg-white rounded-lg shadow-lg p-6 w-140 text-center">
        <h2 className="text-xl font-bold mb-4 text-indigo-950">EL HUESPED NO PUEDE SER ELIMINADO DEL SISTEMA</h2>
        <p className="text-indigo-950 text-sm">Presione cualquier tecla para continuar...</p>
      </div>
    </div>
  );
}
//[carteles/ocuparHabitacionIgualmente.tsx]
"use client";

type Props = {
  onClose: () => void;
};

export default function CargarOtroHuesped({ onClose }: Props) {

  return (
    <div className="fixed inset-0 flex items-center justify-center z-50">
      <div className="bg-white rounded-lg shadow-lg p-6 w-140 text-center">
        <h2 className="text-xl font-bold text-center mb-4 text-indigo-950">Los dias (DIAS DESDE Y HASTA) se encuentran reservados</h2>
        <strong >Estan reservados por: NOMBRE Y APELLIDO HUESPED</strong>
        {/*/  Botones de Aceptar y Cancelar  */}
        <div className=" mt-6 justify-center sticky bottom-0 flex gap-4 ">
            <button type="button" className="px-7 py-1 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition" onClick={onClose}>Volver</button>
            <button type="button" className="px-7 py-1 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition" onClick={onClose}>Ocupar Igual</button>
        </div>
      </div>
    </div>
  );
}
//[carteles/reservaCancelada.tsx]
"use client";

import { useEffect } from "react";

type Props = {
  cantidad?: number;
  onClose: () => void;
};

export default function ReservaCancelada({ cantidad = 1, onClose }: Props) {
  useEffect(() => {
    const handleKeyPress = () => {
      onClose();
    };

    window.addEventListener('keydown', handleKeyPress);
    return () => {
      window.removeEventListener('keydown', handleKeyPress);
    };
  }, [onClose]);

  const mensaje = cantidad === 1 
    ? "Reserva cancelada" 
    : "Reservas canceladas";

  return (
    <div className="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-[9999]">
      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL MODAL */}
      <div className="relative bg-white rounded-xl shadow-xl p-8 w-auto min-w-[500px]">
        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img
          src="/imagenInformacion.png"
          alt="Info"
          className="absolute top-4 left-4 w-12 h-12"
        />

        {/* Bot√≥n de cerrar */}
        <button
          type="button"
          onClick={onClose}
          className="absolute top-4 right-4 text-gray-700 hover:text-black text-xl font-bold"
        >
          ‚úï
        </button>

        <h2 className="text-xl font-bold text-center mb-4 text-indigo-950 mt-8">
          {mensaje}
        </h2>
        <p className="text-center text-gray-700 mb-6">
          PRESIONE UNA TECLA PARA CONTINUAR‚Ä¶
        </p>
      </div>
    </div>
  );
}
//[carteles/reservaConfirmada.tsx]
"use client";

import Link from "next/link";

type Props = {
  onClose: () => void;
};

export default function ReservaConfirmada({ onClose }: Props) {
  return (



    <div className="fixed inset-0 flex items-center justify-center z-50">



      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL MODAL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140">

        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img
                 src="/imagenInformacion.png"
                 alt="Info"
                 className="absolute top-4 left-4 w-12 h-12"
               />

        {/* Bot√≥n de cerrar */}
                <button
                  type="button"
                  onClick={onClose}
                  className="absolute top-2 right-2 text-black font-bold text-lg hover:text-gray-800"
                >
                  ‚úï
                </button>

        <h2 className="text-xl font-bold text-center mb-4 text-indigo-950">
          Reservas creadas exitosamente
        </h2>


      </div>
    </div>
  );
}
//[carteles/SeguirOcuparHabitacion.tsx]
"use client";
import Link from "next/link";
import React from "react";

interface Props {
  onSeguirCargando: () => void;
  onCargarMasHabitaciones: () => void;
  onSalir: () => void;
}

export default function SeguirOcuparHabitacion({
  onSeguirCargando,
  onCargarMasHabitaciones,
  onSalir,
}: Props) {
  return (
    <div className="fixed inset-0 z-[9999] flex items-center justify-center">

      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL CARTEL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140 text-center">

        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img
          src="/imagenInformacion.png"
          alt="Informacion"
          className="absolute top-3 left-3 w-10 h-10"
        />

        {/* TITULO */}
        <div className="pl-10">
          <h2 className="text-indigo-950 font-bold text-center mb-4">
            ¬øQu√© quer√©s hacer ahora?
          </h2>
          <h3 className="text-gray-700 text-sm mb-3">
            Eleg√≠ una de las siguientes opciones:
          </h3>
        </div>

        {/* BOTONES */}
        <div className="mt-6 flex flex-col gap-3">
          
          <Link href="/ocuparHabitacion/tablaHuespedes"> 
                <button className="px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition" onClick={onSeguirCargando}> Seguir Cargando Huespedes</button>
          </Link>
          

            <Link href="/ocuparHabitacion">
                <button className="px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition" onClick={onCargarMasHabitaciones}> Cargar m√°s Habitaciones</button>
            </Link>

            <Link href="/menu"> 
                <button className="px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition" onClick={onSalir}> Salir </button>
            </Link>

        </div>

      </div>
    </div>
  );
}
//[carteles/SeleccionarRepresentantes.tsx]
"use client";
import React from "react";
import { TipoHuesped } from "@/app/tabla/page";

interface Props {
  huespedes: TipoHuesped[];
  onCerrar: () => void;
  onAceptar: (representante: TipoHuesped | null) => void;
  onSeguir?: () => void; // ‚Üê nuevo callback opcional
}


export default function SeleccionarRepresentantes({
  huespedes,
  onCerrar,
  onAceptar,
  onSeguir,
}: Props) {
  const [representante, setRepresentante] = React.useState<TipoHuesped | null>(null);
  const [error, setError] = React.useState(false); // ‚Üê estado para mostrar error

    const handleAceptar = () => {
        if (!representante) {
            setError(true);
            return;
        }

        onAceptar(representante);

        if (onSeguir) {
            onSeguir(); // Abrir el siguiente cartel
        }
    };


  return (
    <div className="fixed inset-0 z-[9999] flex items-center justify-center">

      {/* FONDO TENUE */}
      <div className="absolute inset-0 bg-black/40 backdrop-blur-sm"></div>

      {/* CONTENIDO DEL CARTEL */}
      <div className="relative bg-white rounded-lg shadow-lg p-6 w-140 text-center">

        {/* IMAGEN ESQUINA SUPERIOR IZQUIERDA */}
        <img
          src="/imagenInformacion.png"
          alt="Informacion"
          className="absolute top-3 left-3 w-10 h-10"
        />

        {/* TITULO */}
        <div className="pl-10">
          <h2 className="text-indigo-950 font-bold text-center mb-4">
            Seleccionar Representante
          </h2>
          <h3 className={`text-sm mb-3 ${error ? "text-red-500 font-bold" : "text-gray-700"}`}>
            Marc√° un hu√©sped como representante.
          </h3>
        </div>

        {/* LISTA DE HUESPEDES */}
        <div className="max-h-[250px] overflow-y-auto border p-3 rounded text-left mt-2">
          {huespedes.map((h) => (
            <label
              key={h.huespedID.dni}
              className="flex items-center gap-2 mb-2 cursor-pointer"
            >
              <input
                type="radio"
                name="representante"
                checked={representante?.huespedID.dni === h.huespedID.dni}
                onChange={() => {
                  setRepresentante(h);
                  setError(false); // ‚Üê si selecciona algo, se quita el error
                }}
              />
              {h.apellido}, {h.nombre} ‚Äî{" "}
              {h.huespedID.tipoDocumento} {h.huespedID.dni}
            </label>
          ))}
        </div>

        {/* BOTONES */}
        <div className="mt-6 flex justify-center gap-4">
          <button
            type="button"
            className="px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition"
            onClick={onCerrar}
          >
            Cancelar
          </button>

          <button
            type="button"
            className="px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition"
            onClick={handleAceptar}
          >
            Aceptar
          </button>
        </div>

      </div>
    </div>
  );
}
//[components/header.tsx]
// /components/Header.tsx
"use client";

import { Cormorant_Garamond } from "next/font/google";
import Link from "next/link";
import { usePathname } from "next/navigation";
import Image from "next/image";

const cormorant = Cormorant_Garamond({
  subsets: ["latin"],
  weight: ["700"], // para hacerlo bien elegante
});


export default function Header() {
  const pathname = usePathname();
  const mostrarHeader = pathname !== "/loging";
  const mostrarHeader1 = pathname !== "/paginaPrincipal";

  if (!mostrarHeader || !mostrarHeader1) return null;

  return (
    <header className="w-full bg-indigo-950 text-white py-6 px-6 shadow-lg">
      <Link href="/menu" className="hover:text-gray-500"> 
        <div className="flex items-center gap-4 mb-4">
        <Image 
          src="/logoHotelPremier.png"        // Asegurate de que la imagen se llame as√≠ en la carpeta public
          alt="Logo Hotel Premier"
          width={80}             // Un tama√±o acorde al texto grande
          height={80}
          className="object-contain" // Para asegurar que no se estire raro
        />
        <h1 className={`${cormorant.className} text-5xl font-bold`}>Hotel Premier</h1>
        </div>
      </Link>
      

      <nav className="flex gap-6 text-lg overflow-x-auto whitespace-nowrap">
        
        <Link
          href="/reservarHabitacion"
          className={` ${
            pathname === "/reservarHabitacion"
              ? "text-gray-500"
              : "hover:text-gray-500"
          }`}
        >
          Reservar Habitaci√≥n
        </Link>

        <Link  
          href="/buscarHuesped"
          className={` ${
              pathname === "/buscarHuesped"
                ? "text-gray-500"
                : "hover:text-gray-500"
            }`}
        >
            Buscar Hu√©sped
        </Link>

        <Link href="/facturar"
          className={` ${
              pathname === "/facturar"
                ? "text-gray-500"
                : "hover:text-gray-500"
            }`}
        >
          Facturar
        </Link>

        {/*<Link href="/darAltaHuesped"
          className={` ${
                pathname === "/darAltaHuesped"
                  ? "text-gray-500"
                  : "hover:text-gray-500"
            }`}
        >
          Dar alta Hu√©sped
        </Link> */}

        {/*<Link href="/darBajaHuesped"
          className={` ${
                pathname === "/darBajaHuesped"
                  ? "text-gray-500"
                  : "hover:text-gray-500"
            }`}
        >
          Dar baja Hu√©sped
        </Link> */}

        {/*<Link href="/listarIngresos" 
          className={` ${
                pathname === "/listarIngresos"
                  ? "text-gray-500"
                  : "hover:text-gray-500"
              }`}
        >
          Listar Ingresos
        </Link> */}

        <Link href="/cancelarReserva"
          className={` ${
                pathname === "/cancelarReserva"
                  ? "text-gray-500"
                  : "hover:text-gray-500"
              }`}
        >
          Cancelar Reserva
        </Link> 

        <Link href="/ingresarPago"
          className={` ${
                pathname === "/ingresarPago"
                  ? "text-gray-500"
                  : "hover:text-gray-500"
              }`}
        >
          Ingresar Pago
        </Link>

        {/*<Link href="/ocuparHabitacion"
          className={` ${
                pathname === "/ocuparHabitacion"
                  ? "text-gray-500"
                  : "hover:text-gray-500"
              }`}
        >
          Ocupar Habitacion
        </Link> */}


      </nav>
    </header>
  );
}
//[confirmarReserva/page.tsx]
"use client";
import { useState, useEffect } from "react";
import { useSearchParams } from "next/navigation";
import { useMemo } from "react";
import { parseISO, format } from "date-fns";
import { esSoloLetras, esSoloNumeros, esObligatorio, telefonoValido} from "../validaciones/validaciones";
import { es } from "date-fns/locale";
import  ReservaConfirmada  from "../carteles/reservaConfirmada";

interface HabitacionDTO {
  numero: number;
  estado: string; 
  precio: number;
  cantidadPersonas: number;
  tipohabitacion: string;
  listaReservas: ReservaDTO[]; 
  listaestadias: EstadiaDTO[];
}

interface ReservaDTO {

  nro_habitacion: number;
  fecha_desde: string;
  fecha_hasta: string;
  //estado: string;
  nombre: string;
  apellido: string;
  telefono: string;
}

interface EstadiaDTO {
  checkIn: string;
  checkOut: string;
}

export default function DatosHuesped() {

  const params = useSearchParams();
  const raw = params.get("seleccion") || "[]";

  const [nombre, setNombre] = useState("");
  const [apellido, setApellido] = useState("");
  const [telefono, setTelefono] = useState("");

  const [rangos, setRangos] = useState<{ numero: number; desde: string; hasta: string }[]>([]);


  // Estados para errores
  const [errorNombre, setErrorNombre] = useState(false);
  const [errorApellido, setErrorApellido] = useState(false);
  const [errorTelefono, setErrorTelefono] = useState(false);
  const [errorNombreObligatorio, setErrorNombreObligatorio] = useState(false);
  const [errorApellidoObligatorio, setErrorApellidoObligatorio] = useState(false);
  const [errorTelefonoObligatorio, setErrorTelefonoObligatorio] = useState(false);

  //estado erne
  const [mostrarCartel, setMostrarCartel] = useState(false);



  useEffect(() => {
    setErrorNombre(nombre !== "" && !esSoloLetras(nombre));
  }, [nombre]);

  useEffect(() => {
    setErrorApellido(apellido !== "" && !esSoloLetras(apellido));
  }, [apellido]);

  useEffect(() => {
    setErrorTelefono(telefono !== "" && (!esSoloNumeros(telefono) || !telefonoValido(telefono)));
  }, [telefono]);

  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();

    // VALIDAMOS OBLIGATORIOS
    setErrorNombreObligatorio(!esObligatorio(nombre));
    setErrorApellidoObligatorio(!esObligatorio(apellido));
    setErrorTelefonoObligatorio(!esObligatorio(telefono));

    // SI ALGUNO FALTA ‚Üí NO SE SIGUE
    if (
      !esObligatorio(nombre) ||
      !esObligatorio(apellido) ||
      !esObligatorio(telefono)
    ) {
      return;
    }

    //cuando los datos son incorrectos
    if (errorNombre || errorApellido || errorTelefono) {
      //ya estan los useeffect que hacen que se pongan en rojo a penas se escriben mal
      return;
    }


const listaReservasDTO: ReservaDTO[] = rangos.map(rango => ({
  nro_habitacion: rango.numero,
  fecha_desde: rango.desde,
  fecha_hasta: rango.hasta,
 // estado: "pendiente",
  nombre: nombre,
  apellido: apellido,
  telefono: telefono
}));


console.log("LISTA RESERVAS DTO ENVIADA:", listaReservasDTO);
console.log("JSON enviado:", JSON.stringify(listaReservasDTO, null, 2));
         try {
            const response = await fetch("http://localhost:8080/reservas", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(listaReservasDTO),
            });

            if (!response.ok) {
              throw new Error("Error al registrar reservas");
            }

             setMostrarCartel(true);

         }
          catch (err) {
            console.error(err);
            alert("Hubo un error al generar el listado.");
          }





    //CUANDO LOS DATOS SON CORRECTOS QUE TIENE QUE PASAR?
    //aqui iria la logica para confirmar la reserva, como llamar a una api o algo
  };


  const seleccion = useMemo(() => {
    try {
      return JSON.parse(raw);
    } catch {
      return [];
    }
  }, [raw]);
  
  
    function generarRangos(seleccionados: string[]) {
      const datos = seleccionados.map(sel => {
        const [fecha, numero] = sel.split("|");
        return {
          fecha: fecha,
          fechaDate: parseISO(fecha),
          numero: Number(numero)
        };
      });
  
      datos.sort((a, b) => {
        if (a.numero !== b.numero) return a.numero - b.numero;
        return a.fechaDate.getTime() - b.fechaDate.getTime();
      });
  
      const resultado: any[] = [];
      let actual = null;
  
      for (let item of datos) {
        if (!actual) {
          actual = { numero: item.numero, desde: item.fecha, hasta: item.fecha };
          continue;
        }
  
        const esMismaHab = item.numero === actual.numero;
        const diffDias =
          (item.fechaDate.getTime() - parseISO(actual.hasta).getTime()) /
          (1000 * 60 * 60 * 24);
  
        if (esMismaHab && diffDias === 1) {
          actual.hasta = item.fecha;
        } else {
          resultado.push(actual);
          actual = { numero: item.numero, desde: item.fecha, hasta: item.fecha };
        }
      }
      if (actual) resultado.push(actual);
      return resultado;
    }
  
    useEffect(() => {
      const nuevosRangos = generarRangos(seleccion);
      setRangos(nuevosRangos);
    }, [seleccion]);
  
  

  return (
    <main className="p-10">
  {mostrarCartel && (
    <ReservaConfirmada onClose={() => setMostrarCartel(false)} />
  )}
      <h2 className="text-2xl font-bold text-indigo-950 mb-6">
        Datos del Hu√©sped
      </h2>

      {/* CONTENEDOR A DOS COLUMNAS */}
      <div className="flex gap-10">

        {/* IZQUIERDA - FORMULARIO */}
        <form onSubmit={handleSubmit} className="flex flex-col justify-center flex-1 max-w-md">
          
          
            <label className="text-indigo-950 font-medium mb-1">Nombre:</label>
            <input 
                type="text"
                placeholder="Nombre"
                value={nombre}
                onChange={(e) => {
                    const valor = e.target.value.toUpperCase();
                    setNombre(valor);
                    setErrorNombreObligatorio(!esObligatorio(valor)); // limpia si escribe algo
                }}
                className={`p-2 border rounded mb-1 placeholder-gray-400 text-indigo-950 
                    ${errorNombre || errorNombreObligatorio ? "border-red-500" : ""}`}
            />
            {errorNombre && (
                <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>
            )}
            {errorNombreObligatorio && (
                <p className="text-red-500 text-sm mb-3">El nombre es obligatorio.</p>
            )}
            
            <label className="text-indigo-950 font-medium mb-1">Apellido:</label>
            <input 
                type="text"
                placeholder="Apellido"
                value={apellido}
                onChange={(e) => {
                    const valor = e.target.value.toUpperCase();
                    setApellido(valor);
                    setErrorApellidoObligatorio(!esObligatorio(valor)); // limpia si escribe algo
                }}
                className={`p-2 border rounded mb-1 placeholder-gray-400 text-indigo-950 
                    ${errorApellido || errorApellidoObligatorio ? "border-red-500" : ""}`}
            />
            {errorApellido && (
                <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>
            )}
            {errorApellidoObligatorio && (
                <p className="text-red-500 text-sm mb-3">El apellido es obligatorio.</p>
            )}  
            <label className="text-indigo-950 font-medium mb-1">Tel√©fono:</label>
            <input 
                type="text"
                placeholder="Tel√©fono"
                value={telefono}
                onChange={(e) => {
                    const valor = e.target.value.toUpperCase();
                    setTelefono(valor);
                    setErrorTelefonoObligatorio(!esObligatorio(valor)); // limpia si escribe algo
                }}
                className={`p-2 border rounded mb-1 placeholder-gray-400 text-indigo-950 
                    ${errorTelefono || errorTelefonoObligatorio ? "border-red-500" : ""}`}
            />
            {errorTelefono && (
                <p className="text-red-500 text-sm mb-3">Ingrese telefono valido.</p>
            )}
            {errorTelefonoObligatorio && (
                <p className="text-red-500 text-sm mb-3">El tel√©fono es obligatorio.</p>
            )}
         {/* BOT√ìN CENTRADO */}
           <div className="w-full flex justify-center">
             <button
               className="mt-6 px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800"
               type="submit"

               >
               Confirmar Reserva
             </button>
           </div>
        </form>

        {/* DERECHA - TABLA */}
        <div className="flex-1">
          <h3 className="text-xl font-bold mb-4 text-indigo-950">
            Habitaciones Seleccionadas
          </h3>

          <table className="w-full border-collapse border shadow-lg">
            <thead className="bg-indigo-950 text-white">
              <tr>
                <th className="p-3 border">Habitaci√≥n</th>
                <th className="p-3 border">Fecha Desde</th>
                <th className="p-3 border">Fecha Hasta</th>
              </tr>
            </thead>

            <tbody>
              {rangos.map((ran,index) => {

                return (
                  <tr key={index}>
                    <td className="p-3 border text-center">{ran.numero}</td>
                    <td className="p-3 border text-center">
                      {format(parseISO(ran.desde), "dd/MM/yyyy")}
                    </td>
                    <td className="p-3 border text-center">
                      {format(parseISO(ran.hasta), "dd/MM/yyyy")}
                    </td>

                  </tr>
                );
              })}
            </tbody>
          </table>



        </div>

      </div>

    </main>
  );
}
//[darAltaHuesped/page.tsx]
"use client";
import { useState } from "react"; 
import CancelarAltaHuepsed from "../carteles/cancelarAltaHuesped";
import CargarOtroHuesped from "../carteles/huespedCargadoSatisfacoriamente";
import ErrorDniExistente from "../carteles/errorDniExistente";
import axios from "axios";
import { validarFormularioHuesped } from "../validaciones/validaciones";



export default function DarAltaHuesped(){
    
    const [openCancelar, setOpenCancelar] = useState(false);
    const [openAceptar, setOpenAceptar] = useState(false);
    const [openError, setOpenError] = useState(false);
    const [mensajeError, setMensajeError] = useState("");

    const initialState = {
        apellido: "",
        nombre: "",
        tipoDocumento: "",
        dni: "",
        cuit: "",
        posicionIva: "",
        calle: "",
        numero: "",
        departamento: "",
        piso: "",
        codigoPostal: "",
        localidad: "",
        provincia: "",
        pais: "",
        fechaNacimiento: "",
        telefono: "",
        email: "",
        ocupacion: "",
        nacionalidad: "",
    };

    const [formData, setFormData] = useState(initialState);
    const [errores, setErrores] = useState<string[]>([]);
    const [erroresTipo, setErroresTipo] = useState<string[]>([]);


    const nuevoHuesped = () => {
        setFormData(initialState);
        setErrores([]);
        setErroresTipo([]);
    };


    const handleBlur = (e: React.FocusEvent<HTMLInputElement | HTMLSelectElement>) => {
        const { name } = e.target;

        // Ejecutamos validaci√≥n completa con los datos actuales
        const { errores, erroresTipo } = validarFormularioHuesped(formData);

        // NO BORRAR SIEMPRE
        setErrores(prev => prev.filter(campo => campo !== name));
        setErroresTipo(prev => prev.filter(campo => campo !== name));

        // ‚úî BORRAR SOLO SI AHORA EST√Å VALIDADO
        if (!errores.includes(name)) {
            setErrores(prev => prev.filter(campo => campo !== name));
        }
        if (!erroresTipo.includes(name)) {
            setErroresTipo(prev => prev.filter(campo => campo !== name));
        }

        // ‚úî AGREGAR SI AHORA DA ERROR
        if (errores.includes(name)) {
            setErrores(prev => [...prev.filter(c => c !== name), name]);
        }
        if (erroresTipo.includes(name)) {
            setErroresTipo(prev => [...prev.filter(c => c !== name), name]);
        }
    };

    const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    
        const { name, value } = e.target;
        const valorMayus = value.toUpperCase();

        setFormData({ ...formData, [name]: valorMayus });

    };

    


    const getInputClass = (campo: string) => {
        const baseClass = "p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950 uppercase";
        if (errores.includes(campo) || erroresTipo.includes(campo)) {
            return `${baseClass} border-red-500 border-2`;
        }
        return baseClass;
    };

    const guardarHuesped = async () => {

        const payload = {
            huespedID: {
                tipoDocumento: formData.tipoDocumento,
                dni: formData.dni,
            },
            nombre: formData.nombre,
            apellido: formData.apellido,
            cuit: formData.cuit,
            posicionIva: formData.posicionIva,
            fechaNacimiento: formData.fechaNacimiento, 
            telefono: formData.telefono,
            email: formData.email, 
            ocupacion: formData.ocupacion,
            nacionalidad: formData.nacionalidad,
            direccion: {
                calle: formData.calle,
                numero: formData.numero ? parseInt(formData.numero) : null,
                departamento: formData.departamento,
                piso: formData.piso ? parseInt(formData.piso) : null,
                codigoPostal: formData.codigoPostal ? parseInt(formData.codigoPostal) : null,
                localidad: formData.localidad,
                provincia: formData.provincia,
                pais: formData.pais,
            },
        };

        try {
            await axios.post("http://localhost:8080/huespedes", payload);
            setErrores([]);
            setErroresTipo([]);
            setOpenAceptar(true);
        } catch (err) {
            console.error("Error al guardar:", err);
            alert("Error al conectar con el servidor.");
        }
    };

    const handleGuardarSinValidarDni = async () => {
        setOpenError(false);
        setErrores([]);
        await guardarHuesped();
    };


    const handleSubmit = async () => {
        
        const { errores, erroresTipo } = validarFormularioHuesped(formData);

        setErrores(errores);       // SIEMPRE
        setErroresTipo(erroresTipo); // SIEMPRE

        // ‚ùó solo evitar env√≠o si hay errores
        if (errores.length > 0 || erroresTipo.length > 0) {
            return;
        }

        // ‚≠ê PASO EXTRA: Verificar DNI existente en el backend
        try {
            const existe = await axios.get("http://localhost:8080/huespedes", {
                params: {
                    dni: formData.dni,
                    tipoDocumento: formData.tipoDocumento
                }
            });

            if (existe.data.length > 0) {
                setMensajeError("¬°CUIDADO!");
                setOpenError(true);
                return;
            }

        } catch (error) {
            console.error("Error verificando DNI:", error);
            setMensajeError("Error verificando si el hu√©sped existe.");
            setOpenError(true);
            return;
        }

        // ‚≠ê Si todo est√° OK, guardar
        await guardarHuesped();
    };




    return(
        <main className="flex gap-80 px-6 py-6 items-start justify-center"> 

            {/* FORM 1 */}
            <form className="flex flex-col">
                <label className="text-indigo-950 font-medium mb-1">Apellido*:</label>
                <input name="apellido" value={formData.apellido} onChange={handleChange} type="text" placeholder="Apellido" className={ getInputClass("apellido")} onBlur={handleBlur}/>
                {erroresTipo.includes("apellido") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>
                )}

                <label className="text-indigo-950 font-medium mb-1">Nombre*:</label>
                <input name="nombre" value={formData.nombre} onChange={handleChange} type="text" placeholder="Nombre" className={getInputClass("nombre")} onBlur={handleBlur}/>
                {erroresTipo.includes("nombre") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>
                )}
                
                <label className="text-indigo-950 font-medium mb-1">Tipo de Documento*:</label>
                <select 
                    name="tipoDocumento" 
                    value={formData.tipoDocumento} 
                    onChange={handleChange} 
                    onBlur={handleBlur}
                    className={getInputClass("tipoDocumento")
                        .replace("placeholder-gray-400", "text-gray-400")
                        .replace("text-indigo-950", "focus:text-indigo-950")
                        .replace("uppercase", "")}
                >
                    <option value="" className="text-gray-400">Seleccionar tipo</option>
                    <option value="DNI">DNI</option>
                    <option value="PASAPORTE">PASAPORTE</option>
                    <option value="CUIT">CUIT</option>
                </select>

                <label className="text-indigo-950 font-medium mb-1">N√∫mero de Documento*:</label>
                <input name="dni" value={formData.dni} onChange={handleChange} type="text" placeholder="N√∫mero de Documento" className={getInputClass("dni")} onBlur={handleBlur}/>
                {erroresTipo.includes("dni") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese un dni valido.</p>
                )}
                
                <label className="text-indigo-950 font-medium mb-1">CUIT:</label>
                <input name="cuit" value={formData.cuit} onChange={handleChange} type="text" placeholder="XX-XXXXXXXX-X" className={getInputClass("cuit")} onBlur={handleBlur}/>
                {erroresTipo.includes("cuit") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese un cuit.</p>
                )}

                <label className="text-indigo-950 font-medium mb-1">Posicion frente al IVA*:</label>
                <input name="posicionIva" value={formData.posicionIva} onChange={handleChange} type="text" placeholder="Ej: RESPONSABLE INSCRIPTO" className={getInputClass("posicionIva")} onBlur={handleBlur} />
                {erroresTipo.includes("posicionIva") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>
                )}
                <p className="mt-3">Campos obligatorios*</p>
            </form>

            {/* FORM 2 */}
            <form className="flex flex-col">
                <label className="text-indigo-950 font-medium mb-1">Calle*:</label>
                <input name="calle" value={formData.calle} onChange={handleChange} type="text" placeholder="calle" className={getInputClass("calle")} onBlur={handleBlur}/>
                {erroresTipo.includes("calle") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>
                )}

                <label className="text-indigo-950 font-medium mb-1">N√∫mero*:</label>
                <input name="numero" value={formData.numero} onChange={handleChange} type="text" placeholder="numero" className={getInputClass("numero")} onBlur={handleBlur}/>
                {erroresTipo.includes("numero") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese solo n√∫meros.</p>
                )}

                <label className="text-indigo-950 font-medium mb-1">Departamento:</label>
                <input name="departamento" value={formData.departamento} onChange={handleChange} type="text" placeholder="departamento" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950 uppercase" onBlur={handleBlur}/>
                {erroresTipo.includes("departamento") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>
                )}

                <label className="text-indigo-950 font-medium mb-1">Piso:</label>
                <input name="piso" value={formData.piso} onChange={handleChange} type="text" placeholder="piso" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950 uppercase" onBlur={handleBlur} />
                {erroresTipo.includes("piso") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese solo n√∫meros.</p>
                )}

                <label className="text-indigo-950 font-medium mb-1">C√≥digo Postal*:</label>
                <input name="codigoPostal" value={formData.codigoPostal} onChange={handleChange} type="text" placeholder="codigo postal" className={getInputClass("codigoPostal")} onBlur={handleBlur} />
                {erroresTipo.includes("codigoPostal") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese solo n√∫meros.</p>
                )}

                <label className="text-indigo-950 font-medium mb-1">Localidad*:</label>
                <input name="localidad" value={formData.localidad} onChange={handleChange} type="text" placeholder="localidad" className={getInputClass("localidad")} onBlur={handleBlur}/>
                {erroresTipo.includes("localidad") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>
                )}

                <label className="text-indigo-950 font-medium mb-1">Provincia*:</label>
                <input name="provincia" value={formData.provincia} onChange={handleChange} type="text" placeholder="provincia" className={getInputClass("provincia")} onBlur={handleBlur}/>
                {erroresTipo.includes("provincia") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>
                )}

                <label className="text-indigo-950 font-medium mb-1">Pa√≠s*:</label>
                <input name="pais" value={formData.pais} onChange={handleChange} type="text" placeholder="pais" className={getInputClass("pais")} onBlur={handleBlur}/>
                {erroresTipo.includes("pais") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>
                )}

            </form>

            {/* FORM 3 */}
            <form className="flex flex-col">
                <label className="text-indigo-950 font-medium mb-1">Fecha de nacimiento*:</label>
                <input name="fechaNacimiento" value={formData.fechaNacimiento} onChange={handleChange} type="date" className={getInputClass("fechaNacimiento")} onBlur={handleBlur}/>
                {erroresTipo.includes("fechaNacimiento") && (
                    <p className="text-red-500 text-sm mb-3">Fecha inv√°lida.</p>
                )}

                <label className="text-indigo-950 font-medium mb-1">Tel√©fono*:</label>
                <input name="telefono" value={formData.telefono} onChange={handleChange} type="text" placeholder="telefono" className={getInputClass("telefono")} onBlur={handleBlur} />
                {erroresTipo.includes("telefono") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese Telefono valido.</p>
                )}

                <label className="text-indigo-950 font-medium mb-1">Email:</label>
                <input name="email" value={formData.email} onChange={handleChange} type="text" placeholder="email" className={getInputClass("email")} onBlur={handleBlur}/>
                {erroresTipo.includes("email") && (
                    <p className="text-red-500 text-sm mb-3">Email inv√°lido.</p>
                )}
                <label className="text-indigo-950 font-medium mb-1">Ocupaci√≥n*:</label>
                <input name="ocupacion" value={formData.ocupacion} onChange={handleChange} type="text" placeholder="ocupacion" className={getInputClass("ocupacion")} onBlur={handleBlur}/>
                {erroresTipo.includes("ocupacion") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>
                )}

                <label className="text-indigo-950 font-medium mb-1">Nacionalidad*:</label>
                <input name="nacionalidad" value={formData.nacionalidad} onChange={handleChange} type="text" placeholder="nacionalidad" className={getInputClass("nacionalidad")} onBlur={handleBlur}/>
                {erroresTipo.includes("nacionalidad") && (
                    <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>
                )}

                <div className="flex flex-row gap-3 items-center">   

                    <button 
                        type="button" 
                        className="px-4 py-2 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
                        onClick={() => setOpenCancelar(true)}
                    >
                        Cancelar
                    </button>

                    <button 
                        type="button" 
                        className="px-4 py-2 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
                        onClick={handleSubmit}
                    >
                        Aceptar
                    </button>

                </div>
            </form>

            {/* CARTEL DE CANCELAR */}
            {openCancelar && (
                <CancelarAltaHuepsed onClose={() => setOpenCancelar(false)} />
            )}

            {/* CARTEL DE √âXITO */}
            {openAceptar && (
                <CargarOtroHuesped
                    onClose={() => setOpenAceptar(false)}
                    onNuevo={nuevoHuesped}
                    nombre={formData.nombre}
                    apellido={formData.apellido}
                />
            )}

            {/* CARTEL DE ERROR */}
            {openError && (
                <ErrorDniExistente
                    mensaje={mensajeError}
                    onCorregir={() => {
                        setErrores(["tipoDocumento", "dni"]); 
                        setOpenError(false);
                    }}
                    onAceptar={handleGuardarSinValidarDni}
                />
            )}

        </main>
    );
}
//[darBajaHuesped/page.tsx]
"use client";
import { useState } from "react";
import EliminarHuesped from "../carteles/eliminarHuesped";
import NoSePuedeEliminarHuesped from "../carteles/noSePuedeEliminarHUesped";

export default function DarBajaHuesped(){
    const [openAceptar, setOpenAceptar] = useState(false);
    return(
        <main className="flex gap-80 px-6 py-6 items-start justify-center"> 

            <form className="flex flex-col">

                <label className="text-indigo-950 font-medium mb-1">Apellido*:</label>
                <input type="text" placeholder="Apellido" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />

                <label className="text-indigo-950 font-medium mb-1">Nombre*:</label>
                <input type="text" placeholder="Nombre" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />

                <label className="text-indigo-950 font-medium mb-1">Tipo de Documento*:</label>
                <select name="tipoDocumento" defaultValue="" className="p-2 border rounded mb-4 text-gray-400 focus:text-indigo-950">
                    <option value="" className="text-gray-400">Seleccionar tipo</option>
                    <option value="DNI">DNI</option>
                    <option value="Pasaporte">Pasaporte</option>
                    <option value="CUIT">CUIT</option>
                </select>

                <label className="text-indigo-950 font-medium mb-1">N√∫mero de Documento*:</label>
                <input type="text" placeholder="N√∫mero de Documento" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />

                <label className="text-indigo-950 font-medium mb-1">CUIT*:</label>
                <input type="text" placeholder="XX-XXXXXXXX-X" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />
                
                <label className="text-indigo-950 font-medium mb-1">Posicion frente al IVA*:</label>
                <input type="text" placeholder="N√∫mero de Documento" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />
                <p className="mt-3">campos a completar obligatorio*</p>
            </form>

            <form className="flex flex-col">
                <label className="text-indigo-950 font-medium mb-1">Calle*:</label>
                <input type="text" placeholder="calle" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />

                <label className="text-indigo-950 font-medium mb-1">Numero*:</label>
                <input type="text" placeholder="numero" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />

                <label className="text-indigo-950 font-medium mb-1">Departamento:</label>
                <input type="text" placeholder="departamento" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />

                <label className="text-indigo-950 font-medium mb-1">Piso</label>
                <input type="text" placeholder="piso" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />

                <label className="text-indigo-950 font-medium mb-1">Codigo Postal*:</label>
                <input type="text" placeholder="codigo postal" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />
                
                <label className="text-indigo-950 font-medium mb-1">Localidad*:</label>
                <input type="text" placeholder="localidad" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />

                <label className="text-indigo-950 font-medium mb-1">Provincia*:</label>
                <input type="text" placeholder="provincia" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />
                
                <label className="text-indigo-950 font-medium mb-1">Pais*:</label>
                <input type="text" placeholder="pais" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />
            </form>
            
            <form className="flex flex-col">

                <label className="text-indigo-950 font-medium mb-1">Fecha de nacimiento*:</label>
                <input type="date"  placeholder="fecha de nacimiento" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />

                <label className="text-indigo-950 font-medium mb-1">Telefono*:</label>
                <input type="text" placeholder="telefono" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />

                <label className="text-indigo-950 font-medium mb-1">Email*:</label>
                <input type="text" placeholder="email" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />

                <label className="text-indigo-950 font-medium mb-1">Ocupacion:</label>
                <input type="text" placeholder="ocupacion" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />

                <label className="text-indigo-950 font-medium mb-1">Nacionalidad:</label>
                <input type="text" placeholder="nacionalidad" className="p-2 border rounded mb-4 placeholder-gray-400 text-indigo-950" />
                
                <div className="flex flex-row gap-3 items-center">   
                    
                {/* BOTON PARA ABRIR EL CARTEL DE FACTURAR A UN TERCERO */}
                    <button type="button" className="px-4 py-2 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition">Cancelar</button>
            

                    <button type="button" className="px-4 py-2 bg-indigo-950 text-white rounded-md hover:bg-indigo-800 transition"
                        onClick={() => 
                            setOpenAceptar(true)
                        } 
                        >
                            Eliminar
                        </button>
                        {/* MOSTRAR CARTEL SOLO SI open === true */}
                        {openAceptar && (
                            /*<EliminarHuesped onClose={() => setOpenAceptar(false)} />*/
                            <NoSePuedeEliminarHuesped onClose={() => setOpenAceptar(false)} />
                        )}


                </div>
            </form>

        </main>
    );
}
//[facturar/completarFactura/page.tsx]
"use client";
import { it } from "node:test";
import { useState } from "react";

export default function CompletarFactura() {
    const items = [
        { label: 'Valor de la Estad√≠a', price: 10000 },
        { label: 'Consumos de la Habitaci√≥n', price: 500 },
        { label: 'Lavado y Planchado', price: 500 },
        { label: 'Sauna', price: 10000 },
        { label: 'Bar', price: 0 },
    ];
    const [seleccionarItems, itemsSeleccionados] = useState<number[]>([]);
    const CuentaTotal = (index: number) => {
            itemsSeleccionados((prev) => {
            if (prev.includes(index)) {
                // Si ya estaba seleccionado ‚Üí lo saco
                return prev.filter(i => i !== index);
            } else {
                // Si no estaba ‚Üí lo agrego
                return [...prev, index];
            }
        });
    };
      // Calcular total din√°mico
    const total = seleccionarItems.reduce((acc, index) => acc + items[index].price, 0);
    return (
        <main className=" flex flex-col px-6 py-6">
            <section className="text-left flex flex-col gap-4">
                <strong className=" ">Razon social: se completa con los datos de la BDD</strong>
                <strong className=" ">Tipo de factura: Supongo que el tipo de factura esta en la base de datos?</strong>
            </section>

            <section className="text-center mt-4">
                <strong className=" ">Selecciona los items a facturar:</strong>
                <div className="flex flex-col items-center mt-4">
                    {items.map((item, index) => (
                        <label key={index} className="flex justify-between items-center mb-2">
                            <div className="flex text-center gap-2">
                                <input type="checkbox" className="form-checkbox" checked={seleccionarItems.includes(index)} onChange={() => CuentaTotal(index)}/>
                                <span className="text-center">{item.label}</span>
                            </div>
                            <span className="font-medium">${item.price}</span>
                        </label>
                    ))}
                </div>
                <div className="mt-4 text-xl font-bold">
                    total del monto a pagar: ${total}
                </div>
                <button className="block mx-auto mt-6 px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition">Aceptar</button>
            </section>
        </main>
    );
}
//[facturar/page.tsx]
'use client';

import React, { useState } from "react";
import { useRouter } from "next/navigation";
import Link from "next/link";
import axios from "axios";
import { TipoHuesped } from "../tabla/page";
import FacturarUnTerceroModal from "../carteles/facturarUnTercero";
import MenorEdad from "../carteles/menorEdad";
import { esSoloNumeros, validarCUIT } from "../validaciones/validaciones";

interface Consumo {
    id: number;
    descripcion: string;
    precio: number;
    fecha: string;
}

interface Estadia {
    id_estadia: number;
    checkin: string;
    checkout: string;
    precioTotal: number;
}

interface ItemFacturar {
    id: number;
    tipo: 'estadia' | 'consumo';
    descripcion: string;
    precio: number;
    estadiaId?: number;
}

export default function Facturar() {
    const router = useRouter();
    
    // Estados del formulario
    const [nroHabitacion, setNroHabitacion] = useState("");
    const [horaSalida, setHoraSalida] = useState("");
    
    // Estados de errores
    const [errores, setErrores] = useState<string[]>([]);
    const [errorNroHabitacion, setErrorNroHabitacion] = useState(false);
    const [errorHoraSalida, setErrorHoraSalida] = useState(false);
    
    // Estados de datos
    const [huespedes, setHuespedes] = useState<TipoHuesped[]>([]);
    const [huespedSeleccionado, setHuespedSeleccionado] = useState<TipoHuesped | null>(null);
    const [estadia, setEstadia] = useState<Estadia | null>(null);
    const [consumos, setConsumos] = useState<Consumo[]>([]);
    const [itemsFacturar, setItemsFacturar] = useState<ItemFacturar[]>([]);
    const [itemsSeleccionados, setItemsSeleccionados] = useState<number[]>([]);
    
    // Estados de UI
    const [mostrarTabla, setMostrarTabla] = useState(false);
    const [mostrarItems, setMostrarItems] = useState(false);
    const [mostrarTercero, setMostrarTercero] = useState(false);
    const [mostrarMenorEdad, setMostrarMenorEdad] = useState(false);
    
    // Estado del responsable de pago
    const [responsablePago, setResponsablePago] = useState<{
        id: number;
        nombre: string;
        tipoFactura: 'A' | 'B';
        esTercero: boolean;
    } | null>(null);
    
    // Estado de factura generada
    const [facturaGenerada, setFacturaGenerada] = useState<any>(null);

    // Validar n√∫mero de habitaci√≥n
    const validarNroHabitacion = (valor: string) => {
        if (!valor.trim()) {
            setErrorNroHabitacion(true);
            return false;
        }
        if (!esSoloNumeros(valor)) {
            setErrorNroHabitacion(true);
            return false;
        }
        setErrorNroHabitacion(false);
        return true;
    };

    // Validar hora de salida
    const validarHoraSalida = (valor: string) => {
        if (!valor.trim()) {
            setErrorHoraSalida(true);
            return false;
        }
        // Validar formato de hora (HH:MM)
        const horaRegex = /^([0-1][0-9]|2[0-3]):[0-5][0-9]$/;
        if (!horaRegex.test(valor)) {
            setErrorHoraSalida(true);
            return false;
        }
        setErrorHoraSalida(false);
        return true;
    };

    // Calcular edad
    const calcularEdad = (fechaNacimiento: string): number => {
        const hoy = new Date();
        const nacimiento = new Date(fechaNacimiento);
        let edad = hoy.getFullYear() - nacimiento.getFullYear();
        const mes = hoy.getMonth() - nacimiento.getMonth();
        if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) {
            edad--;
        }
        return edad;
    };

    // Buscar ocupantes de la habitaci√≥n
    const buscarHuespedes = async (e: React.FormEvent) => {
        e.preventDefault();
        
        const erroresLista: string[] = [];
        
        // Validar campos
        if (!validarNroHabitacion(nroHabitacion)) {
            erroresLista.push("N√∫mero de habitaci√≥n faltante o incorrecto");
        }
        if (!validarHoraSalida(horaSalida)) {
            erroresLista.push("Hora de salida faltante o incorrecta");
        }
        
        if (erroresLista.length > 0) {
            setErrores(erroresLista);
            // Enfocar en el primer campo con error
            if (!nroHabitacion.trim() || !esSoloNumeros(nroHabitacion)) {
                document.querySelector<HTMLInputElement>('input[name="nroHabitacion"]')?.focus();
            } else {
                document.querySelector<HTMLInputElement>('input[name="horaSalida"]')?.focus();
            }
            return;
        }

        setErrores([]);

        try {
            // Buscar estad√≠a en curso de la habitaci√≥n (incluye hu√©spedes y consumos)
            const responseEstadia = await axios.get(`http://localhost:8080/estadias/enCurso/${nroHabitacion}`);
            
            if (!responseEstadia.data) {
                setErrores(["La habitaci√≥n no est√° ocupada"]);
                return;
            }

            const estadiaData = responseEstadia.data;
            
            // Console log: datos recibidos del backend
            console.log("=== DATOS RECIBIDOS DEL BACKEND ===");
            console.log("Estad√≠a completa:", JSON.stringify(estadiaData, null, 2));
            console.log("=====================================");

            // Extraer hu√©spedes de la estad√≠a
            const huespedesData = estadiaData.listahuesped || [];
            if (huespedesData.length === 0) {
                setErrores(["La habitaci√≥n no tiene hu√©spedes asignados"]);
                return;
            }

            // Mapear hu√©spedes al formato TipoHuesped
            const huespedesMapeados: TipoHuesped[] = huespedesData.map((h: any) => {
                // Console log para ver qu√© datos vienen del hu√©sped
                console.log("Datos completos del hu√©sped recibidos:", JSON.stringify(h, null, 2));
                
                return {
                    id: h.id || 0,
                    nombre: h.nombre || "",
                    apellido: h.apellido || "",
                    fechaNacimiento: h.fechaNacimiento || "",
                    nacionalidad: h.nacionalidad || "",
                    ocupacion: h.ocupacion || "",
                    email: h.email || "",
                    telefono: h.telefono || "",
                    direccionHuesped: h.direccion || {},
                    cuit: h.cuit || "",
                    posicionIva: h.posicionIva || "CF",
                    huespedID: {
                        tipoDocumento: h.huespedID?.tipoDocumento || h.tipoDocumento || "",
                        dni: h.huespedID?.dni || h.dni || ""
                    },
                    // Guardar datos adicionales que puedan venir (como responsablePagoId)
                    responsablePagoId: h.responsablePagoId || h.responsablePago?.id || null
                } as any;
            });

            setHuespedes(huespedesMapeados);
            setMostrarTabla(true);
            setMostrarItems(false);
            setHuespedSeleccionado(null);
            setResponsablePago(null);

            // Guardar estad√≠a
            // El precio puede venir en diferentes campos o calcularse despu√©s
            const precioEstadia = estadiaData.precioTotal || estadiaData.precio || 0;
            setEstadia({
                id_estadia: estadiaData.id_estadia || estadiaData.id,
                checkin: estadiaData.checkin,
                checkout: estadiaData.checkout || null,
                precioTotal: precioEstadia
            });

            // Extraer consumos de la estad√≠a
            const consumosData = estadiaData.listaconsumos || [];
            const consumosMapeados: Consumo[] = consumosData.map((c: any, index: number) => ({
                id: c.id || index + 1,
                descripcion: c.descripcion || `Consumo ${index + 1}`,
                precio: c.price || c.precio || 0,
                fecha: c.fecha || new Date().toISOString().split('T')[0]
            }));

            setConsumos(consumosMapeados);
            
            // Console log: datos procesados
            console.log("=== DATOS PROCESADOS ===");
            console.log("Hu√©spedes mapeados:", huespedesMapeados.length);
            console.log("Consumos mapeados:", consumosMapeados.length);
            console.log("Estad√≠a guardada:", {
                id_estadia: estadiaData.id_estadia || estadiaData.id,
                checkin: estadiaData.checkin,
                checkout: estadiaData.checkout,
                precioTotal: precioEstadia
            });
            console.log("========================");

        } catch (error: any) {
            console.error("Error al buscar estad√≠a:", error);
            if (error.response?.status === 404) {
                setErrores(["La habitaci√≥n no est√° ocupada"]);
            } else {
                setErrores(["Error al cargar los datos de la habitaci√≥n"]);
            }
        }
    };

    // Seleccionar responsable de pago
    const seleccionarResponsable = async (huesped: TipoHuesped) => {
        // Validar edad primero
        if (huesped.fechaNacimiento) {
            const edad = calcularEdad(huesped.fechaNacimiento);
            if (edad < 18) {
                setMostrarMenorEdad(true);
                return;
            }
        }
        
        setHuespedSeleccionado(huesped);

        // Buscar responsable de pago por DNI y tipo de documento
        try {
            const response = await axios.get(`http://localhost:8080/responsablesPago`, {
                params: {
                    dni: huesped.huespedID.dni,
                    tipoDocumento: huesped.huespedID.tipoDocumento
                }
            });

            // El backend devuelve {"id": 5}
            if (response.data && response.data.id) {
                const responsableId = response.data.id;
                
                // Si se eligi√≥ un hu√©sped ‚Üí tipo A
                setResponsablePago({
                    id: responsableId,
                    nombre: `${huesped.nombre} ${huesped.apellido}`,
                    tipoFactura: 'A',
                    esTercero: false
                });

                // Preparar items para facturar
                prepararItems();
            }
        } catch (error: any) {
            // Si no se encuentra (404), abrir p√°gina de alta en nueva ventana
            if (error.response?.status === 404) {
                window.open('/altaResponsableDePago', '_blank');
                setErrores(["El responsable de pago no existe. Se abri√≥ la p√°gina para darlo de alta."]);
            } else {
                console.error("Error al buscar responsable de pago:", error);
                setErrores(["Error al buscar el responsable de pago"]);
            }
        }
    };

    // Preparar items a facturar
    const prepararItems = () => {
        const items: ItemFacturar[] = [];
        
        // Agregar estad√≠a si existe
        if (estadia && estadia.id_estadia) {
            const checkoutDisplay = estadia.checkout || "En curso";
            items.push({
                id: 1,
                tipo: 'estadia',
                descripcion: `Estad√≠a (${estadia.checkin} - ${checkoutDisplay})`,
                precio: estadia.precioTotal || 0, // Si no hay precio, se puede calcular o mostrar 0
                estadiaId: estadia.id_estadia
            });
        }

        // Agregar consumos pendientes (solo los que no est√©n facturados)
        consumos.forEach((consumo, index) => {
            // Asumimos que todos los consumos est√°n pendientes
            // Si el backend marca cu√°les est√°n facturados, filtrar aqu√≠
            items.push({
                id: items.length + 1,
                tipo: 'consumo',
                descripcion: consumo.descripcion || `Consumo ${index + 1}`,
                precio: consumo.precio || 0,
            });
        });

        setItemsFacturar(items);
        setItemsSeleccionados(items.map(item => item.id)); // Seleccionar todos por defecto
        setMostrarItems(true);
    };

    // Manejar facturaci√≥n a tercero
    const handleFacturarTercero = (cuit: string, razonSocial: string) => {
        setMostrarTercero(false);
        
        // Buscar responsable de pago por CUIT
        axios.get(`http://localhost:8080/responsablesPago`, {
            params: { cuit: cuit.trim() }
        }).then(response => {
            // El backend devuelve {"id": 10}
            if (response.data && response.data.id) {
                setResponsablePago({
                    id: response.data.id,
                    nombre: razonSocial,
                    tipoFactura: 'B', // Si se puso nombre de tercero con CUIT ‚Üí tipo B
                    esTercero: true
                });
                prepararItems();
            }
        }).catch(error => {
            // Si no se encuentra (404), abrir p√°gina de alta en nueva ventana
            if (error.response?.status === 404) {
                window.open('/altaResponsableDePago', '_blank');
                setErrores(["El responsable de pago no existe. Se abri√≥ la p√°gina para darlo de alta."]);
            } else {
                console.error("Error al buscar responsable:", error);
                setErrores(["Error al buscar el responsable de pago"]);
            }
        });
    };

    // Toggle selecci√≥n de item
    const toggleItem = (itemId: number) => {
        setItemsSeleccionados(prev => 
            prev.includes(itemId) 
                ? prev.filter(id => id !== itemId)
                : [...prev, itemId]
        );
    };

    // Calcular total
    const calcularTotal = (): number => {
        return itemsSeleccionados.reduce((total, itemId) => {
            const item = itemsFacturar.find(i => i.id === itemId);
            return total + (item?.precio || 0);
        }, 0);
    };

    // Calcular IVA
    const calcularIVA = (): number => {
        if (!responsablePago || responsablePago.tipoFactura === 'B') {
            return 0;
        }
        return calcularTotal() * 0.21; // 21% IVA
    };

    // Generar factura
    const generarFactura = async () => {
        if (itemsSeleccionados.length === 0) {
            setErrores(["Debe seleccionar al menos un √≠tem para facturar"]);
            return;
        }

        if (!responsablePago || !estadia) {
            setErrores(["Faltan datos para generar la factura"]);
            return;
        }

        // Obtener IDs de consumos seleccionados
        const consumosIds: number[] = [];
        itemsSeleccionados.forEach(id => {
            const item = itemsFacturar.find(i => i.id === id);
            if (item?.tipo === 'consumo') {
                // Buscar el consumo original por descripci√≥n/precio
                const consumo = consumos.find(c => 
                    (c.descripcion === item.descripcion || item.descripcion.includes(c.descripcion)) && 
                    Math.abs(c.precio - item.precio) < 0.01
                );
                if (consumo && consumo.id) {
                    consumosIds.push(consumo.id);
                }
            }
        });

        // Construir fecha/hora de checkout
        const fechaCheckout = new Date().toISOString().split('T')[0];
        const fechaHoraCheckout = `${fechaCheckout}T${horaSalida}:00`;

        const facturaDTO = {
            tipo: responsablePago.tipoFactura,
            fechaHoraCheckoutReal: fechaHoraCheckout,
            consumosIds: consumosIds,
            estadia: {
                id_estadia: estadia.id_estadia
            },
            responsablepago: {
                id: responsablePago.id
            }
        };

        // Console log: datos que se env√≠an al backend
        console.log("==========================================");
        console.log("=== DTO DE FACTURA QUE SE ENV√çA AL BACKEND ===");
        console.log(JSON.stringify(facturaDTO, null, 2));
        console.log("==========================================");
        console.log("Estad√≠a actual:", JSON.stringify(estadia, null, 2));
        console.log("Consumos seleccionados IDs:", consumosIds);
        console.log("Items seleccionados:", itemsSeleccionados);
        console.log("Items facturar:", JSON.stringify(itemsFacturar, null, 2));
        console.log("Consumos disponibles:", JSON.stringify(consumos, null, 2));

        try {
            // Si la estad√≠a no tiene checkout, actualizarla primero
            if (estadia && !estadia.checkout) {
                console.log("=== ACTUALIZANDO ESTAD√çA CON CHECKOUT ===");
                const fechaCheckoutUpdate = new Date().toISOString().split('T')[0];
                try {
                    await axios.put(`http://localhost:8080/estadias/${estadia.id_estadia}`, {
                        checkout: fechaCheckoutUpdate
                    });
                    console.log("Estad√≠a actualizada con checkout:", fechaCheckoutUpdate);
                } catch (updateError: any) {
                    console.error("Error al actualizar estad√≠a:", updateError);
                    // Continuar de todas formas, el backend puede manejarlo
                }
            }

            const response = await axios.post("http://localhost:8080/facturas", facturaDTO);
            
            if (response.status === 200 || response.status === 201) {
                // Console log: factura recibida del backend
                console.log("=== FACTURA GENERADA POR EL BACKEND ===");
                console.log("Factura completa:", JSON.stringify(response.data, null, 2));
                console.log("========================================");
                
                // Guardar factura generada
                setFacturaGenerada(response.data);
                
                // Limpiar formulario pero mantener la factura visible
                setMostrarTabla(false);
                setMostrarItems(false);
            }
        } catch (error: any) {
            console.error("Error al generar factura:", error);
            if (error.response?.data) {
                console.error("Detalles del error del backend:", error.response.data);
                setErrores([error.response.data || "Error al generar la factura"]);
            } else {
                setErrores(["Error al generar la factura"]);
            }
        }
    };

    // Manejar Shift+Tab
    const handleKeyDownInput = (e: React.KeyboardEvent<HTMLInputElement>) => {
        if (e.key === "Tab" && e.shiftKey) {
            e.preventDefault();
            const form = e.currentTarget.form;
            if (form) {
                const inputs = Array.from(form.querySelectorAll("input"));
                const index = inputs.indexOf(e.currentTarget);
                if (index > 0) {
                    (inputs[index - 1] as HTMLElement).focus();
                }
            }
        }
    };

    // Manejar Enter en botones
    const handleKeyDown = (e: React.KeyboardEvent, action: () => void) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            action();
        }
    };

    return (
        <main className="flex gap-8 px-8 py-8 items-start bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
            <div className="w-full max-w-7xl mx-auto">
                {/* T√çTULO */}
                <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h1 className="text-3xl font-bold text-indigo-950 mb-2">Facturar</h1>
                    <p className="text-gray-600">Complete los datos para generar la factura de una habitaci√≥n</p>
                </div>

                {/* FORMULARIO DE B√öSQUEDA */}
                <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h2 className="text-xl font-bold text-indigo-950 mb-4 pb-3 border-b-2 border-indigo-200">
                        Datos de B√∫squeda
                    </h2>
                    <form onSubmit={buscarHuespedes} className="flex flex-col space-y-4">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">
                                    N√∫mero de Habitaci√≥n*:
                                </label>
                                <input
                                    name="nroHabitacion"
                                    type="text"
                                    value={nroHabitacion}
                                    onChange={(e) => {
                                        setNroHabitacion(e.target.value);
                                        setErrorNroHabitacion(false);
                                    }}
                                    onBlur={(e) => validarNroHabitacion(e.target.value)}
                                    onKeyDown={handleKeyDownInput}
                                    className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                                        errorNroHabitacion
                                            ? "border-red-500 bg-red-50"
                                            : "border-gray-300 hover:border-indigo-400"
                                    }`}
                                    placeholder="N√∫mero de habitaci√≥n"
                                />
                                {errorNroHabitacion && (
                                    <p className="text-red-600 text-xs mt-1">N√∫mero de habitaci√≥n inv√°lido</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">
                                    Hora de Salida*:
                                </label>
                                <input
                                    name="horaSalida"
                                    type="time"
                                    value={horaSalida}
                                    onChange={(e) => {
                                        setHoraSalida(e.target.value);
                                        setErrorHoraSalida(false);
                                    }}
                                    onBlur={(e) => validarHoraSalida(e.target.value)}
                                    onKeyDown={handleKeyDownInput}
                                    className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                                        errorHoraSalida
                                            ? "border-red-500 bg-red-50"
                                            : "border-gray-300 hover:border-indigo-400"
                                    }`}
                                />
                                {errorHoraSalida && (
                                    <p className="text-red-600 text-xs mt-1">Hora de salida inv√°lida</p>
                                )}
                            </div>
                        </div>

                        {/* MENSAJES DE ERROR */}
                        {errores.length > 0 && (
                            <div className="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded-lg">
                                <p className="font-semibold mb-2">Errores encontrados:</p>
                                <ul className="list-disc list-inside">
                                    {errores.map((error, index) => (
                                        <li key={index} className="text-sm">{error}</li>
                                    ))}
                                </ul>
                            </div>
                        )}

                        <button
                            type="submit"
                            onKeyDown={(e) => handleKeyDown(e, () => buscarHuespedes(e as any))}
                            className="w-full md:w-auto px-6 py-3 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105"
                        >
                            Buscar
                        </button>
                    </form>
                </div>

                {/* TABLA DE HU√âSPEDES */}
                {mostrarTabla && (
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 className="text-xl font-bold text-indigo-950 mb-4 pb-3 border-b-2 border-indigo-200">
                            Seleccione una persona como responsable de pago
                        </h2>
                        <div className="max-h-[400px] overflow-y-auto">
                            <table className="w-full border-collapse">
                                <thead className="bg-gradient-to-r from-indigo-950 to-indigo-900 text-white sticky top-0 z-10 shadow-md">
                                    <tr>
                                        <th className="p-4 font-semibold text-left">Seleccionar</th>
                                        <th className="p-4 font-semibold text-left">Apellido</th>
                                        <th className="p-4 font-semibold text-left">Nombre</th>
                                        <th className="p-4 font-semibold text-left">Tipo Documento</th>
                                        <th className="p-4 font-semibold text-left">N√∫mero Documento</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {huespedes.map((h) => {
                                        const isSelected = huespedSeleccionado?.id === h.id;
                                        return (
                                            <tr
                                                key={`${h.huespedID.tipoDocumento}-${h.huespedID.dni}`}
                                                className={`hover:bg-indigo-50 transition-colors ${
                                                    isSelected ? "bg-indigo-100" : "bg-white"
                                                }`}
                                            >
                                                <td className="p-4 border-b border-gray-200 text-center">
                                                    <input
                                                        type="radio"
                                                        name="seleccion"
                                                        checked={isSelected}
                                                        onChange={() => seleccionarResponsable(h)}
                                                        className="w-4 h-4 text-indigo-950 focus:ring-indigo-500"
                                                    />
                                                </td>
                                                <td className="p-4 border-b border-gray-200 font-medium text-indigo-950">
                                                    {h.apellido}
                                                </td>
                                                <td className="p-4 border-b border-gray-200 text-gray-700">
                                                    {h.nombre}
                                                </td>
                                                <td className="p-4 border-b border-gray-200 text-gray-700">
                                                    {h.huespedID.tipoDocumento}
                                                </td>
                                                <td className="p-4 border-b border-gray-200 text-gray-700">
                                                    {h.huespedID.dni}
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                        </div>

                        <div className="mt-6 flex justify-center gap-4">
                            <button
                                type="button"
                                onClick={() => setMostrarTercero(true)}
                                className="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-all shadow-md hover:shadow-lg font-semibold"
                            >
                                Facturar a un tercero
                            </button>
                        </div>
                    </div>
                )}

                {/* ITEMS A FACTURAR */}
                {mostrarItems && responsablePago && (
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 className="text-xl font-bold text-indigo-950 mb-4 pb-3 border-b-2 border-indigo-200">
                            Items a Facturar
                        </h2>

                        <div className="mb-4 p-4 bg-indigo-50 rounded-lg">
                            <p className="text-indigo-950 font-semibold">
                                Responsable de Pago: <span className="font-normal">{responsablePago.nombre}</span>
                            </p>
                            <p className="text-indigo-950 font-semibold mt-2">
                                Tipo de Factura: <span className="font-normal">{responsablePago.tipoFactura}</span>
                            </p>
                        </div>

                        <div className="space-y-3 mb-6">
                            {itemsFacturar.map((item) => (
                                <label
                                    key={item.id}
                                    className="flex items-center justify-between p-4 border-2 border-gray-200 rounded-lg hover:border-indigo-400 transition-colors cursor-pointer"
                                >
                                    <div className="flex items-center gap-3">
                                        <input
                                            type="checkbox"
                                            checked={itemsSeleccionados.includes(item.id)}
                                            onChange={() => toggleItem(item.id)}
                                            className="w-5 h-5 text-indigo-950 focus:ring-indigo-500"
                                        />
                                        <span className="text-indigo-950 font-medium">{item.descripcion}</span>
                                    </div>
                                    <span className="text-indigo-950 font-semibold">${item.precio.toFixed(2)}</span>
                                </label>
                            ))}
                        </div>

                        <div className="mt-6 flex justify-center gap-4">
                            <Link href="/menu">
                                <button
                                    type="button"
                                    className="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all shadow-md hover:shadow-lg font-semibold"
                                >
                                    Cancelar
                                </button>
                            </Link>
                            <button
                                type="button"
                                onClick={generarFactura}
                                onKeyDown={(e) => handleKeyDown(e, generarFactura)}
                                className="px-6 py-3 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105"
                            >
                                Aceptar
                            </button>
                        </div>
                    </div>
                )}

                {/* FACTURA GENERADA */}
                {facturaGenerada && (
                    <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                        <h2 className="text-xl font-bold text-indigo-950 mb-4 pb-3 border-b-2 border-indigo-200">
                            Factura Generada
                        </h2>

                        <div className="space-y-4">
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <p className="text-gray-600 text-sm">N√∫mero de Factura:</p>
                                    <p className="text-indigo-950 font-semibold text-lg">#{facturaGenerada.id}</p>
                                </div>
                                <div>
                                    <p className="text-gray-600 text-sm">Fecha:</p>
                                    <p className="text-indigo-950 font-semibold">
                                        {new Date(facturaGenerada.fecha).toLocaleDateString('es-AR')}
                                    </p>
                                </div>
                                <div>
                                    <p className="text-gray-600 text-sm">Tipo:</p>
                                    <p className="text-indigo-950 font-semibold">Factura {facturaGenerada.tipo}</p>
                                </div>
                                <div>
                                    <p className="text-gray-600 text-sm">Estado:</p>
                                    <p className="text-indigo-950 font-semibold">{facturaGenerada.estado}</p>
                                </div>
                            </div>

                            <div className="border-t-2 border-indigo-200 pt-4">
                                <div className="flex justify-between items-center">
                                    <span className="text-2xl font-bold text-indigo-950">Total:</span>
                                    <span className="text-3xl font-bold text-indigo-950">
                                        ${facturaGenerada.total?.toFixed(2) || '0.00'}
                                    </span>
                                </div>
                            </div>

                            <div className="mt-6 flex justify-center gap-4">
                                <button
                                    type="button"
                                    onClick={() => {
                                        setFacturaGenerada(null);
                                        setNroHabitacion("");
                                        setHoraSalida("");
                                        setHuespedes([]);
                                        setResponsablePago(null);
                                        setErrores([]);
                                    }}
                                    className="px-6 py-3 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold"
                                >
                                    Nueva Factura
                                </button>
                                <Link href="/menu">
                                    <button
                                        type="button"
                                        className="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all shadow-md hover:shadow-lg font-semibold"
                                    >
                                        Volver al Men√∫
                                    </button>
                                </Link>
                            </div>
                        </div>
                    </div>
                )}
            </div>

            {/* CARTELES */}
            {mostrarTercero && (
                <FacturarUnTerceroModal
                    onClose={() => setMostrarTercero(false)}
                    onAceptar={handleFacturarTercero}
                />
            )}

            {mostrarMenorEdad && (
                <MenorEdad onClose={() => setMostrarMenorEdad(false)} />
            )}
        </main>
    );
}
//[favicon.ico]
         (  F          (  n  00     (-  ñ         ç  æF  (                                                           $   ]   ∫   ∫   ]   $                                       †   Ú   ˇ   ˇ   ˇ   ˇ   Ú   †                           8   ‡   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‡   8                  ‚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‚              °   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   °       #   Ù   ˇ   ˇOOOˇÆÆÆˇ´´´ˇ´´´ˇ´´´ˇ´´´ˇ≠≠≠ˇgggˇ   ˇ   ˇ   Ù   #   Y   ˇ   ˇ   ˇˇÌÌÌˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ˝˝˝ˇ555ˇ   ˇ   ˇ   ˇ   Y   ª   ˇ   ˇ   ˇ   ˇkkkˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇéééˇ   ˇ   ˇ   ˇ   ˇ   ª   ª   ˇ   ˇ   ˇ   ˇ			ˇÕÕÕˇˇˇˇˇˇˇˇˇ‰‰‰ˇˇ   ˇ   ˇ   ˇ   ˇ   ª   Y   ˇ   ˇ   ˇ   ˇ   ˇJJJˇ˝˝˝ˇˇˇˇˇkkkˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Y   #   Ù   ˇ   ˇ   ˇ   ˇˇ∂∂∂ˇ’’’ˇ			ˇ   ˇ   ˇ   ˇ   ˇ   Ù   #       °   ˇ   ˇ   ˇ   ˇ   ˇ111ˇDDDˇ   ˇ   ˇ   ˇ   ˇ   ˇ   °              ‚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‚                  8   ‡   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‡   8                           †   Ú   ˇ   ˇ   ˇ   ˇ   Ú   †                                       $   ]   ∫   ∫   ]   $                                                                                                                                                                                                                                                                                    (       @                                                                               ,   U   Å   Ë   Ë   Å   U   ,                                                                                      *   Ö   “   ˘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˘   “   Ö   *                                                                      ñ   Û   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Û   ñ                                                          Q   ·   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ·   Q                                               r   ˚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˚   r                                       r   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   r                               O   ˚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˚   O                          ‰   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   „                      ó   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ó               (   ı   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ù   '           Ü   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ888ˇãããˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇàààˇâââˇ___ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ü          ‘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇÓÓÓˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇSSSˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‘      +   ˙   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇhhhˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÆÆÆˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˙   +   T   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇÀÀÀˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÙÙÙˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   T   Ç   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇGGGˇ˝˝˝ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇçççˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Å   È   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ≠≠≠ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ‰‰‰ˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   È   È   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ+++ˇÛÛÛˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇjjjˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   È   Å   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇãããˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÃÃÃˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ç   T   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ„„„ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ˝˝˝ˇIIIˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   T   +   ˙   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇhhhˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇØØØˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˙   +      ‘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇÀÀÀˇˇˇˇˇˇˇˇˇÙÙÙˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‘          Ü   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇGGGˇ˝˝˝ˇˇˇˇˇçççˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ü           '   Ù   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ±±±ˇÏÏÏˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ı   (               ó   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ333ˇ___ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ó                      „   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‰                          O   ˚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˚   O                               r   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   r                                       r   ˚   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˚   r                                               Q   ·   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ·   Q                                                          ñ   Û   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Û   ñ                                                                      *   Ö   “   ˘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˘   “   Ö   *                                                                                      ,   U   Å   Ë   Ë   Å   U   ,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               (   0   `           -                                                                                             	   (   L   j   ≥   ¯   ˜   ≥   j   K   (   	                                                                                                                                          V   †   ÿ   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   ÿ   †   U                                                                                                                      %   ã   ·   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ·   ã   &                                                                                                      ã   Ô   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ô   ã                                                                                          Q   ‹   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‹   R                                                                              ä   ˛   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˛   ä                                                                     ≠   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ≠                                                             ∏   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ∏                                                     Æ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Æ                                              ä   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ä                                       P   ˝   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˝   O                                  ﬂ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ﬂ                              ã   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ã                       #   Ò   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ò   #                   å   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ã                  ‰   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ$$$ˇhhhˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇeeeˇPPPˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‰              U   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇÎÎÎˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇsssˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   U           °   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇeeeˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÃÃÃˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   °       	   ⁄   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ………ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ˝˝˝ˇHHHˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ⁄   	   (   ˘   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇEEEˇ¸¸¸ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÆÆÆˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   (   K   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ™™™ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÙÙÙˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   L   j   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ)))ˇÚÚÚˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇåååˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   j   ¥   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇàààˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ„„„ˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ≥   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ···ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇiiiˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇeeeˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÀÀÀˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   ≥   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ………ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ˝˝˝ˇHHHˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¥   j   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇEEEˇ¸¸¸ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÆÆÆˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   j   L   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ™™™ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÙÙÙˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   K   (   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ)))ˇÚÚÚˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇåååˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˘   (   	   ⁄   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇàààˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇ„„„ˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ⁄   	       °   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ···ˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇiiiˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   °           U   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇeeeˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇˇÃÃÃˇˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   U              ‰   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇˇ………ˇˇˇˇˇˇˇˇˇ˝˝˝ˇHHHˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‰                  ã   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇEEEˇ¸¸¸ˇˇˇˇˇÆÆÆˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   å                   #   Ò   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ¨¨¨ˇ˚˚˚ˇ,,,ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ò   #                       ã   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ222ˇ}}}ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ã                              ﬂ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ﬂ                                  O   ˝   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˝   P                                       ä   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ä                                              Æ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Æ                                                     ∏   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ∏                                                             ≠   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ≠                                                                     ä   ˛   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˛   ä                                                                              R   ‹   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ‹   Q                                                                                          ã   Ô   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   Ô   ã                                                                                                      &   ã   ·   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ·   ã   %                                                                                                                      U   †   ÿ   ¯   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ˇ   ¯   ÿ   †   V                                                                                                                                          	   (   K   j   ≥   ˜   ¯   ≥   j   L   (   	                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        âPNG

   IHDR         \r®f   sRGB ÆŒÈ   8eXIfMM *    ái            †       †           D"8s  IDATxÌ]	∞’ônî]<QVAñËƒh$	 Nåé13*àq∞¬d™ƒç©I°àòDìL2ì™(Œ(‘ò2÷ƒô—G	ã¡q_@Â±à‡Üäx»õÔª–èæè{o˜ΩΩù”˝˝Uﬂ{}ªOüÂ;Áˇ˚Ù˘œ9›¬ëdÅÅÆ(Dg†–8	ËÙN ∫]ÄÓ@†hx•?v ¿N‡3‡=`;6.&∞‡u‚‡  ±î6âPÅ©–ΩÄ¡@ˇ√†R” P˘iZq ^DN„‡Äwpºÿº–X–h–òHg@¿Ã
:Ÿ‚|5` p"@¿'º…≤ôs{Îp¸*2¿ﬁçÖƒ d “Øåñ»|(0¯
0 ‡ì>KÚ
≥xX¨6 IJ» §C|?$KENÿ}œì|ä¬Úµ·‡ˆh $	2 êŸ|/ß¬è . Nz í#ºè√WÄe¿
‡5Ä„íêàè‹∂à˙‡;¿y ïæ Òg‡s©h^  Iƒ» DL(¢;∏8†“HjgÄcH|x†1†ÀR"åaÄÔÙ”Åï G¡Ÿ@ÖË9`/`%0ËHƒ@jΩ~,∞†€K
ü,t).ŒËIëàÅDËÅT¶O˚)~∫∞VÏÅu$b Ë™õ–U%•7ìÉç®õ˘ _…$b 8AÁ◊¿Äﬂ¯Jˆ3` 510wQÒ?§¯vr—·:¸2˛Kƒ@ §¯v*{%#ÌÇAÅZÄÂíÅ^(ıœ=Ò≥g \„¿WÉ€çÄ…!:‡ﬂ,`‡6˝œ643Å:@íc.FŸü§˘‰Äu?–<êê'·›ÄÉÄî_‹èvp: …8Qæõ
IÒ≈Å∑p{3ŒÛ–kH»¢åG°ûºïÆcÒ—º<ç62&ã
ê◊2uC¡ˇ‡⁄ÚÊï≠ﬂ‚§T¯3⁄
ΩÍÄõÖ;Óºî™dù/~mÄΩ.¯íX∆@{‰w.∞´d]Gï⁄ {lK‹‡Ebúˇ˝(P©RuM¸T€Cõ“⁄√¿d‰Ô])øå_Lm‡=ƒ˚=@búÕ˜KÄ€GUkŸ^úU”ÿ∆ÿ÷¯ö)1ÄÅ»ªg’T¢¬äØ∞m`9⁄\⁄Æ≥¿Q˛Õ@ÿ ‘˝‚∞ñ6:⁄û’^õw¨ùÚÔ∏EóD§¡ Á	¸5∞‡∫ÎƒF–,ﬂ‹
X"“dÄm<ÄnB~ÚÏ@¥∏˜µt◊tèxãª¸;⁄fﬁ>Òì™ÌI8µàªø8”∏C1€™$B∏ïßeÜ©›+˛íjl´‹EZ√«& © S:‚:ä6∞mˆÎ¥ˇ\G1•Á`¢®≈!ìnlªl√∆ä…^ÄQ`Ì∑@OcŸS∆ƒ@e∏Õ∑∫πÁ§qb™pïˇ„SÜƒ@upö∫±F¿D@Âø–ìø∫Ü¶–Ê2@#¿π∆ıL3 £Aíî$H2« _hû∂FH#rq(ÌˇO‡DÉÚ§¨àÅ®‡runGOWaÍbä &ñSgDÒ3¿EDÁtoß*«§ö˙°ƒ9kä›~)øï°,$¬ xøRü1òv‡K ·¿9ÄD‰çÅU(wÆ&LE“‰Í©ªÄS)πÈ3–Y8x8 $.iÄ(ÌåƒK¨≈ÄYúéÏa»]≠ó¥¿4îÙ«Ä	câìÆ≈@3∏f‡ÄÛï4∆ ∆¢Ñˇ–/*b‡¸˛ «˛ò$!IÄ~áÿ7…B*-1`	o ü ∫	ë$ª‡«°DãÅæâîLâà˚‡Úﬂ ÍJ"í‰¿OQ¢À)ïˆ2@#–x4â"$e ®¯∑Iˆ8í‡OiàÅ8¯"› ºG‰ﬁ8[xƒt<Ò.¥¥7&Çm&ÿéRç^ã≥tq˜ ÿï·.æß≈Y≈-2» Ωdß ˚„*_‹‡&d|j\ôWºb „ÙG˘ˆ´‚*gúØ £ëÈáÅƒF4„"IÒäÅÿÉ¥/ b1qÄN»„¿YÄDàÅpºå€9ÅÓ„p—}w\Ø Ûë‘§£ì”1 j`ÄËO˚üÓ≠xK=Ä—HÒ˜ ˜Aìà1ü#æ
D:U8j¿ı˝t˘©Î$b bûA||ÿUºQø¸26%™Ã)1 äËÖ_¿Í¢≥!~DŸ‡∫Êï ø‡+b >A¥‹:]—E$à£50êÚGDhR—tË–¡È›ªwR…)ùP« ëËn$ë 3‹÷Î@bSßNuñ,Y‚¥j’ ≤úÁ:ª°Ù‹;¿·¿ﬂÛ@£`«|„ñ-[)ì'OV˝Ÿ’Ü©sFx⁄Æì‚€•¯n}Õõ7Ø†¸¸≥~˝˙∆∫∫:ªå¿Qó©J_§ŒUKj8ñq0x‡∆;v4 Ãû=[ıhW=æ	›Î	§&∑!e5À8h—¢E„›wﬂ]§¸¸Ò·á6ˆÔﬂ_ıiW}˛SZ⁄?	ø/`ü;vl„æ}˚é2 <±h—" ª¿ß–AÓπë∏‹Å’X,„†m€∂ç+V¨(©¸<πwÔﬁ∆#F®^Ì™◊;ì÷˛aHc ˚‡î)S *ø{a˘ÚÂçp ÿc89(—^Äû˛ˆ4é&E¶€o√ÜÆûW¸/∑†u∆=±^Äû˛*?{k^∑_EÌ«≈˙˙zπÌ™gˆÜ UI-ãÅË{WU*
ú:p˚9.t⁄∑o(/›∫us>˚Ï3Áâ'û^ÅRgÄﬂ‰⁄ûG‚ÃI_DÆëªûçÂ‹~~Ω π≠{¯˙Ÿ?N0ë7ΩSÍÿ.∆ç◊∏ˇ~?}/y]nA;Íÿ£ã≥„2 ]ÒFOB2C?∑_I≠˜úî[–:∞:⁄=#¿OzKÈ-„ à€œ£Ô%Â¥Æ›?j–˛I¿ÆÜPç€Ø§Ê{N -hU›ˇtï:ôúÉò¯Åı ,‚†∑üG◊K -hU€Á¢cÉhP7 ˇŒ°¬ò¡@µn?ø\”-∏k◊.π˝à2„:ı˙ `Ÿ·FÑ€=˝-·†V∑_…GøÁ§‹ÇVÈ ›ı}¢0 WI˘≠™¯F∫˝ ≠ˆÛËsMárZ’8pJ∏Q‹*@OK8ÎˆÛ≥
rZ•‘›ña, ﬂ˚wÀ ÿSÈW^y•üáæ.∑†5Ìat7‘ÿ›è§¸÷Tv#›~7n≠‡A"∏¸ÚÀ’+¥£W¯ËpM¬≈/™hK8à“ÌÁg‰¥F/^Ñ∑´≈å¿M{e Ï®ËRõ|˙)qÿÎ7›tìÊ?8'‡µÄK˘ÌP~∫˝ÓπÁû∞˙\ı˝r⁄—>†«∑Uk ÿeP˜ﬂ|Î^x«ÈˆÛ≥
ã/V/¿¸vÚÙôØÙÅÂÑ‰¢*◊p‚v˚˘ π≠–æ ü]J˚À}êÛàk8(ïàŒ≈«¿ƒâù—£G«óÄOÃm⁄¥q,X†o˙îÚe.‚ò^ °Qx–”ﬂpít˚˘ı‰4^_ÉNó{‡Üæ¯≈yƒ2 Üsê§€œœ –-ÿπsgµs€Ã–iÍvëîZ8
!~PJ?åcÄ´˝Ó∫ÎÆ¿õ|∆] Æ‹Ω{∑≥zıÍ∏ìR¸µ1pn„‘‡zÔÌ•∫ºtlp˚9≥fÕr∫vÌjTÊÆø˛zﬂ4*O L„ã~ï¯—Áû‘ï3òÉ4›~~Ør≠;‘mÍxYå+¸¿ÄÄ°§ÌˆÛ3 r≠;‘mÍxì4‡˜≈:7]’ÅqLö4)U∑ü!r˙1îÍuÍ6øÏ’$Õ¿7õÆË¿8∫wÔÓÃô3«∏|5œ>?Ó\zÈ•ÕOÎ∑úÎÕÜ◊ ¯,ÔEõ≈¿å3úÅöï©2ππÂñ[ú∫∫∫2Wu:EæÇ¥õº^p.H1cJ∫t˚]}ı’BòuÈ‘SOuÆ∫äª…IcÄOêû•Úƒ%É  ∆AZ´˝¸¸¸Ækµ†ë∫D?«5 ﬁ@Q◊¿†ˇÈ3¿wÍ+Æ∏"˝åTôŒS¿ûUﬁ•‡13¿Ó?˚‚5 M'›ã˙ü>p˚˛Zµjï~fj»◊àÅ◊°‘êÇn©ÅÅ¶±>◊ ˇi5D§[bf Ì’~aã'∑`Xcπü„ -º1Ûk¢õΩˇƒÅI´˝¸ﬁ˜˝Ækµ†Q∫≈Ø|ÛkﬂMÀÈ(92»@ít∞…ÌÁ«›ÇX-ËL◊ìaÄ˙N4Äìq‹û'$f0@∑@VÑnAõ‹òY·ΩL9:‚|/^s« ˙ó	®”)0`Íjø∞T\w›uZ-ñƒËÓ¬®\†	@—:¶±cÌt˚˘ú{»-Ë«Rb◊˚1%◊ ÙI,Y%Të€›~áãr˙1îÿı¬CüÄ,º$ñ¥*ÀÄÈ´˝ f<‡π0z˛é•Ëh’F¸Ñ˚¶ ∑ü´˝|‚ÄØ8Z-ËCR¸óπùTg◊ –HRfÄãglYÌñ™πsÁ -ñƒp˜”'+é√ËÓ∂mµ_ÿígÕÕñèÓÁCø{ Ù	Ú√íî»™€œèŒô3g -ËGR|◊π7`GÄﬁÒ•°òÉ0êU∑ü_ŸµZ–è°ÿØüD†)¿±Û\>Å¨ª˝ ó¸–π˝äız Nñ§ƒ@÷›~~¥ -Ë«P¨◊{rsÄø¥@¨<óéúõ|.]∫‘∏|îŒm|g˚ıÎÁ¨_øﬁyÂïW‚KD1ób‡MΩî¢%°s\ì∑ü•r˙1ÀınÏ\ñ∆íÑ"-… ›`.4Ê€~%3ô‡I}[0A≤è$µì= -“>BH"GÆ€èç^rÑ≠<¬EBG›i ⁄%îòí9Ã@^›~~@´˝ä¸˙1‹ÏÄÜ@í t˚-[∂ÃËœ{%@CŸ$mAg¸¯ÒŒö5k Ü—Ö»¯úä/ÂèåOˇàlﬂ‰”øÑ·B–@.X∞¿±u‰p•O¸Ó6úóx≤9MPnø`ﬂ∑o_ßææ^n¡`tÖ
•ß(˙™ªôÉ\r˚˘s∆A“yÛÊÈ€Ç˛TÖ°@h
ÉE0lÿ0ÁŒ;Ôt⁄µ”òk∆∏N†°°¡YµjUê‡
S#Ï|^„Ω∫- |¢›p√Nó.Ö≠ÿﬁ•`◊^{≠zLÒ6ÉÉ4 üƒõÜbÁ®ˆeó]&"™dÄsŒú9Uﬁ•‡U0!¿¡*nP–*`óˇÊõo÷®vïºπ¡i8GçÂ˛‘ˇhh†ÿmúäÕÀ¿‰…ìùsœ=◊{J«U0¿’ÇÛÁœwZ∑Ê˛íà¯îÉÄÏõˆç8bEzÙË·,Y≤DÔ˛![Cü>}úç7:k◊Æìno∆¿fˆ >jvR?#bÄÉXà(∂¸F√ATæF’’iÛÍà[¡{Ï∞zvƒÁ>∫°Cá Ìa+ê[0B2èDµú=ÄÌG~Î(
¯ƒ∫Ò∆’ıèÇLO◊\sç‹Ç>"8|ã`[)
&Lp8¯'âñˆ‰åî”Ì4 oGeŒ#£€è¿lŸí_\ìDÕÄ‹Çë2Zÿl¢‹i¥9éåt‰»ë9f ﬁ¢À-øúºã=ÄùáYÃyçàn?uQ„Ø}XÕ¨ÕsAÔi >=å–1Ê=R…Ì+‡ +≠‹Ç°∏.2 öäKÏ´∑ﬂÙÈ”C∆¢€É20h– áÀ´%53¿5@ÖMAπ%ò¶◊Ã£„»ÌÇº∑j[ı‰9Œ;∏˚ _(Ø˙ßøµ0¿’~r˚’¬\∏{Ùm¡P¸‹ˇÆx#TT9æôn?æè ÌóN#†·ï◊•&Ó}◊ ¨Ø)
›TçVLØ!∏ﬂ‘j¡™Î`Ôp ﬂ8@Rr˚UAVåAÂ¨ö‹=∏„-ﬁÂÄ˜pLH™`@nø*»ä1®‹ÇUìÀı?}w ]ÏH2@∑ﬂ¥i”ÜV∞∏†[êÀØ%Å‡ÙˇÇÎﬂ5 ç8±)–≠
T`Äõ|rZbZ-∏.÷!da+@◊ ŒÁﬂûÛÄZÌgfê[0pΩºÊÜÙ û‰§ I¥…gr∏$∑†o%P«_rCy¿Vú|ﬂΩ†ˇ•‡"mÚYöŒ -Ë[ l⁄ƒk xA„ ¯ì€Ø9]¢[p“§IÂ»®¨pPì«œk ä∫FeŸêÃ»ÌgHE¯dÉnAm"Zñ$éı5}ÑõÇzÂ8¸êÈÙ2r¯Xõ|ñ ≈‡S‹ªwØ≥rÂJÉsôJ÷~ÅTõf˛z{ ÃÕ´ ˜êx–j?jµ‡QïE›nÚ js¿˘¡|Gêx–∑˝<dXt(∑‡QïE›.¨pØ47 ‹)˜¢˛;Öœysµ_´V≠DáÖ»-XTi‘Ì¢˝?õ Ü~ºËñúˇê€œÓ ∑`Q˝=VÙ?öÚ˙^‡
ÄÇπ∫˝ñ.]™|Xﬁ
Ùm¡B~Äø?ä∆¯Jı ﬁD†ó∑‰¸è‹~Ÿh rÍëÛˇ©€ER™¿ÖA›ÄÛäBÊÏ›~w‹qá”æ}˚úï<õ≈ï[–π5˚dÛ⁄-’`ò5 ?êKq›~l4íÏ0@∑‡)ßúíù/IÇÆ(ºú‡áÿã¸Ö•nŒÍ9π˝≤Y≥4Ëú!òCŸà2◊ó*w9¿Å¿GK›êısÓ&ür˚e≥¶s˙È∂?†6Ÿ8J  |(ÚuwO‰¥Åd∞&K)ánAæ ?Röç“n@7,∑∫8¡=ëıˇr˚eΩÜïèn¡Mõ69k◊ÚM7Û¬È˝∑Jï¥RÄ]Üe•n Í9π˝≤Z≥≈Â‚ /?·ûìo>å“Ûïæ§îrzr“¿ ÛÛ`ÂˆÛV{ˆèªuÎÊ4448´V≠ ra˜†p≥ ÓıQRZî<{‰dK.F9ïΩ#~T‚æ˚Ós.æ¯‚ÏN%*À ¿·√ùuÎ8G&ì≤•Ï/W:*x%·{√}@¶ ªÇlıııNc#ÁAIÚ¿¿±«õıiﬁ˜£À*?ÎÿØ¿0}ÄgÄ„˘C"ƒÄp€Ø≥Ääﬂ˚®4Ëñí“è(b¿8Ä_Q˘Yî Ä·Ór7'Äóà`∑ˇÓ ˘j ∏6‡Ö *å©3¿WˆgÉ‰"®‡l¢°¬à1ê:Ï±Sg}%» †	π•P?˜Ñ˛ã1`õê£Ø…Y– „‚é"ãÇD™0b@§∆ ›ˆÅîü9¨¶¿˝æ[t·âF1¿áÙp`k–\U”`ú‹R¯∑A#W81 e`)R€ZMä’ˆ ˜Ä[uÊâF0	rq.¿’Å•⁄ #^=C"ƒÄ9P'´R~fΩñ Ô
pnÄzdC"“e†¶ß?≥\KÄ˜Ω®@&$b }jz˙3€µˆ x/{Ëƒ1 RaÄ#ˇ|˜Á∆üUK≠= &ƒ^ÄÊTMπnë2¿9ˇ5)?s¶¿˚{O'ÛáDàÅD‡íﬂo [kM’oK0øxˇå ‹TdÇ_@]b rÊ ∆G√ƒ∂¿¥; ´ÄØÚáDàÅD‡Í‹1¿gaR€`⁄‹'`0à¬† â>\çÎ/˘ÑÒΩf–˘É¯Òê˜Ñé≈ÄàçÅﬂ!fn˜Z¢|büÜ‹U†.tÆÅÂ‡§ü—¿⁄r™9≈+Äõ˝ë≠Ä±Ó	˝b rnEåDkî= ÊÈ8‡è¿Ÿ¸!b RûCl„ÄPﬁEŸ`º‹åêKÜ'~ﬂ@â†À}*∞!`¯@¡¢6 LÙ†;¿ç	$b@D√¿?#ö»gﬁF˝
‡µVîà1év˝«;√EsÙ›Qπõ«Ã=…Æˆ4ø†ﬂb@T≈¿nÑ˛!πÚ3qº0^ VÄ„ c âµ1‹∂¥∂[˝ÔäÎ¿Mπ=8Ià›â’1@è⁄Ö@Cu∑∑`N∏o¿„ WJƒÄ∆ W˙—Â«e˜±IúØ n¶πN‡m‡ØÄ∏∆‹¥Ù_dÅÅ(ƒ4`E‹ÖI¬ ∞Øú"ÃµÀ1 *3+\˛EÂ —\M‚¿Õ)g	r¡ê¶
ªåËø8ö>ıøpÙ?vI“ ∞0Ä«Ä~¸!b†àÅ≠¯≈$'”%"IøìøéR˝¿iç1 é0∞á? S~&ù‘ ”rÖ‰í∆Ä§{ nÙ_òƒ¿»ÃL‡?íŒTÄe‰‘∆é¿7˘C"rŒ¿OQ~"qIÀ ∞†O 8ù?$b ß‹ãrˇ#@◊_‚ívºJÃôÇ£/πÈ3'd·/Å»÷˜W[§§õÁo'N¸lÛ˙-2Œ €¸Â@j O~”Ó0îÅ¿2` Hƒ@∆ÿÑÚù–+ñ™§›pOBÆ ﬁuOËø»(l„SÄ‘ïü¸¶9»ÙΩÚ~cﬂ:x/ËXdÑ.˘∞∆îÚòd »…V‡y@F $H2≈ ïüÔ¸+M*ïiÄ‹l8O@F $H2¡ ïüÂÆ2≠4& r¥PO¿¥÷¢¸‘¬Ä˚‰7N˘YS Û∂†¯¿YÉ1`„;ˇJS3n≤ g[Å'Åë@W@"la`32 n?'˚HB2p
ÓhƒÅmÄmu âêÅì◊j@F@ò‹V†ç≤≠Z!¶øxI‰î…ˇHÆyô—±)¸˘>¿ÂZ!6 ∫‡îaŒ`‰˛Ç¶ÃdDV$9fÄÎ˘	pMø6ªI®!LG:\LdrwPyÀ~˝P·ß%‘ÊïL3∆·7ÁTK—ƒAmÄmo|≥6©ü	3–È-“h J3øº?é67 ·∂yr∂çî"Ä˚˛‡g»Œ4. $±1¿˜˝_º[*ä∏&∏§òS/ıdq¥ŒÏ„‰â¡Cﬁ‚h ä3øº>ä6≈∂%±ÄÅ∂»„\Ä#¥RZq¶=lK|≈îX∆¿X‰WSàe j5 /°˝–”$±òÅ:‰˝v@ΩÇ†ÜÄŒ8–◊êdÑÅ1(áz2~F‡)¥˘ˆ3¢ÙÕã¡ﬁ¿lÄÆCøÜ†Î˘‚Ë#¥âõÌ=≤.\Lt? %— N$9b†% :‡˛É2˘‰Äu	 …1|-ò	ldÚ¡˜úút $b†¿@?¸•∑@Ü ªF‡c‘ÔœÅ^ÄDîdÄ[9˝‡†êzŸ‡Ääœ:
Hƒ@ æåP2v )~†¶Æ@ï‡¸Ôüz5∞«|Ä˙“øR´÷µ™‡¡|`#†W39ÿÇ∫·<Ó"-±0¿Ô\<Ïd“ÂÄu¿oGLz 1êúGp∞‡óçeíÂÄØdã .¯jHƒ@jÙF 3Äï@ c{s<ˇ˘J&	…@ãê˜Îˆb∏Ÿ¿wÅã  ≤ß ©ùn¡µ‡vú≤˚< âàÄàà,M;ú˚*p>p!0hH¸‡{=ïûª¸x‡]Iƒ» DLhôË⁄‚<'°åh8«@V ¡#Ô„òJˇ∞‡f˚ Iå» ƒHnÖ®˚„Wü}‡N∆t[uÚ$ü¢∞õÅßÅÂ ˛@í 2 	í]&)éÜ #Ä3àìÅ,	=%ØTÙ’¿k¿&‡  IâÄîà˜I∂Æ”≥ Ÿ[8	Ë	¥Lñ]»]tÔTgÅı¿6‡-@b2 UÜOV∫„: A?ÄØ} .iÓ|	‡xCú¬˜rvﬂw; Œ¿#Í>Èi 8_b82 ÜWPÄÏ—ıË Åé {'nØ·”8z;Ä∆§y›ésü ú√@•¶ºP°∑o|¬S˘ih $3ˇ@ﬂπjÏä·    IENDÆB`Ç
//[globals.css]
@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

/* Fondo siempre blanco, sin importar el modo oscuro del sistema */
@media (prefers-color-scheme: dark) {
  :root {
    --background: #ffffff;
    --foreground: #171717;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}

table {
  text-indent: 0;
  background-color: aliceblue;
  border-collapse: collapse;
}
//[ingresarNotaCredito/page.tsx]
'use client';

import React, { useState, useEffect } from "react";
import { useRouter } from "next/navigation";
import Link from "next/link";
import axios from "axios";
import { format, parseISO } from "date-fns";
import { esSoloNumeros, validarCUIT, esObligatorio } from "../validaciones/validaciones";

interface FacturaDTO {
  id: number;
  fecha: string;
  total: number;
  tipo: string;
  estado: string;
  responsablepago?: {
    tipo: string;
    dni?: string;
    tipoDocumento?: string;
    cuit?: string;
  };
}

interface NotaCreditoDTO {
  id?: number;
  importe: number;
  facturas?: FacturaDTO[];
  responsablepago?: {
    tipo: string;
    dni?: string;
    tipoDocumento?: string;
    cuit?: string;
  };
}

export default function IngresarNotaCredito() {
  const router = useRouter();
  
  // Estados del formulario
  const [cuit, setCuit] = useState("");
  const [tipoDocumento, setTipoDocumento] = useState("");
  const [numeroDocumento, setNumeroDocumento] = useState("");
  
  // Estados de errores
  const [errorCuit, setErrorCuit] = useState(false);
  const [errorNumeroDoc, setErrorNumeroDoc] = useState(false);
  const [errorBusqueda, setErrorBusqueda] = useState("");
  
  // Estados de facturas
  const [facturas, setFacturas] = useState<FacturaDTO[]>([]);
  const [facturasSeleccionadas, setFacturasSeleccionadas] = useState<number[]>([]);
  const [buscando, setBuscando] = useState(false);
  
  // Estados de nota de cr√©dito
  const [notaCreditoGenerada, setNotaCreditoGenerada] = useState<NotaCreditoDTO | null>(null);
  const [procesando, setProcesando] = useState(false);
  const [mostrarDetalle, setMostrarDetalle] = useState(false);
  
  // Validaciones en tiempo real
  useEffect(() => {
    if (cuit !== "") {
      setErrorCuit(!validarCUIT(cuit));
    } else {
      setErrorCuit(false);
    }
  }, [cuit]);
  
  useEffect(() => {
    if (numeroDocumento !== "") {
      setErrorNumeroDoc(!esSoloNumeros(numeroDocumento));
    } else {
      setErrorNumeroDoc(false);
    }
  }, [numeroDocumento]);
  
  // Buscar facturas
  const buscarFacturas = async (e: React.FormEvent) => {
    e.preventDefault();
    
    // Validar que se complete al menos CUIT o Tipo y Nro Documento
    const tieneCuit = esObligatorio(cuit);
    const tieneTipoYNumero = esObligatorio(tipoDocumento) && esObligatorio(numeroDocumento);
    
    if (!tieneCuit && !tieneTipoYNumero) {
      setErrorBusqueda("Debe completar el CUIT o Tipo y Nro de Documento");
      return;
    }
    
    // Validar formato de CUIT si est√° completo
    if (tieneCuit && !validarCUIT(cuit)) {
      setErrorCuit(true);
      setErrorBusqueda("El CUIT ingresado no es v√°lido");
      return;
    }
    
    // Validar formato de n√∫mero de documento si est√° completo
    if (tieneTipoYNumero && !esSoloNumeros(numeroDocumento)) {
      setErrorNumeroDoc(true);
      setErrorBusqueda("El n√∫mero de documento debe contener solo n√∫meros");
      return;
    }
    
    setBuscando(true);
    setErrorBusqueda("");
    
    try {
      // Construir par√°metros para filtrar facturas
      const params: any = {};
      if (tieneCuit) {
        params.cuit = cuit.trim();
      }
      if (tieneTipoYNumero) {
        params.tipoDocumento = tipoDocumento.trim();
        params.numeroDocumento = numeroDocumento.trim();
      }
      
      // Buscar facturas - asumiendo que hay un endpoint que acepta estos par√°metros
      // Si no existe, podr√≠a ser necesario obtener todas y filtrar en el frontend
      const response = await axios.get("http://localhost:8080/facturas/filtrar", {
        params
      });
      
      const facturasData: FacturaDTO[] = response.data || [];
      
      // Filtrar solo facturas pendientes
      const facturasPendientes = facturasData.filter((f: FacturaDTO) => 
        f.estado?.toUpperCase() === "PENDIENTE"
      );
      
      setFacturas(facturasPendientes);
      setFacturasSeleccionadas([]);
      
      if (facturasPendientes.length === 0) {
        setErrorBusqueda("No hay facturas pendientes de pago a nombre de la persona ingresada");
      }
    } catch (error: any) {
      console.error("Error al buscar facturas:", error);
      setErrorBusqueda("Error al buscar facturas. Verifique los datos ingresados.");
      setFacturas([]);
    } finally {
      setBuscando(false);
    }
  };
  
  // Toggle selecci√≥n de factura
  const toggleSeleccionFactura = (idFactura: number) => {
    setFacturasSeleccionadas((prev) => {
      if (prev.includes(idFactura)) {
        return prev.filter((id) => id !== idFactura);
      } else {
        return [...prev, idFactura];
      }
    });
  };
  
  // Calcular suma de importes seleccionados
  const calcularSumaImportes = () => {
    return facturas
      .filter((f) => facturasSeleccionadas.includes(f.id))
      .reduce((suma, f) => suma + f.total, 0);
  };
  
  // Generar nota de cr√©dito
  const generarNotaCredito = async () => {
    if (facturasSeleccionadas.length === 0) {
      setErrorBusqueda("Debe seleccionar al menos una factura");
      return;
    }
    
    setProcesando(true);
    setErrorBusqueda("");
    
    try {
      const sumaImportes = calcularSumaImportes();
      
      const notaCreditoDTO = {
        importe: sumaImportes,
        facturas: facturasSeleccionadas.map((id) => ({ id }))
      };
      
      const response = await axios.post("http://localhost:8080/notadecredito", notaCreditoDTO, {
        headers: {
          "Content-Type": "application/json"
        }
      });
      console.log(notaCreditoDTO);
      if (response.status === 200 || response.status === 201) {
        // Obtener la nota de cr√©dito generada con todos sus datos
        const notaCredito = response.data;
        setNotaCreditoGenerada({
          id: notaCredito.id,
          importe: sumaImportes,
          facturas: facturas.filter((f) => facturasSeleccionadas.includes(f.id)),
          responsablepago: facturas[0]?.responsablepago
        });
        setMostrarDetalle(true);
      }
    } catch (error: any) {
      console.error("Error al generar nota de cr√©dito:", error);
      setErrorBusqueda(error.response?.data?.message || "Error al generar la nota de cr√©dito");
    } finally {
      setProcesando(false);
    }
  };
  
  // Manejar Shift+Tab
  const handleKeyDownInput = (e: React.KeyboardEvent<HTMLInputElement | HTMLSelectElement>) => {
    if (e.key === "Tab" && e.shiftKey) {
      e.preventDefault();
      const form = e.currentTarget.form;
      if (form) {
        const inputs = Array.from(form.querySelectorAll("input, select"));
        const index = inputs.indexOf(e.currentTarget);
        if (index > 0) {
          (inputs[index - 1] as HTMLElement).focus();
        }
      }
    }
  };
  
  // Calcular IVA (21% si es factura tipo A)
  const calcularIVA = (factura: FacturaDTO) => {
    if (factura.tipo?.toUpperCase() === "A") {
      // IVA del 21% sobre el importe neto
      // Si el total incluye IVA: neto = total / 1.21, IVA = total - neto
      const neto = factura.total / 1.21;
      return factura.total - neto;
    }
    return 0;
  };
  
  // Calcular importe neto
  const calcularImporteNeto = (factura: FacturaDTO) => {
    if (factura.tipo?.toUpperCase() === "A") {
      return factura.total / 1.21;
    }
    return factura.total;
  };
  
  // Obtener nombre del responsable
  const obtenerNombreResponsable = (factura: FacturaDTO) => {
    if (!factura.responsablepago) {
      return "Sin responsable";
    }
    
    if (factura.responsablepago.tipo === "FISICA") {
      return `${factura.responsablepago.dni || ""} - ${factura.responsablepago.tipoDocumento || ""}`;
    } else {
      return factura.responsablepago.cuit || "Persona Jur√≠dica";
    }
  };
  
  return (
    <main className="flex gap-8 px-8 py-8 items-start bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
      {/* FORMULARIO DE B√öSQUEDA */}
      {!mostrarDetalle && (
        <div className="bg-white rounded-xl shadow-lg p-6 w-80 h-fit sticky top-4">
          <h2 className="text-2xl font-bold text-indigo-950 mb-6 pb-3 border-b-2 border-indigo-200">
            Ingresar Nota de Cr√©dito
          </h2>
          <form onSubmit={buscarFacturas} className="flex flex-col space-y-4">
            <div>
              <label className="text-indigo-950 font-semibold mb-2 block text-sm">CUIT:</label>
              <input
                type="text"
                value={cuit}
                onChange={(e) => {
                  const valor = e.target.value.toUpperCase();
                  setCuit(valor);
                  setErrorCuit(false);
                  setErrorBusqueda("");
                }}
                onKeyDown={handleKeyDownInput}
                className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                  errorCuit
                    ? "border-red-500 bg-red-50"
                    : "border-gray-300 hover:border-indigo-400"
                }`}
                placeholder="XX-XXXXXXXX-X"
              />
              {errorCuit && (
                <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                  <span>‚ö†</span> CUIT inv√°lido. Formato: XX-XXXXXXXX-X
                </p>
              )}
            </div>
            
            <div>
              <label className="text-indigo-950 font-semibold mb-2 block text-sm">Tipo Documento:</label>
              <select
                value={tipoDocumento}
                onChange={(e) => {
                  setTipoDocumento(e.target.value.toUpperCase());
                  setErrorBusqueda("");
                }}
                onKeyDown={handleKeyDownInput}
                className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
              >
                <option value="">Seleccionar tipo</option>
                <option value="DNI">DNI</option>
                <option value="PASAPORTE">PASAPORTE</option>
                <option value="LE">LE</option>
                <option value="LC">LC</option>
              </select>
            </div>
            
            <div>
              <label className="text-indigo-950 font-semibold mb-2 block text-sm">Nro Documento:</label>
              <input
                type="text"
                value={numeroDocumento}
                onChange={(e) => {
                  const valor = e.target.value.toUpperCase();
                  setNumeroDocumento(valor);
                  setErrorNumeroDoc(false);
                  setErrorBusqueda("");
                }}
                onKeyDown={handleKeyDownInput}
                className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                  errorNumeroDoc
                    ? "border-red-500 bg-red-50"
                    : "border-gray-300 hover:border-indigo-400"
                }`}
                placeholder="Ingrese el n√∫mero de documento"
              />
              {errorNumeroDoc && (
                <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                  <span>‚ö†</span> Ingrese solo n√∫meros.
                </p>
              )}
            </div>
            
            {errorBusqueda && (
              <div className="bg-red-50 border-l-4 border-red-500 text-red-700 p-3 rounded-lg">
                <p className="text-sm font-semibold">{errorBusqueda}</p>
              </div>
            )}
            
            <button
              type="submit"
              disabled={buscando}
              className={`w-full px-6 py-3 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105 ${
                buscando ? "opacity-50 cursor-not-allowed" : ""
              }`}
            >
              {buscando ? "Buscando..." : "BUSCAR"}
            </button>
          </form>
        </div>
      )}
      
      {/* CONTENIDO PRINCIPAL */}
      <section className="flex-1">
        {!mostrarDetalle && (
          <>
            {/* LISTA DE FACTURAS */}
            {facturas.length > 0 && (
              <div className="bg-white rounded-xl shadow-xl overflow-hidden">
                <div className="p-6 border-b-2 border-indigo-200">
                  <h2 className="text-2xl font-bold text-indigo-950">
                    Facturas Pendientes
                  </h2>
                  <p className="text-sm text-gray-600 mt-1">
                    {facturas.length} factura(s) pendiente(s) encontrada(s)
                  </p>
                </div>
                
                <div className="max-h-[600px] overflow-y-auto">
                  <table className="w-full border-collapse">
                    <thead className="bg-gradient-to-r from-indigo-950 to-indigo-900 text-white sticky top-0 z-10 shadow-md">
                      <tr>
                        <th className="p-4 font-semibold text-left">Seleccionar</th>
                        <th className="p-4 font-semibold text-left">Nro Factura</th>
                        <th className="p-4 font-semibold text-left">Fecha</th>
                        <th className="p-4 font-semibold text-left">Importe Neto</th>
                        <th className="p-4 font-semibold text-left">IVA</th>
                        <th className="p-4 font-semibold text-left">Importe Total</th>
                      </tr>
                    </thead>
                    <tbody>
                      {facturas.map((f: FacturaDTO) => {
                        const esSeleccionada = facturasSeleccionadas.includes(f.id);
                        const importeNeto = calcularImporteNeto(f);
                        const iva = calcularIVA(f);
                        
                        return (
                          <tr
                            key={f.id}
                            className={`hover:bg-indigo-50 transition-colors cursor-pointer ${
                              esSeleccionada ? "bg-indigo-100" : "bg-white"
                            }`}
                            onClick={() => toggleSeleccionFactura(f.id)}
                          >
                            <td className="p-4 border-b border-gray-200 text-center">
                              <input
                                type="checkbox"
                                checked={esSeleccionada}
                                onChange={() => toggleSeleccionFactura(f.id)}
                                className="w-4 h-4 text-indigo-950 focus:ring-indigo-500"
                              />
                            </td>
                            <td className="p-4 border-b border-gray-200 font-medium text-indigo-950">
                              {f.id}
                            </td>
                            <td className="p-4 border-b border-gray-200 text-gray-700">
                              {format(parseISO(f.fecha), "dd/MM/yyyy")}
                            </td>
                            <td className="p-4 border-b border-gray-200 text-gray-700">
                              ${importeNeto.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                            </td>
                            <td className="p-4 border-b border-gray-200 text-gray-700">
                              {f.tipo?.toUpperCase() === "A" 
                                ? `$${iva.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
                                : "-"
                              }
                            </td>
                            <td className="p-4 border-b border-gray-200 text-gray-700 font-semibold">
                              ${f.total.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                            </td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
                
                {/* SUMA DE IMPORTES SELECCIONADOS */}
                {facturasSeleccionadas.length > 0 && (
                  <div className="p-6 bg-indigo-50 border-t-2 border-indigo-200">
                    <div className="flex justify-between items-center">
                      <div>
                        <p className="text-sm text-gray-600">Facturas seleccionadas:</p>
                        <p className="text-lg font-semibold text-indigo-950">
                          {facturasSeleccionadas.length} factura(s)
                        </p>
                      </div>
                      <div className="text-right">
                        <p className="text-sm text-gray-600">Suma de importes:</p>
                        <p className="text-2xl font-bold text-indigo-950">
                          ${calcularSumaImportes().toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                        </p>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            )}
            
            {/* BOTONES */}
            <div className="flex justify-center gap-4 mt-6">
              <Link href="/menu">
                <button className="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all shadow-md hover:shadow-lg font-semibold">
                  Cancelar
                </button>
              </Link>
              
              <button
                onClick={generarNotaCredito}
                disabled={facturasSeleccionadas.length === 0 || procesando}
                className={`px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105 ${
                  facturasSeleccionadas.length === 0 || procesando ? "opacity-50 cursor-not-allowed" : ""
                }`}
              >
                {procesando ? "Procesando..." : "ACEPTAR"}
              </button>
            </div>
          </>
        )}
        
        {/* DETALLE DE NOTA DE CR√âDITO GENERADA */}
        {mostrarDetalle && notaCreditoGenerada && (
          <div className="bg-white rounded-xl shadow-xl p-6">
            <div className="mb-6 pb-4 border-b-2 border-indigo-200">
              <h2 className="text-2xl font-bold text-indigo-950">
                Nota de Cr√©dito Generada
              </h2>
            </div>
            
            <div className="space-y-4 mb-6">
              <div className="p-4 bg-indigo-50 rounded-lg">
                <p className="text-sm text-gray-600">Nro. de Nota de Cr√©dito:</p>
                <p className="text-xl font-bold text-indigo-950">{notaCreditoGenerada.id}</p>
              </div>
              
              <div className="p-4 bg-indigo-50 rounded-lg">
                <p className="text-sm text-gray-600">Responsable de Pago:</p>
                <p className="text-lg font-semibold text-indigo-950">
                  {notaCreditoGenerada.responsablepago?.tipo === "FISICA"
                    ? `${notaCreditoGenerada.responsablepago.dni || ""} - ${notaCreditoGenerada.responsablepago.tipoDocumento || ""}`
                    : notaCreditoGenerada.responsablepago?.cuit || "Sin responsable"}
                </p>
              </div>
              
              <div className="p-4 bg-indigo-50 rounded-lg">
                <p className="text-sm text-gray-600">Importe Neto:</p>
                <p className="text-xl font-semibold text-indigo-950">
                  ${(notaCreditoGenerada.importe / 1.21).toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                </p>
              </div>
              
              <div className="p-4 bg-indigo-50 rounded-lg">
                <p className="text-sm text-gray-600">IVA:</p>
                <p className="text-xl font-semibold text-indigo-950">
                  ${(notaCreditoGenerada.importe - (notaCreditoGenerada.importe / 1.21)).toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                </p>
              </div>
              
              <div className="p-4 bg-indigo-100 rounded-lg border-2 border-indigo-300">
                <p className="text-sm text-gray-600">Importe Total:</p>
                <p className="text-3xl font-bold text-indigo-950">
                  ${notaCreditoGenerada.importe.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                </p>
              </div>
            </div>
            
            <div className="flex justify-center mt-6">
              <button
                onClick={() => {
                  setMostrarDetalle(false);
                  setNotaCreditoGenerada(null);
                  setFacturas([]);
                  setFacturasSeleccionadas([]);
                  setCuit("");
                  setTipoDocumento("");
                  setNumeroDocumento("");
                  setErrorBusqueda("");
                }}
                className="px-6 py-3 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105"
              >
                ACEPTAR
              </button>
            </div>
          </div>
        )}
      </section>
    </main>
  );
}
//[ingresarPago/page.tsx]
'use client';

import React, { useState, useEffect } from "react";
import { useRouter } from "next/navigation";
import Link from "next/link";
import axios from "axios";
import { format, parseISO } from "date-fns";
import { esSoloNumeros, esObligatorio } from "../validaciones/validaciones";

interface FacturaDTO {
  id: number;
  fecha: string;
  total: number;
  tipo: string;
  estado: string;
  responsablepago?: {
    tipo: string;
    dni?: string;
    tipoDocumento?: string;
    cuit?: string;
  };
}

interface MedioPagoSeleccionado {
  tipo: string;
  monto: number;
  fecha: string;
  // Moneda
  tipoMoneda?: string;
  cotizacion?: number;
  montoConvertido?: number; // Monto en ARS para c√°lculos internos
  // Tarjeta cr√©dito
  banco?: string;
  cuotas?: number;
  // Tarjeta d√©bito
  dniTitular?: string;
  // Cheque
  numeroCheque?: number;
  plazo?: string;
}

export default function IngresarPago() {
  const router = useRouter();
  
  // Estados del formulario
  const [nroHabitacion, setNroHabitacion] = useState("");
  const [errorNroHabitacion, setErrorNroHabitacion] = useState(false);
  const [errorNroHabitacionObligatorio, setErrorNroHabitacionObligatorio] = useState(false);
  const [mensajeError, setMensajeError] = useState("");
  
  // Estados de facturas
  const [facturas, setFacturas] = useState<FacturaDTO[]>([]);
  const [facturaSeleccionada, setFacturaSeleccionada] = useState<FacturaDTO | null>(null);
  const [buscando, setBuscando] = useState(false);
  
  // Estados de pago
  const [medioPagoSeleccionado, setMedioPagoSeleccionado] = useState<string>("");
  const [mediosPago, setMediosPago] = useState<MedioPagoSeleccionado[]>([]);
  const [medioPagoActual, setMedioPagoActual] = useState<MedioPagoSeleccionado>({
    tipo: "",
    monto: 0,
    fecha: new Date().toISOString().split('T')[0]
  });
  
  // Estados de c√°lculo
  const [totalAcumulado, setTotalAcumulado] = useState(0);
  const [vuelto, setVuelto] = useState(0);
  const [totalAPagar, setTotalAPagar] = useState(0);
  
  // Estados de UI
  const [mostrarCartelSaldada, setMostrarCartelSaldada] = useState(false);
  const [procesando, setProcesando] = useState(false);
  
  // Validar n√∫mero de habitaci√≥n
  const validarNroHabitacion = () => {
    const vacio = !esObligatorio(nroHabitacion);
    const invalido = nroHabitacion !== "" && !esSoloNumeros(nroHabitacion);
    
    setErrorNroHabitacionObligatorio(vacio);
    setErrorNroHabitacion(invalido);
    
    if (vacio) {
      setMensajeError("N√∫mero de habitaci√≥n faltante");
      return false;
    }
    if (invalido) {
      setMensajeError("N√∫mero de habitaci√≥n incorrecto");
      return false;
    }
    return true;
  };
  
  // Buscar facturas pendientes
  const buscarFacturas = async () => {
    if (!validarNroHabitacion()) {
      return;
    }
    
    setBuscando(true);
    setMensajeError("");
    
    try {
      const response = await axios.get(`http://localhost:8080/facturas/habitacion/${nroHabitacion}`);
      const facturasData: FacturaDTO[] = response.data || [];
      console.log("Facturas recibidas:", facturasData);
      // Filtrar solo facturas pendientes
      const facturasPendientes = facturasData.filter((f: FacturaDTO) => 
        f.estado?.toUpperCase() === "PENDIENTE"
      );
      
      setFacturas(facturasPendientes);
      
      if (facturasPendientes.length === 0) {
        setMensajeError("No existen facturas pendientes de pago");
      }
    } catch (error: any) {
      console.error("Error al buscar facturas:", error);
      setMensajeError("Error al buscar facturas. Verifique el n√∫mero de habitaci√≥n.");
      setFacturas([]);
    } finally {
      setBuscando(false);
    }
  };
  
  // Seleccionar factura
  const seleccionarFactura = (factura: FacturaDTO) => {
    setFacturaSeleccionada(factura);
    setTotalAPagar(factura.total);
    setTotalAcumulado(0);
    setVuelto(0);
    setMediosPago([]);
    setMedioPagoSeleccionado("");
    setMedioPagoActual({
      tipo: "",
      monto: 0,
      fecha: new Date().toISOString().split('T')[0]
    });
  };
  
  // Manejar cambio de medio de pago
  const handleMedioPagoChange = (tipo: string) => {
    setMedioPagoSeleccionado(tipo);
    setMedioPagoActual({
      tipo: tipo,
      monto: 0,
      fecha: new Date().toISOString().split('T')[0],
      tipoMoneda: tipo === "MONEDA_LOCAL" ? "ARS" : undefined,
      cotizacion: undefined,
      banco: undefined,
      cuotas: undefined,
      dniTitular: undefined,
      numeroCheque: undefined,
      plazo: undefined
    });
  };
  
  // Agregar medio de pago
  const agregarMedioPago = () => {
    if (!medioPagoSeleccionado) {
      setMensajeError("Debe seleccionar un medio de pago");
      return;
    }
    
    // Validar campos seg√∫n el tipo de medio
    const errores: string[] = [];
    
    if (medioPagoActual.monto <= 0) {
      errores.push("Importe");
    }
    
    if (!medioPagoActual.fecha) {
      errores.push("Fecha");
    }
    
    if (medioPagoSeleccionado === "MONEDA_LOCAL" || medioPagoSeleccionado === "MONEDA_EXTRANJERA") {
      if (!medioPagoActual.tipoMoneda) {
        errores.push("Moneda");
      }
    }
    
    if (medioPagoSeleccionado === "MONEDA_EXTRANJERA") {
      if (!medioPagoActual.cotizacion || medioPagoActual.cotizacion <= 0) {
        errores.push("Cotizaci√≥n");
      }
    }
    
    if (medioPagoSeleccionado === "TARJETA_CREDITO") {
      if (!medioPagoActual.banco) {
        errores.push("Banco");
      }
      if (!medioPagoActual.cuotas || medioPagoActual.cuotas <= 0) {
        errores.push("Cuotas");
      }
    }
    
    if (medioPagoSeleccionado === "TARJETA_DEBITO") {
      if (!medioPagoActual.banco) {
        errores.push("Banco");
      }
      if (!medioPagoActual.dniTitular) {
        errores.push("DNI Titular");
      }
    }
    
    if (medioPagoSeleccionado === "CHEQUE") {
      if (!medioPagoActual.numeroCheque || medioPagoActual.numeroCheque <= 0) {
        errores.push("N√∫mero de cheque");
      }
      if (!medioPagoActual.banco) {
        errores.push("Banco");
      }
      if (!medioPagoActual.plazo) {
        errores.push("Fecha de cobro");
      }
    }
    
    if (errores.length > 0) {
      setMensajeError(`Faltan los siguientes datos: ${errores.join(", ")}`);
      return;
    }
    
    // Calcular monto en ARS (si es moneda extranjera, multiplicar por cotizaci√≥n)
    let montoEnARS = medioPagoActual.monto;
    if (medioPagoSeleccionado === "MONEDA_EXTRANJERA" && medioPagoActual.cotizacion) {
      montoEnARS = medioPagoActual.monto * medioPagoActual.cotizacion;
    }
    
    // Agregar el medio de pago (guardar el monto original, pero usar el convertido para c√°lculos)
    const medioPagoAGuardar = {
      ...medioPagoActual,
      montoConvertido: montoEnARS // Guardar el monto convertido para c√°lculos
    };
    setMediosPago([...mediosPago, medioPagoAGuardar]);
    
    // Actualizar total acumulado usando el monto convertido
    const nuevoTotal = totalAcumulado + montoEnARS;
    setTotalAcumulado(nuevoTotal);
    
    // Calcular vuelto y actualizar total a pagar
    const deudaOriginal = facturaSeleccionada!.total;
    if (nuevoTotal >= deudaOriginal) {
      setVuelto(nuevoTotal - deudaOriginal);
      setTotalAPagar(0);
    } else {
      setVuelto(0);
      setTotalAPagar(deudaOriginal - nuevoTotal);
    }
    
    // Limpiar formulario
    setMedioPagoActual({
      tipo: "",
      monto: 0,
      fecha: new Date().toISOString().split('T')[0]
    });
    setMedioPagoSeleccionado("");
  };
  
  // Eliminar medio de pago
  const eliminarMedioPago = (index: number) => {
    const medio = mediosPago[index];
    const nuevosMedios = mediosPago.filter((_, i) => i !== index);
    setMediosPago(nuevosMedios);
    
    // Recalcular totales (usar monto convertido si existe, sino el monto original)
    const montoAEliminar = (medio as any).montoConvertido || medio.monto;
    const nuevoTotal = totalAcumulado - montoAEliminar;
    setTotalAcumulado(nuevoTotal);
    
    const deudaOriginal = facturaSeleccionada!.total;
    if (nuevoTotal >= deudaOriginal) {
      setVuelto(nuevoTotal - deudaOriginal);
      setTotalAPagar(0);
    } else {
      setVuelto(0);
      setTotalAPagar(deudaOriginal - nuevoTotal);
    }
  };
  
  // Procesar pago
  const procesarPago = async () => {
    if (!facturaSeleccionada) {
      return;
    }
    
    if (totalAcumulado < facturaSeleccionada.total) {
      // Seg√∫n el caso de uso, si el monto es menor, se actualiza el total a pagar y vuelve al punto 6
      // Esto ya est√° manejado autom√°ticamente en agregarMedioPago
      setMensajeError("El monto acumulado es menor a la deuda. Debe agregar m√°s medios de pago.");
      return;
    }
    
    if (mediosPago.length === 0) {
      setMensajeError("Debe agregar al menos un medio de pago.");
      return;
    }
    
    setProcesando(true);
    
    try {
      // Construir DTO seg√∫n el formato esperado
      const pagoDTO = {
        monto: totalAcumulado,
        fecha: new Date().toISOString().split('T')[0],
        factura: {
          id: facturaSeleccionada.id
        },
        medios: mediosPago.map(medio => {
          const medioDTO: any = {
            tipo: medio.tipo,
            monto: medio.monto,
            fecha: medio.fecha
          };
          
          if (medio.tipo === "MONEDA_LOCAL" || medio.tipo === "MONEDA_EXTRANJERA") {
            medioDTO.tipoMoneda = medio.tipoMoneda;
          }
          
          if (medio.tipo === "MONEDA_EXTRANJERA") {
            medioDTO.cotizacion = medio.cotizacion;
          }
          
          if (medio.tipo === "TARJETA_CREDITO") {
            medioDTO.banco = medio.banco;
            medioDTO.cuotas = medio.cuotas;
          }
          
          if (medio.tipo === "TARJETA_DEBITO") {
            medioDTO.banco = medio.banco;
            medioDTO.dniTitular = medio.dniTitular;
          }
          
          if (medio.tipo === "CHEQUE") {
            medioDTO.numeroCheque = medio.numeroCheque;
            medioDTO.banco = medio.banco;
            medioDTO.plazo = medio.plazo; // Fecha de cobro del cheque
          }
          
          return medioDTO;
        })
      };
      
      const response = await axios.post("http://localhost:8080/pagos", pagoDTO, {
        headers: {
          "Content-Type": "application/json"
        }
      });
      
      if (response.status === 200) {
        setMostrarCartelSaldada(true);
      }
    } catch (error: any) {
      console.error("Error al procesar pago:", error);
      setMensajeError(error.response?.data?.message || "Error al procesar el pago");
    } finally {
      setProcesando(false);
    }
  };
  
  // Manejar Shift+Tab
  const handleKeyDownInput = (e: React.KeyboardEvent<HTMLInputElement | HTMLSelectElement>) => {
    if (e.key === "Tab" && e.shiftKey) {
      e.preventDefault();
      const form = e.currentTarget.form;
      if (form) {
        const inputs = Array.from(form.querySelectorAll("input, select"));
        const index = inputs.indexOf(e.currentTarget);
        if (index > 0) {
          (inputs[index - 1] as HTMLElement).focus();
        }
      }
    }
  };
  
  // Obtener nombre del responsable
  const obtenerNombreResponsable = (factura: FacturaDTO) => {
    if (!factura.responsablepago) {
      return "Sin responsable";
    }
    
    if (factura.responsablepago.tipo === "FISICA") {
      return `${factura.responsablepago.dni || ""} - ${factura.responsablepago.tipoDocumento || ""}`;
    } else {
      return factura.responsablepago.cuit || "Persona Jur√≠dica";
    }
  };
  
  return (
    <main className="flex gap-8 px-8 py-8 items-start bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
      {/* FORMULARIO DE B√öSQUEDA */}
      <div className="bg-white rounded-xl shadow-lg p-6 w-80 h-fit sticky top-4">
        <h2 className="text-2xl font-bold text-indigo-950 mb-6 pb-3 border-b-2 border-indigo-200">
          Ingresar Pago
        </h2>
        <form onSubmit={(e) => { e.preventDefault(); buscarFacturas(); }} className="flex flex-col space-y-4">
          <div>
            <label className="text-indigo-950 font-semibold mb-2 block text-sm">N√∫mero de habitaci√≥n:</label>
            <input
              type="text"
              value={nroHabitacion}
              onChange={(e) => {
                const valor = e.target.value.toUpperCase();
                setNroHabitacion(valor);
                setErrorNroHabitacionObligatorio(false);
                setErrorNroHabitacion(false);
                setMensajeError("");
              }}
              onKeyDown={handleKeyDownInput}
              className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                errorNroHabitacion || errorNroHabitacionObligatorio
                  ? "border-red-500 bg-red-50"
                  : "border-gray-300 hover:border-indigo-400"
              }`}
              placeholder="Ingrese el n√∫mero de habitaci√≥n"
            />
            {errorNroHabitacionObligatorio && (
              <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                <span>‚ö†</span> {mensajeError || "El campo n√∫mero de habitaci√≥n no puede estar vac√≠o"}
              </p>
            )}
            {errorNroHabitacion && !errorNroHabitacionObligatorio && (
              <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                <span>‚ö†</span> {mensajeError || "N√∫mero de habitaci√≥n incorrecto"}
              </p>
            )}
          </div>
          
          <button
            type="submit"
            disabled={buscando}
            className={`w-full px-6 py-3 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105 ${
              buscando ? "opacity-50 cursor-not-allowed" : ""
            }`}
          >
            {buscando ? "Buscando..." : "Buscar Facturas"}
          </button>
        </form>
      </div>
      
      {/* CONTENIDO PRINCIPAL */}
      <section className="flex-1">
        {mensajeError && !facturaSeleccionada && (
          <div className="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded-lg mb-4 shadow-md">
            <p className="font-semibold">{mensajeError}</p>
          </div>
        )}
        
        {/* LISTA DE FACTURAS */}
        {facturas.length > 0 && !facturaSeleccionada && (
          <div className="bg-white rounded-xl shadow-xl overflow-hidden">
            <div className="p-6 border-b-2 border-indigo-200">
              <h2 className="text-2xl font-bold text-indigo-950">
                Facturas Pendientes
              </h2>
              <p className="text-sm text-gray-600 mt-1">
                {facturas.length} factura(s) pendiente(s) encontrada(s)
              </p>
            </div>
            
            <div className="max-h-[600px] overflow-y-auto">
              <table className="w-full border-collapse">
                <thead className="bg-gradient-to-r from-indigo-950 to-indigo-900 text-white sticky top-0 z-10 shadow-md">
                  <tr>
                    <th className="p-4 font-semibold text-left">Seleccionar</th>
                    <th className="p-4 font-semibold text-left">ID Factura</th>
                    <th className="p-4 font-semibold text-left">Fecha</th>
                    <th className="p-4 font-semibold text-left">Total</th>
                    <th className="p-4 font-semibold text-left">Tipo</th>
                    <th className="p-4 font-semibold text-left">Responsable</th>
                  </tr>
                </thead>
                <tbody>
                  {facturas.map((f: FacturaDTO) => {
                    const facturaId = f.id;
                    const esSeleccionada = facturaSeleccionada?.id === facturaId;
                    return (
                    <tr
                      key={facturaId}
                      className="bg-white hover:bg-indigo-50 transition-colors cursor-pointer"
                      onClick={() => seleccionarFactura(f)}
                    >
                      <td className="p-4 border-b border-gray-200 text-center">
                        <input
                          type="radio"
                          name="factura"
                          checked={esSeleccionada}
                          onChange={() => seleccionarFactura(f)}
                          className="w-4 h-4 text-indigo-950 focus:ring-indigo-500"
                        />
                      </td>
                      <td className="p-4 border-b border-gray-200 font-medium text-indigo-950">
                        {facturaId}
                      </td>
                      <td className="p-4 border-b border-gray-200 text-gray-700">
                        {format(parseISO(f.fecha), "dd/MM/yyyy")}
                      </td>
                      <td className="p-4 border-b border-gray-200 text-gray-700 font-semibold">
                        ${f.total.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                      </td>
                      <td className="p-4 border-b border-gray-200 text-gray-700">
                        {f.tipo}
                      </td>
                      <td className="p-4 border-b border-gray-200 text-gray-700">
                        {obtenerNombreResponsable(f)}
                      </td>
                    </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
          </div>
        )}
        
        {/* FORMULARIO DE PAGO */}
        {facturaSeleccionada && (
          <div className="bg-white rounded-xl shadow-xl p-6">
            <div className="mb-6 pb-4 border-b-2 border-indigo-200">
              <h2 className="text-2xl font-bold text-indigo-950">
                Procesar Pago
              </h2>
            </div>
            
            {/* INFORMACI√ìN DE LA FACTURA */}
            <div className="mb-6 p-4 bg-indigo-50 rounded-lg">
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <p className="text-sm text-gray-600">N√∫mero de Factura:</p>
                  <p className="text-lg font-semibold text-indigo-950">{facturaSeleccionada.id}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-600">Responsable:</p>
                  <p className="text-lg font-semibold text-indigo-950">{obtenerNombreResponsable(facturaSeleccionada)}</p>
                </div>
                <div>
                  <p className="text-sm text-gray-600">Total a Pagar:</p>
                  <p className="text-2xl font-bold text-indigo-950">
                    ${totalAPagar.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                  </p>
                </div>
                <div>
                  <p className="text-sm text-gray-600">Vuelto:</p>
                  <p className="text-2xl font-bold text-green-600">
                    ${vuelto.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                  </p>
                </div>
              </div>
            </div>
            
            {/* MEDIOS DE PAGO AGREGADOS */}
            {mediosPago.length > 0 && (
              <div className="mb-6">
                <h3 className="text-lg font-semibold text-indigo-950 mb-3">Medios de Pago Utilizados:</h3>
                <div className="space-y-2">
                  {mediosPago.map((medio, index) => {
                    const montoMostrar = medio.tipo === "MONEDA_EXTRANJERA" && medio.montoConvertido
                      ? medio.montoConvertido
                      : medio.monto;
                    const montoOriginal = medio.tipo === "MONEDA_EXTRANJERA" ? medio.monto : null;
                    
                    return (
                    <div key={index} className="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                      <div className="flex-1">
                        <p className="font-semibold text-indigo-950">
                          {medio.tipo}
                          {medio.tipo === "MONEDA_EXTRANJERA" && medio.tipoMoneda && ` (${medio.tipoMoneda})`}
                        </p>
                        {medio.tipo === "MONEDA_EXTRANJERA" && montoOriginal && (
                          <p className="text-xs text-gray-500">
                            {montoOriginal.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} {medio.tipoMoneda} √ó {medio.cotizacion} = 
                          </p>
                        )}
                        <p className="text-sm text-gray-600">
                          ${montoMostrar.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })} ARS
                        </p>
                      </div>
                      <button
                        onClick={() => eliminarMedioPago(index)}
                        className="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition text-sm"
                      >
                        Eliminar
                      </button>
                    </div>
                    );
                  })}
                </div>
                <div className="mt-4 p-3 bg-indigo-100 rounded-lg">
                  <p className="text-sm text-gray-600">Total Acumulado:</p>
                  <p className="text-xl font-bold text-indigo-950">
                    ${totalAcumulado.toLocaleString('es-AR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                  </p>
                </div>
              </div>
            )}
            
            {/* FORMULARIO DE MEDIO DE PAGO */}
            <div className="mb-6 p-4 border-2 border-indigo-200 rounded-lg">
              <h3 className="text-lg font-semibold text-indigo-950 mb-4">Agregar Medio de Pago</h3>
              
              <div className="mb-4">
                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Medio de Pago:</label>
                <select
                  value={medioPagoSeleccionado}
                  onChange={(e) => handleMedioPagoChange(e.target.value)}
                  className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                >
                  <option value="">Seleccionar medio de pago</option>
                  <option value="MONEDA_LOCAL">Moneda</option>
                  <option value="CHEQUE">Cheques</option>
                  <option value="TARJETA_CREDITO">Tarjetas de cr√©dito</option>
                  <option value="TARJETA_DEBITO">Tarjetas de d√©bito</option>
                  <option value="MONEDA_EXTRANJERA">Moneda Extranjera</option>
                </select>
              </div>
              
              {medioPagoSeleccionado && (
                <div className="space-y-4">
                  <div>
                    <label className="text-indigo-950 font-semibold mb-2 block text-sm">Importe:</label>
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      value={medioPagoActual.monto || ""}
                      onChange={(e) => setMedioPagoActual({ ...medioPagoActual, monto: parseFloat(e.target.value) || 0 })}
                      onKeyDown={handleKeyDownInput}
                      className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      placeholder="0.00"
                    />
                  </div>
                  
                  <div>
                    <label className="text-indigo-950 font-semibold mb-2 block text-sm">Fecha:</label>
                    <input
                      type="date"
                      value={medioPagoActual.fecha}
                      onChange={(e) => setMedioPagoActual({ ...medioPagoActual, fecha: e.target.value })}
                      onKeyDown={handleKeyDownInput}
                      className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    />
                  </div>
                  
                  {/* Campos espec√≠ficos seg√∫n medio de pago */}
                  {medioPagoSeleccionado === "MONEDA_LOCAL" && (
                    <div>
                      <label className="text-indigo-950 font-semibold mb-2 block text-sm">Moneda:</label>
                      <select
                        value={medioPagoActual.tipoMoneda || ""}
                        onChange={(e) => setMedioPagoActual({ ...medioPagoActual, tipoMoneda: e.target.value })}
                        onKeyDown={handleKeyDownInput}
                        className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      >
                        <option value="">Seleccionar moneda</option>
                        <option value="ARS">ARS (Pesos Argentinos)</option>
                      </select>
                    </div>
                  )}
                  
                  {medioPagoSeleccionado === "MONEDA_EXTRANJERA" && (
                    <div>
                      <label className="text-indigo-950 font-semibold mb-2 block text-sm">Moneda:</label>
                      <select
                        value={medioPagoActual.tipoMoneda || ""}
                        onChange={(e) => setMedioPagoActual({ ...medioPagoActual, tipoMoneda: e.target.value })}
                        onKeyDown={handleKeyDownInput}
                        className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                      >
                        <option value="">Seleccionar moneda</option>
                        <option value="USD">USD (D√≥lares)</option>
                        <option value="EUR">EUR (Euros)</option>
                        <option value="BRL">BRL (Reales)</option>
                      </select>
                    </div>
                  )}
                  
                  {medioPagoSeleccionado === "MONEDA_EXTRANJERA" && (
                    <div>
                      <label className="text-indigo-950 font-semibold mb-2 block text-sm">Cotizaci√≥n:</label>
                      <input
                        type="number"
                        step="0.01"
                        min="0"
                        value={medioPagoActual.cotizacion || ""}
                        onChange={(e) => setMedioPagoActual({ ...medioPagoActual, cotizacion: parseFloat(e.target.value) || 0 })}
                        onKeyDown={handleKeyDownInput}
                        className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        placeholder="Ingrese la cotizaci√≥n"
                      />
                      <p className="text-xs text-gray-500 mt-1">
                        Cotizaci√≥n de {medioPagoActual.tipoMoneda || "la moneda"} respecto a ARS
                      </p>
                    </div>
                  )}
                  
                  {medioPagoSeleccionado === "TARJETA_CREDITO" && (
                    <>
                      <div>
                        <label className="text-indigo-950 font-semibold mb-2 block text-sm">Banco:</label>
                        <select
                          value={medioPagoActual.banco || ""}
                          onChange={(e) => setMedioPagoActual({ ...medioPagoActual, banco: e.target.value })}
                          onKeyDown={handleKeyDownInput}
                          className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        >
                          <option value="">Seleccionar banco</option>
                          <option value="Galicia">Galicia</option>
                          <option value="Santander">Santander</option>
                          <option value="BBVA">BBVA</option>
                          <option value="Naci√≥n">Naci√≥n</option>
                          <option value="Provincia">Provincia</option>
                        </select>
                      </div>
                      <div>
                        <label className="text-indigo-950 font-semibold mb-2 block text-sm">Cuotas:</label>
                        <input
                          type="number"
                          min="1"
                          max="12"
                          value={medioPagoActual.cuotas || ""}
                          onChange={(e) => setMedioPagoActual({ ...medioPagoActual, cuotas: parseInt(e.target.value) || 0 })}
                          onKeyDown={handleKeyDownInput}
                          className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                          placeholder="1"
                        />
                      </div>
                    </>
                  )}
                  
                  {medioPagoSeleccionado === "TARJETA_DEBITO" && (
                    <>
                      <div>
                        <label className="text-indigo-950 font-semibold mb-2 block text-sm">Banco:</label>
                        <select
                          value={medioPagoActual.banco || ""}
                          onChange={(e) => setMedioPagoActual({ ...medioPagoActual, banco: e.target.value })}
                          onKeyDown={handleKeyDownInput}
                          className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        >
                          <option value="">Seleccionar banco</option>
                          <option value="Galicia">Galicia</option>
                          <option value="Santander">Santander</option>
                          <option value="BBVA">BBVA</option>
                          <option value="Naci√≥n">Naci√≥n</option>
                          <option value="Provincia">Provincia</option>
                        </select>
                      </div>
                      <div>
                        <label className="text-indigo-950 font-semibold mb-2 block text-sm">DNI Titular:</label>
                        <input
                          type="text"
                          value={medioPagoActual.dniTitular || ""}
                          onChange={(e) => setMedioPagoActual({ ...medioPagoActual, dniTitular: e.target.value.toUpperCase() })}
                          onKeyDown={handleKeyDownInput}
                          className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                          placeholder="Ingrese DNI"
                        />
                      </div>
                    </>
                  )}
                  
                  {medioPagoSeleccionado === "CHEQUE" && (
                    <>
                      <div>
                        <label className="text-indigo-950 font-semibold mb-2 block text-sm">Nro. de Cheque:</label>
                        <input
                          type="number"
                          min="1"
                          value={medioPagoActual.numeroCheque || ""}
                          onChange={(e) => setMedioPagoActual({ ...medioPagoActual, numeroCheque: parseInt(e.target.value) || 0 })}
                          onKeyDown={handleKeyDownInput}
                          className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                          placeholder="N√∫mero de cheque"
                        />
                      </div>
                      <div>
                        <label className="text-indigo-950 font-semibold mb-2 block text-sm">Banco:</label>
                        <select
                          value={medioPagoActual.banco || ""}
                          onChange={(e) => setMedioPagoActual({ ...medioPagoActual, banco: e.target.value })}
                          onKeyDown={handleKeyDownInput}
                          className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        >
                          <option value="">Seleccionar banco</option>
                          <option value="Galicia">Galicia</option>
                          <option value="Santander">Santander</option>
                          <option value="BBVA">BBVA</option>
                          <option value="Naci√≥n">Naci√≥n</option>
                          <option value="Provincia">Provincia</option>
                        </select>
                      </div>
                      <div>
                        <label className="text-indigo-950 font-semibold mb-2 block text-sm">Fecha de Cobro:</label>
                        <input
                          type="date"
                          value={medioPagoActual.plazo || ""}
                          onChange={(e) => setMedioPagoActual({ ...medioPagoActual, plazo: e.target.value })}
                          onKeyDown={handleKeyDownInput}
                          className="w-full p-3 border-2 rounded-lg text-indigo-950 border-gray-300 hover:border-indigo-400 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        />
                      </div>
                    </>
                  )}
                  
                  <button
                    type="button"
                    onClick={agregarMedioPago}
                    className="w-full px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-all shadow-md hover:shadow-lg font-semibold"
                  >
                    Agregar Medio de Pago
                  </button>
                </div>
              )}
            </div>
            
            {/* BOTONES */}
            <div className="flex justify-center gap-4 mt-6">
              <Link href="/menu">
                <button className="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all shadow-md hover:shadow-lg font-semibold">
                  Cancelar
                </button>
              </Link>
              
              <button
                onClick={procesarPago}
                disabled={totalAcumulado < facturaSeleccionada.total || procesando}
                className={`px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105 ${
                  totalAcumulado < facturaSeleccionada.total || procesando ? "opacity-50 cursor-not-allowed" : ""
                }`}
              >
                {procesando ? "Procesando..." : "Procesar Pago"}
              </button>
            </div>
            
            {mensajeError && (
              <div className="mt-4 bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded-lg shadow-md">
                <p className="font-semibold">{mensajeError}</p>
              </div>
            )}
          </div>
        )}
      </section>
      
      {/* CARTEL DE FACTURA SALDADA */}
      {mostrarCartelSaldada && (
        <FacturaSaldadaCartel
          onClose={() => {
            setMostrarCartelSaldada(false);
            setFacturaSeleccionada(null);
            setFacturas([]);
            setNroHabitacion("");
            setMediosPago([]);
            setTotalAcumulado(0);
            setVuelto(0);
            setTotalAPagar(0);
            setMensajeError("");
          }}
        />
      )}
    </main>
  );
}

// Componente del cartel de factura saldada
function FacturaSaldadaCartel({ onClose }: { onClose: () => void }) {
  useEffect(() => {
    const handleKeyPress = () => {
      onClose();
    };

    window.addEventListener('keydown', handleKeyPress);
    return () => {
      window.removeEventListener('keydown', handleKeyPress);
    };
  }, [onClose]);

  return (
    <div className="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-[9999]">
      <div className="relative bg-white rounded-xl shadow-xl p-8 w-auto min-w-[500px]">
        <img
          src="/imagenInformacion.png"
          alt="Info"
          className="absolute top-4 left-4 w-12 h-12"
        />
        <button
          type="button"
          onClick={onClose}
          className="absolute top-4 right-4 text-gray-700 hover:text-black text-xl font-bold"
        >
          ‚úï
        </button>
        <h2 className="text-xl font-bold text-center mb-4 text-indigo-950 mt-8">
          Factura saldada. TOQUE UNA TECLA PARA CONTINUAR‚Ä¶
        </h2>
      </div>
    </div>
  );
}
//[layout.tsx]
import type { Metadata } from "next";
import { Geist, Geist_Mono } from "next/font/google";
import "./globals.css";
import { Cormorant_Garamond } from "next/font/google";
import Header from "./components/header";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const cormorant = Cormorant_Garamond({
  subsets: ["latin"],
  weight: ["700"], // para hacerlo bien elegante
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});


export const metadata: Metadata = {
  title: "Hotel Premier",
  description: "Hotel management system",
  other: {
    "google": "notranslate",
  },
};



export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en" className="notranslate light" translate="no" >
      <body
        className={`${geistSans.variable} ${geistMono.variable} antialiased "notranslate" translate="no" `}
      >
      <Header />

        {children}
      </body>
    </html>
  );
}
//[loging/page.tsx]
//import Link from "next/dist/client/link";
import Link from "next/link";

export default function LogingPage() {
  return (
    <main className="flex flex-col items-center justify-center min-h-screen bg-gray-100">
      <h1 className="text-4xl font-bold text-indigo-950 mb-4">Iniciar Sesi√≥n</h1>
      <form className="flex flex-col  w-80">

        <label className="text-indigo-950 font-medium mb-0">nombre de usuario:</label>
        <input type="text" placeholder="Usuario" className="p-2 border rounded mt-0 text-black" />
        <label className="text-indigo-950 font-medium mt-4">contrase√±a:</label>
        <input type="password" placeholder="Contrase√±a" className="p-2 border rounded text-black" />

        <nav> 
          <Link href="/menu"> 
            <button className="mt-10 px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition cursor-pointer">Entrar</button>
          </Link>
        </nav>

        <nav>
          <Link href="/contrasenia" className="text-sm text-indigo-600 hover:underline mb-2">¬øOlvidaste tu contrase√±a?</Link>
        </nav>

      </form>
    </main>
  );
}
//[menu/components/imageCarousel.tsx]
'use client';

import { useState } from 'react';
import Image from 'next/image';

interface ImageCarouselProps {
  images: string[]; // Un array de rutas de im√°genes (ej: ['/image1.jpg', '/image2.jpg'])
}

export default function ImageCarousel({ images }: ImageCarouselProps) {
  const [currentIndex, setCurrentIndex] = useState(0);

  const goToPrevious = () => {
    const isFirstSlide = currentIndex === 0;
    const newIndex = isFirstSlide ? images.length - 1 : currentIndex - 1;
    setCurrentIndex(newIndex);
  };

  const goToNext = () => {
    const isLastSlide = currentIndex === images.length - 1;
    const newIndex = isLastSlide ? 0 : currentIndex + 1;
    setCurrentIndex(newIndex);
  };

  if (images.length === 0) {
    return null; // No muestra nada si no hay im√°genes
  }

  return (
    <div className="relative w-full h-[500px] overflow-hidden rounded-lg shadow-xl mb-10"> {/* Altura fija para el carrusel */}
      
      {/* Imagen actual */}
      <Image
        src={images[currentIndex]}
        alt={`Slide ${currentIndex + 1}`}
        fill // Esto hace que la imagen ocupe todo el espacio del div padre
        style={{ objectFit: 'cover' }} // Para que la imagen se adapte sin distorsionarse
        priority // Carga esta imagen con alta prioridad
      />

      {/* Flecha izquierda */}
      <button
        onClick={goToPrevious}
        className="absolute top-1/2 left-4 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-3 rounded-full 
                   hover:bg-opacity-75 transition-colors z-10"
      >
        &#10094; {/* Car√°cter de flecha izquierda */}
      </button>

      {/* Flecha derecha */}
      <button
        onClick={goToNext}
        className="absolute top-1/2 right-4 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-3 rounded-full 
                   hover:bg-opacity-75 transition-colors z-10"
      >
        &#10095; {/* Car√°cter de flecha derecha */}
      </button>
    </div>
  );
}
//[menu/components/menuOptionsGrid.tsx]
import { Cormorant_Garamond } from "next/font/google";
import Image from "next/image";
import Link from "next/link";
//import Header from "./components/header";

const cormorant = Cormorant_Garamond({
  subsets: ["latin"],
  weight: ["700"],
});

export default function MenuOptionsGrid() {
  return (
    <main className=" bg-gray-200">
      {/* CARRE DE IMAGENES DE HOTEL */}
    </main>
  );
}
//[menu/page.tsx]
'use client'; // Mant√©n esto si usas el carrusel o el men√∫ con hooks

import MenuOptionsGrid from './components/menuOptionsGrid';
import ImageCarousel from './components/imageCarousel';

export default function MenuPage() {
  const carouselImages = [
    '/habitacionHotelPremierNosotras.png',
    '/fachadaHotelPremier.png',
    '/piletaHotelPremierNosotras.png',
  ];

  return (
    <main className="min-h-screen bg-gray-100 p-10 flex flex-col items-center">
      
      {/* Carrusel */}
      <ImageCarousel images={carouselImages} />

      {/* ----- SECCI√ìN SERVICIOS ----- */}
<section className="mt-20 w-full flex flex-col items-center">

  {/* T√≠tulo */}
  <h2 className="text-3xl font-serif text-indigo-950 mb-2">Servicios</h2>
  <div className="w-16 h-[2px] bg-indigo-950 mb-10"></div>

  {/* Grid de tarjetas */}
  <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">

    {/* Estacionamiento */}
    <div className="bg-white rounded-lg shadow-md px-21 py-8 flex flex-col items-center hover:shadow-lg transition">
      <img src="/imagenEstacionamiento.png" alt="Estacionamiento" className="w-25 h-23 mb-4" />
      <p className="text-indigo-950 font-medium text-lg">Estacionamiento</p>
    </div>

    {/* Sauna */}
        <div className="bg-white rounded-lg shadow-md px-21 py-8 flex flex-col items-center hover:shadow-lg transition">
          <img src="/imagenSauna.png" alt="Sauna" className="w-25 h-23 mb-4" />
          <p className="text-indigo-950 font-medium text-lg">Sauna</p>
        </div>

        {/* Lavado y Planchado */}
        <div className="bg-white rounded-lg shadow-md px-21 py-8 flex flex-col items-center hover:shadow-lg transition">
          <img src="/imagenLavanderia.png" alt="Lavado y Planchado" className="w-25 h-23 mb-4" />
          <p className="text-indigo-950 font-medium text-lg">Lavado y Planchado</p>
        </div>

        {/* Bar */}
        <div className="bg-white rounded-lg shadow-md px-21 py-8 flex flex-col items-center hover:shadow-lg transition">
          <img src="/imagenBar.png" alt="Bar" className="w-25 h-23 mb-4" />
          <p className="text-indigo-950 font-medium text-lg">Bar</p>
        </div>

      </div>
    </section>


      {/* Botones del men√∫ */}
      <MenuOptionsGrid />

      {/* --- INFORMACI√ìN DE CONTACTO --- */}
      <footer className="mt-16 w-full text-center text-indigo-900">
        <div className="py-6 bg-white rounded-lg shadow-md mx-auto max-w-xl">
          <h3 className="text-lg font-semibold mb-2">Contacto</h3>

          <p className="text-sm">
            <b>Tel√©fono:</b> +54 381 4210000
          </p>
          <p className="text-sm">
            <b>Email:</b> contacto@hotelpremier.com.ar
          </p>
          <p className="text-sm">
            <b>Direcci√≥n:</b> San Mart√≠n 177, San Miguel de Tucum√°n, Argentina
          </p>

          <p className="text-xs mt-4 text-gray-600">
            ¬© {new Date().getFullYear()} Hotel Premier ‚Äî Todos los derechos reservados.
          </p>
        </div>
      </footer>
    </main>
  );
}
//[modificarHuesped/page.tsx]
'use client';

import React, { useState, useEffect } from "react";
import { useRouter } from "next/navigation";
import axios from "axios";
import { validarFormularioHuesped } from "../validaciones/validaciones";
import { TipoHuesped } from "../tabla/page";
import CancelarModificacion from "../carteles/cancelarModificacion";
import ModificacionExitosa from "../carteles/modificacionExitosa";
import ErrorDniExistente from "../carteles/errorDniExistente";
import ConfirmarEliminarHuesped from "../carteles/confirmarEliminarHuesped";
import HuespedEliminado from "../carteles/huespedEliminado";
import NoSePuedeEliminarHuesped from "../carteles/noSePuedeEliminarHUesped";

export default function ModificarHuesped() {
    const router = useRouter();
    
    // Estados de carteles
    const [mostrarCancelar, setMostrarCancelar] = useState(false);
    const [mostrarExito, setMostrarExito] = useState(false);
    const [mostrarErrorDni, setMostrarErrorDni] = useState(false);
    const [mostrarConfirmarEliminar, setMostrarConfirmarEliminar] = useState(false);
    const [mostrarEliminado, setMostrarEliminado] = useState(false);
    const [mostrarNoSePuedeEliminar, setMostrarNoSePuedeEliminar] = useState(false);
    
    // Estado del hu√©sped original (para comparar DNI)
    const [huespedOriginal, setHuespedOriginal] = useState<TipoHuesped | null>(null);
    
    // Estados de errores
    const [errores, setErrores] = useState<string[]>([]);
    const [erroresTipo, setErroresTipo] = useState<string[]>([]);
    
    // Estado del formulario
    const [formData, setFormData] = useState({
        apellido: "",
        nombre: "",
        tipoDocumento: "",
        dni: "",
        cuit: "",
        posicionIva: "",
        calle: "",
        numero: "",
        departamento: "",
        piso: "",
        codigoPostal: "",
        localidad: "",
        provincia: "",
        pais: "",
        fechaNacimiento: "",
        telefono: "",
        email: "",
        ocupacion: "",
        nacionalidad: "",
    });

    // Cargar hu√©sped desde sessionStorage al montar
    useEffect(() => {
        const huespedStr = sessionStorage.getItem('huespedSeleccionado');
        if (!huespedStr) {
            router.push('/buscarHuesped');
            return;
        }

        try {
            const huesped: TipoHuesped = JSON.parse(huespedStr);
            setHuespedOriginal(huesped);
            
            // Cargar datos en el formulario
            // El backend env√≠a "direccion" no "direccionHuesped"
            const direccion = (huesped as any).direccion || huesped.direccionHuesped;
            
            setFormData({
                apellido: huesped.apellido || "",
                nombre: huesped.nombre || "",
                tipoDocumento: huesped.huespedID.tipoDocumento || "",
                dni: huesped.huespedID.dni || "",
                cuit: huesped.cuit || "",
                posicionIva: huesped.posicionIva || "CONSUMIDOR FINAL",
                calle: direccion?.calle || "",
                numero: direccion?.numero?.toString() || "",
                departamento: direccion?.departamento || "",
                piso: direccion?.piso?.toString() || "",
                codigoPostal: direccion?.codigoPostal?.toString() || "",
                localidad: direccion?.localidad || "",
                provincia: direccion?.provincia || "",
                pais: direccion?.pais || "",
                fechaNacimiento: huesped.fechaNacimiento || "",
                telefono: huesped.telefono || "",
                email: huesped.email || "",
                ocupacion: huesped.ocupacion || "",
                nacionalidad: huesped.nacionalidad || "",
            });
        } catch (error) {
            console.error("Error al cargar hu√©sped:", error);
            router.push('/buscarHuesped');
        }
    }, [router]);

    // Manejar cambios en los campos
    const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
        const { name, value } = e.target;
        const valorMayus = name === "email" || name === "fechaNacimiento" ? value : value.toUpperCase();
        setFormData({ ...formData, [name]: valorMayus });
    };

    // Manejar blur para validaciones
    const handleBlur = (e: React.FocusEvent<HTMLInputElement | HTMLSelectElement>) => {
        const { name } = e.target;
        const { errores, erroresTipo } = validarFormularioHuesped(formData);

        setErrores(prev => prev.filter(campo => campo !== name));
        setErroresTipo(prev => prev.filter(campo => campo !== name));

        if (errores.includes(name)) {
            setErrores(prev => [...prev.filter(c => c !== name), name]);
        }
        if (erroresTipo.includes(name)) {
            setErroresTipo(prev => [...prev.filter(c => c !== name), name]);
        }
    };

    // Clase para inputs con errores
    const getInputClass = (campo: string) => {
        const baseClass = "w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent";
        if (errores.includes(campo) || erroresTipo.includes(campo)) {
            return `${baseClass} border-red-500 bg-red-50`;
        }
        return `${baseClass} border-gray-300 hover:border-indigo-400`;
    };

    // Manejar Shift+Tab
    const handleKeyDownInput = (e: React.KeyboardEvent<HTMLInputElement | HTMLSelectElement>) => {
        if (e.key === "Tab" && e.shiftKey) {
            e.preventDefault();
            const form = e.currentTarget.form;
            if (form) {
                const inputs = Array.from(form.querySelectorAll("input, select"));
                const index = inputs.indexOf(e.currentTarget);
                if (index > 0) {
                    (inputs[index - 1] as HTMLElement).focus();
                }
            }
        }
    };

    // Manejar Enter en botones
    const handleKeyDown = (e: React.KeyboardEvent, action: () => void) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            action();
        }
    };

    // Modificar hu√©sped
    const modificarHuesped = async () => {
        const payload = {
            huespedID: {
                tipoDocumento: formData.tipoDocumento,
                dni: formData.dni,
            },
            nombre: formData.nombre,
            apellido: formData.apellido,
            cuit: formData.cuit,
            posicionIva: formData.posicionIva,
            fechaNacimiento: formData.fechaNacimiento,
            telefono: formData.telefono,
            email: formData.email,
            ocupacion: formData.ocupacion,
            nacionalidad: formData.nacionalidad,
            direccion: {
                calle: formData.calle,
                numero: formData.numero ? parseInt(formData.numero) : null,
                departamento: formData.departamento,
                piso: formData.piso ? parseInt(formData.piso) : null,
                codigoPostal: formData.codigoPostal ? parseInt(formData.codigoPostal) : null,
                localidad: formData.localidad,
                provincia: formData.provincia,
                pais: formData.pais,
            },
        };

        try {
            await axios.put("http://localhost:8080/huespedes/modificar", payload);
            setErrores([]);
            setErroresTipo([]);
            setMostrarExito(true);
        } catch (err) {
            console.error("Error al modificar:", err);
            alert("Error al conectar con el servidor.");
        }
    };

    // Guardar sin validar DNI (cuando se acepta igualmente)
    const handleGuardarSinValidarDni = async () => {
        setMostrarErrorDni(false);
        setErrores([]);
        await modificarHuesped();
    };

    // Manejar env√≠o del formulario
    const handleSiguiente = async () => {
        const { errores: erroresValidacion, erroresTipo: erroresTipoValidacion } = validarFormularioHuesped(formData);

        setErrores(erroresValidacion);
        setErroresTipo(erroresTipoValidacion);

        // Validar campos obligatorios primero (paso 2.A)
        if (erroresValidacion.length > 0 || erroresTipoValidacion.length > 0) {
            return;
        }

        // Verificar si el DNI cambi√≥ y ya existe (paso 2.B)
        const dniCambio = formData.tipoDocumento !== huespedOriginal?.huespedID.tipoDocumento || 
                          formData.dni !== huespedOriginal?.huespedID.dni;

        if (dniCambio) {
            try {
                const existe = await axios.get("http://localhost:8080/huespedes", {
                    params: {
                        dni: formData.dni,
                        tipoDocumento: formData.tipoDocumento
                    }
                });

                if (existe.data.length > 0) {
                    setMostrarErrorDni(true);
                    return;
                }
            } catch (error) {
                console.error("Error verificando DNI:", error);
            }
        }

        // Si todo est√° OK, modificar
        await modificarHuesped();
    };

    // Verificar si el hu√©sped se ha alojado
    const verificarAlojamiento = async () => {
        if (!huespedOriginal) return false;
        
        try {
            // Intentar verificar si el hu√©sped tiene reservas o estad√≠as
            // Esto puede variar seg√∫n la implementaci√≥n del backend
            try {
                const response = await axios.get(`http://localhost:8080/huespedes/${huespedOriginal.huespedID.tipoDocumento}/${huespedOriginal.huespedID.dni}/tieneAlojamientos`);
                return response.data === true || response.data === "true";
            } catch {
                // Si ese endpoint no existe, intentar verificar por reservas
                try {
                    const reservas = await axios.get(`http://localhost:8080/reservas`, {
                        params: {
                            tipoDocumento: huespedOriginal.huespedID.tipoDocumento,
                            dni: huespedOriginal.huespedID.dni
                        }
                    });
                    return reservas.data && reservas.data.length > 0;
                } catch {
                    // Si no hay forma de verificar, asumimos que no se ha alojado
                    return false;
                }
            }
        } catch (error) {
            console.error("Error verificando alojamientos:", error);
            return false;
        }
    };

    // Manejar borrado
    const handleBorrar = async () => {
        if (!huespedOriginal) return;

        // Verificar si se ha alojado
        const tieneAlojamientos = await verificarAlojamiento();
        
        if (tieneAlojamientos) {
            setMostrarConfirmarEliminar(false);
            setMostrarNoSePuedeEliminar(true);
            return;
        }

        // Mostrar confirmaci√≥n
        setMostrarConfirmarEliminar(true);
    };

    // Confirmar eliminaci√≥n
    const confirmarEliminacion = async () => {
        if (!huespedOriginal) return;

        try {
            await axios.delete(
                `http://localhost:8080/huespedes/${huespedOriginal.huespedID.tipoDocumento}/${huespedOriginal.huespedID.dni}`
            );
            setMostrarConfirmarEliminar(false);
            setMostrarEliminado(true);
        } catch (error) {
            console.error("Error al eliminar:", error);
            alert("Error al eliminar el hu√©sped.");
        }
    };

    // Cerrar cartel de eliminado y volver al men√∫
    const handleCerrarEliminado = () => {
        sessionStorage.removeItem('huespedSeleccionado');
        setMostrarEliminado(false);
        router.push('/menu');
    };

    if (!huespedOriginal) {
        return (
            <main className="flex items-center justify-center min-h-screen bg-gradient-to-br from-gray-50 to-gray-100">
                <div className="text-center">
                    <p className="text-gray-600">Cargando datos del hu√©sped...</p>
                </div>
            </main>
        );
    }

  return (
        <main className="flex gap-8 px-8 py-8 items-start bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
            <div className="w-full max-w-7xl mx-auto">
                {/* T√çTULO */}
                <div className="bg-white rounded-xl shadow-lg p-6 mb-6">
                    <h1 className="text-3xl font-bold text-indigo-950 mb-2">Modificar Hu√©sped</h1>
                    <p className="text-gray-600">Modifique los datos que desee cambiar y presione "Siguiente"</p>
                </div>

                {/* FORMULARIOS */}
                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {/* FORMULARIO 1 - Datos Personales */}
                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <h2 className="text-xl font-bold text-indigo-950 mb-4 pb-3 border-b-2 border-indigo-200">
                            Datos Personales
                        </h2>
                        <form className="flex flex-col space-y-4">
                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Apellido*:</label>
                                <input
                                    name="apellido"
                                    value={formData.apellido}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("apellido")}
                                    placeholder="Apellido"
                                />
                                {erroresTipo.includes("apellido") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese solo letras.</p>
                                )}
                                {errores.includes("apellido") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Nombre*:</label>
                                <input
                                    name="nombre"
                                    value={formData.nombre}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("nombre")}
                                    placeholder="Nombre"
                                />
                                {erroresTipo.includes("nombre") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese solo letras.</p>
                                )}
                                {errores.includes("nombre") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Tipo de Documento*:</label>
                                <select
                                    name="tipoDocumento"
                                    value={formData.tipoDocumento}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    className={getInputClass("tipoDocumento")}
                                >
                                    <option value="">Seleccionar tipo</option>
                                    <option value="DNI">DNI</option>
                                    <option value="LE">LE</option>
                                    <option value="LC">LC</option>
                                    <option value="PASAPORTE">Pasaporte</option>
                                    <option value="OTRO">Otro</option>
                                </select>
                                {errores.includes("tipoDocumento") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">N√∫mero de Documento*:</label>
                                <input
                                    name="dni"
                                    value={formData.dni}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("dni")}
                                    placeholder="N√∫mero de Documento"
                                />
                                {erroresTipo.includes("dni") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese un DNI v√°lido.</p>
                                )}
                                {errores.includes("dni") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">CUIT:</label>
                                <input
                                    name="cuit"
                                    value={formData.cuit}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("cuit")}
                                    placeholder="XX-XXXXXXXX-X"
                                />
                                {erroresTipo.includes("cuit") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese un CUIT v√°lido.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Posici√≥n frente al IVA*:</label>
                                <input
                                    name="posicionIva"
                                    value={formData.posicionIva}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("posicionIva")}
                                    placeholder="Ej: CONSUMIDOR FINAL"
                                />
                                {erroresTipo.includes("posicionIva") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese solo letras.</p>
                                )}
                                {errores.includes("posicionIva") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>
                        </form>
                    </div>

                    {/* FORMULARIO 2 - Direcci√≥n */}
                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <h2 className="text-xl font-bold text-indigo-950 mb-4 pb-3 border-b-2 border-indigo-200">
                            Direcci√≥n
                        </h2>
                        <form className="flex flex-col space-y-4">
                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Calle*:</label>
                                <input
                                    name="calle"
                                    value={formData.calle}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("calle")}
                                    placeholder="Calle"
                                />
                                {erroresTipo.includes("calle") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese solo letras.</p>
                                )}
                                {errores.includes("calle") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">N√∫mero*:</label>
                                <input
                                    name="numero"
                                    value={formData.numero}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("numero")}
                                    placeholder="N√∫mero"
                                />
                                {erroresTipo.includes("numero") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese solo n√∫meros.</p>
                                )}
                                {errores.includes("numero") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Departamento:</label>
                                <input
                                    name="departamento"
                                    value={formData.departamento}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className="w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent border-gray-300 hover:border-indigo-400"
                                    placeholder="Departamento"
                                />
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Piso:</label>
                                <input
                                    name="piso"
                                    value={formData.piso}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className="w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent border-gray-300 hover:border-indigo-400"
                                    placeholder="Piso"
                                />
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">C√≥digo Postal*:</label>
                                <input
                                    name="codigoPostal"
                                    value={formData.codigoPostal}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("codigoPostal")}
                                    placeholder="C√≥digo Postal"
                                />
                                {erroresTipo.includes("codigoPostal") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese solo n√∫meros.</p>
                                )}
                                {errores.includes("codigoPostal") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Localidad*:</label>
                                <input
                                    name="localidad"
                                    value={formData.localidad}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("localidad")}
                                    placeholder="Localidad"
                                />
                                {erroresTipo.includes("localidad") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese solo letras.</p>
                                )}
                                {errores.includes("localidad") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Provincia*:</label>
                                <input
                                    name="provincia"
                                    value={formData.provincia}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("provincia")}
                                    placeholder="Provincia"
                                />
                                {erroresTipo.includes("provincia") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese solo letras.</p>
                                )}
                                {errores.includes("provincia") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Pa√≠s*:</label>
                                <input
                                    name="pais"
                                    value={formData.pais}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("pais")}
                                    placeholder="Pa√≠s"
                                />
                                {erroresTipo.includes("pais") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese solo letras.</p>
                                )}
                                {errores.includes("pais") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>
                        </form>
                    </div>

                    {/* FORMULARIO 3 - Contacto y Otros */}
                    <div className="bg-white rounded-xl shadow-lg p-6">
                        <h2 className="text-xl font-bold text-indigo-950 mb-4 pb-3 border-b-2 border-indigo-200">
                            Contacto y Otros
                        </h2>
                        <form className="flex flex-col space-y-4">
                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Fecha de Nacimiento*:</label>
                                <input
                                    name="fechaNacimiento"
                                    value={formData.fechaNacimiento}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="date"
                                    className={getInputClass("fechaNacimiento")}
                                />
                                {erroresTipo.includes("fechaNacimiento") && (
                                    <p className="text-red-600 text-xs mt-1">Fecha inv√°lida.</p>
                                )}
                                {errores.includes("fechaNacimiento") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Tel√©fono*:</label>
                                <input
                                    name="telefono"
                                    value={formData.telefono}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("telefono")}
                                    placeholder="Tel√©fono"
                                />
                                {erroresTipo.includes("telefono") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese un tel√©fono v√°lido.</p>
                                )}
                                {errores.includes("telefono") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Email:</label>
                                <input
                                    name="email"
                                    value={formData.email}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="email"
                                    className={getInputClass("email")}
                                    placeholder="Email"
                                />
                                {erroresTipo.includes("email") && (
                                    <p className="text-red-600 text-xs mt-1">Email inv√°lido.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Ocupaci√≥n*:</label>
                                <input
                                    name="ocupacion"
                                    value={formData.ocupacion}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("ocupacion")}
                                    placeholder="Ocupaci√≥n"
                                />
                                {erroresTipo.includes("ocupacion") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese solo letras.</p>
                                )}
                                {errores.includes("ocupacion") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>

                            <div>
                                <label className="text-indigo-950 font-semibold mb-2 block text-sm">Nacionalidad*:</label>
                                <input
                                    name="nacionalidad"
                                    value={formData.nacionalidad}
                                    onChange={handleChange}
                                    onBlur={handleBlur}
                                    onKeyDown={handleKeyDownInput}
                                    type="text"
                                    className={getInputClass("nacionalidad")}
                                    placeholder="Nacionalidad"
                                />
                                {erroresTipo.includes("nacionalidad") && (
                                    <p className="text-red-600 text-xs mt-1">Ingrese solo letras.</p>
                                )}
                                {errores.includes("nacionalidad") && (
                                    <p className="text-red-600 text-xs mt-1">Campo obligatorio.</p>
                                )}
                            </div>
      </form>
                    </div>
                </div>

                {/* BOTONES DE ACCI√ìN */}
                <div className="flex justify-center gap-4 mt-6">
                    <button
                        type="button"
                        onKeyDown={(e) => handleKeyDown(e, () => setMostrarCancelar(true))}
                        onClick={() => setMostrarCancelar(true)}
                        className="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all shadow-md hover:shadow-lg font-semibold"
                    >
                        Cancelar
                    </button>

                    <button
                        type="button"
                        onKeyDown={(e) => handleKeyDown(e, handleBorrar)}
                        onClick={handleBorrar}
                        className="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all shadow-md hover:shadow-lg font-semibold"
                    >
                        Borrar
                    </button>

                    <button
                        type="button"
                        onKeyDown={(e) => handleKeyDown(e, handleSiguiente)}
                        onClick={handleSiguiente}
                        className="px-6 py-3 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105"
                    >
                        Siguiente
                    </button>
                </div>

                {/* MENSAJE DE ERRORES */}
                {(errores.length > 0 || erroresTipo.length > 0) && (
                    <div className="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded-lg mt-6 shadow-md">
                        <p className="font-semibold mb-2">Errores encontrados:</p>
                        <ul className="list-disc list-inside">
                            {errores.map((error, index) => (
                                <li key={index} className="text-sm">El campo "{error}" es obligatorio.</li>
                            ))}
                            {erroresTipo.map((error, index) => (
                                <li key={index} className="text-sm">El campo "{error}" tiene un formato inv√°lido.</li>
                            ))}
                        </ul>
                    </div>
                )}
            </div>

            {/* CARTELES */}
            {mostrarCancelar && (
                <CancelarModificacion
                    onSi={() => {
                        sessionStorage.removeItem('huespedSeleccionado');
                        router.push('/menu');
                    }}
                    onNo={() => setMostrarCancelar(false)}
                />
            )}

            {mostrarExito && (
                <ModificacionExitosa
                    onClose={() => {
                        sessionStorage.removeItem('huespedSeleccionado');
                        setMostrarExito(false);
                        router.push('/menu');
                    }}
                />
            )}

            {mostrarErrorDni && (
                <ErrorDniExistente
                    mensaje="¬°CUIDADO! El tipo y n√∫mero de documento ya existen en el sistema"
                    onCorregir={() => {
                        setErrores(["tipoDocumento", "dni"]);
                        setMostrarErrorDni(false);
                        // Enfocar en tipo de documento
                        const tipoDocInput = document.querySelector('select[name="tipoDocumento"]') as HTMLSelectElement;
                        if (tipoDocInput) tipoDocInput.focus();
                    }}
                    onAceptar={handleGuardarSinValidarDni}
                />
            )}

            {mostrarConfirmarEliminar && huespedOriginal && (
                <ConfirmarEliminarHuesped
                    nombre={huespedOriginal.nombre}
                    apellido={huespedOriginal.apellido}
                    tipoDocumento={huespedOriginal.huespedID.tipoDocumento}
                    dni={huespedOriginal.huespedID.dni}
                    onEliminar={confirmarEliminacion}
                    onCancelar={() => setMostrarConfirmarEliminar(false)}
                />
            )}

            {mostrarEliminado && huespedOriginal && (
                <HuespedEliminado
                    nombre={huespedOriginal.nombre}
                    apellido={huespedOriginal.apellido}
                    tipoDocumento={huespedOriginal.huespedID.tipoDocumento}
                    dni={huespedOriginal.huespedID.dni}
                    onClose={handleCerrarEliminado}
                />
            )}

            {mostrarNoSePuedeEliminar && (
                <NoSePuedeEliminarHuesped
                    onClose={() => {
                        setMostrarNoSePuedeEliminar(false);
                    }}
                />
            )}
    </main>
  );
}
//[ocuparHabitacion/page.tsx]
'use client';

import React, { useState, useEffect } from "react";
import { format, parseISO, eachDayOfInterval, isAfter } from "date-fns";
import axios from "axios";

import HabitacionReservadaOcuparIgual from "../carteles/habitacionReservadaOcuparIgual";
import CartelHabitacionNoDisponible from "../carteles/CartelHabitacionNoDisponible";
import CartelHabitacionesOcupadas from "../carteles/cartelHabitacionesOcupadas";
import CartelPresioneTecla from "../carteles/CartelPresioneTecla";
import Link from "next/link";

import { validarFechasReserva } from "@/app/validaciones/validaciones";


// =========================
// TIPOS E INTERFACES
// =========================
type TipoHabitacion = "IndividualEstandar" | "DobleEstandar" | "Suite" | "DobleSuperior" | "SuperiorFamilyPlan";

interface ReservaDTO {
  nro_habitacion: number;
  fecha_desde: string;
  fecha_hasta: string;
  estado: string;
  nombre: string;
  apellido: string;
  telefono?: number;
}


interface EstadiaDTO {
  checkin: string;
  checkout: string;
}

interface HabitacionDTO {
  numero: number;
  estado: string;
  precio: number;
  cantidadPersonas: number;
  tipohabitacion: string;
  listareservas: ReservaDTO[];
  listaestadias: EstadiaDTO[];
}

interface Props {
  ocultarTabla?: boolean;
}



export default function OcuparHabitacion({ ocultarTabla = false }: Props) {

  // =========================
  // ESTADOS
  // =========================
  const [desdeFecha, setDesdeFecha] = useState("");
  const [hastaFecha, setHastaFecha] = useState("");
  const [tipoSeleccionado, setTipoSeleccionado] = useState<"" | TipoHabitacion>("");
  const [erroresFecha, setErroresFecha] = useState({ desdeInvalido: false, hastaInvalido: false, ordenInvalido: false });
  const [fechasValidas, setFechasValidas] = useState(false);

  // Estados para mostrar carteles
  const [mostrarCartelNoDisponible, setMostrarCartelNoDisponible] = useState(false);
  const [mostrarCartelReservada, setMostrarCartelReservada] = useState(false);
  const [mostrarCartelLista, setMostrarCartelLista] = useState(false);
  const [mostrarCartelPresioneTecla, setMostrarCartelPresioneTecla] = useState(false);

  const [habitacionesSeleccionadas, setHabitacionesSeleccionadas] = useState<Record<number, HabitacionDTO>>({});


  const [habitaciones, setHabitaciones] = useState<HabitacionDTO[] | []>([]);
  const [seleccionados, setSeleccionados] = useState<string[]>([]);


  const [mensajeReserva, setMensajeReserva] = useState("");



  //const [mostrarCartelReservada, setMostrarCartelReservada] = useState(false);


// =========================
  // VALIDAR FECHAS
  // =========================
  function validarDesde(fecha: string) {
    const result = validarFechasReserva(fecha, hastaFecha);
    setErroresFecha(result);
    setFechasValidas(result.valido);
  }

  function validarHasta(fecha: string) {
    const result = validarFechasReserva(desdeFecha, fecha);
    setErroresFecha(result);
    setFechasValidas(result.valido);
  }

  // =========================
  // FETCH DE DATOS
  // =========================
  useEffect(() => {
    const fetchDetalleHabitaciones = async () => {
      if (fechasValidas && tipoSeleccionado) {
        try {
          const response = await axios.get(`http://localhost:8080/detalleHabitaciones`, {
            params: {
              tipo: tipoSeleccionado,
              fechaDesde: desdeFecha,
              fechaHasta: hastaFecha
            },
          });
          setHabitaciones(response.data);
        } catch(err) {
          console.error("Error al cargar detalle habitaciones:", err);
          // MOCK DATA en caso de error para visualizaci√≥n
          const mockHabitaciones: HabitacionDTO[] = Array.from({length: 5}, (_, i) => ({
             numero: 101 + i,
             estado: i === 2 ? "FueraDeServicio" : "DISPONIBLE",
             precio: 100,
             cantidadPersonas: 2,
             tipohabitacion: tipoSeleccionado || "DobleEstandar",
             listareservas: i === 1 ? [{ nro_habitacion: 102, fecha_desde: desdeFecha, fecha_hasta: hastaFecha, estado: "RESERVADA", nombre: "MockNombre", apellido: "MockApellido" }] : [],
             listaestadias: i === 3 ? [{ checkin: desdeFecha, checkout: hastaFecha }] : []
          }));
          setHabitaciones(mockHabitaciones);
        }
      }
    };
    fetchDetalleHabitaciones();
  }, [fechasValidas, tipoSeleccionado, desdeFecha, hastaFecha]);

  // =========================
  // L√ìGICA DE SELECCI√ìN
  // =========================
  const fechasIntervalo = (desdeFecha && hastaFecha && fechasValidas)
    ? eachDayOfInterval({ start: parseISO(desdeFecha), end: parseISO(hastaFecha) })
    : [];

  const normalizar = (f?: string) => {
    if (!f) return "";
    return f.includes("T") ? f.split("T")[0] : f;
  };

  const fechaEnRango = (fechaTarget: string, inicio?: string, fin?: string) => {
    const i = normalizar(inicio);
    const f = normalizar(fin);
    if (!i || !f) return false;         // si faltan fechas, no hay rango v√°lido
    return fechaTarget >= i && fechaTarget <= f;
  };


    const ejecutarSeleccion = (fechaString: string, habitacion: HabitacionDTO) => {
      const key = `${fechaString}|${habitacion.numero}`;
      setSeleccionados(prev =>
        prev.includes(key) ? prev.filter(item => item!==key) : [...prev, key]
      );

      // Guardar la habitaci√≥n completa en el estado global
      setHabitacionesSeleccionadas(prev => ({
        ...prev,
        [habitacion.numero]: habitacion
      }));
  };


  const handleClickCelda = (fechaDate: Date, hab: HabitacionDTO) => {
    const fechaString = format(fechaDate, "yyyy-MM-dd");

    const esFueraServicio = hab.estado === "FueraDeServicio";

    const esOcupada = hab.listaestadias?.some(e =>
      fechaEnRango(fechaString, e.checkin, e.checkout)
    );

    // ‚ùå NO SE PUEDE TOCAR: OCUPADA / FUERA DE SERVICIO
    if (esFueraServicio || esOcupada) {
      setMostrarCartelNoDisponible(true);
      return;
    }

    // ‚úÖ DISPONIBLE O RESERVADA
    // Se selecciona directamente. El color verde lo dar√° el render al detectar que est√° en "seleccionados"
    ejecutarSeleccion(fechaString, hab);
  };



              const confirmarOcupacionEstadia = async () => {
          // Primero generamos la nueva lista ACTUALIZADA
          const nuevasHabitaciones = Object.values(habitacionesSeleccionadas).map(h => {
  const fechasDeEsta = seleccionados
      .filter(s => s.split("|")[1] === String(h.numero))
      .map(s => s.split("|")[0])
      .sort();

  if (fechasDeEsta.length === 0) return h;

  const nuevosRangos: { checkin: string; checkout: string }[] = [];

  let inicio = fechasDeEsta[0];
  let fin = fechasDeEsta[0];

  for (let i = 1; i < fechasDeEsta.length; i++) {
      const fechaActual = fechasDeEsta[i];
      const fechaAnterior = fechasDeEsta[i - 1];
      const difDias = (parseISO(fechaActual).getTime() - parseISO(fechaAnterior).getTime()) / (1000*60*60*24);

      if (difDias === 1) {
          fin = fechaActual;
      } else {
          nuevosRangos.push({ checkin: inicio, checkout: fin });
          inicio = fechaActual;
          fin = fechaActual;
      }
  }

  nuevosRangos.push({ checkin: inicio, checkout: fin });

  return {
      ...h,
      listaestadias: [...(h.listaestadias || []), ...nuevosRangos]
  };
});


    // Ahora s√≠ actualizamos el estado
    setHabitaciones(nuevasHabitaciones);

    // üì® ENVIAR AL BACK DESDE nuevasHabitaciones (NO desde habitaciones)
    try {
        for (const h of nuevasHabitaciones) {
            const fechasDeEsta = seleccionados.filter(s => s.split("|")[1] === String(h.numero));
            if (fechasDeEsta.length === 0) continue;

                    const fechasOrdenadas = fechasDeEsta.map(s => s.split("|")[0]).sort();

                    const rangos: { checkin: string; checkout: string }[] = [];
                    let ini = fechasOrdenadas[0];
                    let fin = fechasOrdenadas[0];

                    for (let i = 1; i < fechasOrdenadas.length; i++) {
                        const actual = fechasOrdenadas[i];
                        const anterior = fechasOrdenadas[i - 1];

                        const dA = parseISO(actual);
                        const dB = parseISO(anterior);
                        const dif =
                            (dA.getTime() - dB.getTime()) / (1000 * 60 * 60 * 24);

                        if (dif === 1) {
                            fin = actual;
                        } else {
                            rangos.push({ checkin: ini, checkout: fin });
                            ini = actual;
                            fin = actual;
                        }
                    }

                    rangos.push({ checkin: ini, checkout: fin });

                    // Enviar cada rango
                    for (const r of rangos) {
                        const estadiaDTO = {
                            checkin: r.checkin,
                            checkout: r.checkout,
                            habitacion: h   // ‚Üê OBJETO COMPLETO, NO STRING
                        };

                        await fetch("http://localhost:8080/estadias", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(estadiaDTO),
                        });
                    }
                }
            } catch (error) {
                console.error("‚ùå Error enviando estad√≠as:", error);
            }

            // Limpiar selecci√≥n y carteles
            setSeleccionados([]);
            setMostrarCartelLista(false);
            setMostrarCartelPresioneTecla(true);
        };





  // =========================
  // L√ìGICA BOT√ìN ACEPTAR
  // =========================
  const handleAceptar = () => {
    const conflictos: {
        numero: number;
        desde: string;
        hasta: string;
        nombre: string;
        apellido: string;
        fecha: string;
    }[] = [];

    for (const sel of seleccionados) {
        const [fechaStr, habStr] = sel.split("|");
        const numero = Number(habStr);

        const habitacion = habitaciones.find(h => h.numero === numero);
        if (!habitacion || !habitacion.listareservas) continue;

        const reservaSolapada = habitacion.listareservas.find(r =>
        fechaEnRango(fechaStr, r.fecha_desde, r.fecha_hasta)
        );

        if (reservaSolapada) {
        conflictos.push({
            numero,
            desde: reservaSolapada.fecha_desde,
            hasta: reservaSolapada.fecha_hasta,
            nombre: reservaSolapada.nombre,
            apellido: reservaSolapada.apellido,
            fecha: fechaStr
        });
        }
    }

    // Si hay uno o varios conflictos ‚Üí armar mensaje m√∫ltiple
    if (conflictos.length > 0) {
        let msg = "Conflictos encontrados:\n\n";

        conflictos.forEach(c => {
        msg +=
            `Habitaci√≥n ${c.numero}\n` +
            `Fecha seleccionada: ${ format(parseISO(c.fecha), "dd/MM/yyyy") }\n` +
            `Reservada desde: ${ format(parseISO(c.desde), "dd/MM/yyyy") }\n` +
            `Reservada Hasta: ${ format(parseISO(c.hasta), "dd/MM/yyyy") }\n` +
            `A nombre de: ${c.nombre} ${c.apellido}\n\n`;
        });

        setMensajeReserva(msg);
        setMostrarCartelReservada(true);
        return;
    }

    // Si no hay conflictos
    setMostrarCartelLista(true);
    };



  // =========================
  // RENDER
  // =========================
  return (
    <main className="flex gap-8 px-6 py-6 items-start">

      {/* =========================
          CARTELES
      ========================== */}
      {mostrarCartelNoDisponible && (
        <CartelHabitacionNoDisponible
          mensaje="La habitaci√≥n seleccionada no se encuentra disponible"
          onClose={() => setMostrarCartelNoDisponible(false)}
        />
      )}

      {mostrarCartelReservada && (
        <HabitacionReservadaOcuparIgual
            mensajeExtra={mensajeReserva}
            onClose={() => setMostrarCartelReservada(false)}
            onConfirm={() => {
            setMostrarCartelReservada(false);
            setMostrarCartelLista(true); // Abre lista despu√©s de "Ocupar igual"
            }}
        />
        )}

        {mostrarCartelLista && (
          <CartelHabitacionesOcupadas
            lista={seleccionados}
            desdeFecha={desdeFecha}
            hastaFecha={hastaFecha}
            onClose={() => setMostrarCartelLista(false)}
            onConfirm={confirmarOcupacionEstadia}   // üëà AC√Å SE EJECUTA TODO
          />
        )}


        {mostrarCartelPresioneTecla && (
        <CartelPresioneTecla onClose={() => setMostrarCartelPresioneTecla(false)} />
        )}




      {/* FORMULARIO LATERAL */}
      <form className="flex flex-col justify-center">
        <label className="text-indigo-950 font-medium mb-1">Desde Fecha:</label>
        <input
          type="date"
          value={desdeFecha}
          onChange={(e) => setDesdeFecha(e.target.value)}
          onBlur={(e) => validarDesde(e.target.value)}
          className={`p-2 border rounded mb-1 text-indigo-950
            ${(erroresFecha.desdeInvalido || erroresFecha.ordenInvalido || (!desdeFecha && tipoSeleccionado))
              ? "border-red-500 bg-red-100"
              : ""}`}
        />
        {erroresFecha.desdeInvalido && <span className="text-red-600 text-sm mb-2 block">La fecha no puede ser menor a hoy</span>}
        {erroresFecha.ordenInvalido && <span className="text-red-600 text-sm mb-2 block">La fecha "Desde" no puede ser posterior a "Hasta"</span>}

        <label className="text-indigo-950 font-medium mb-1">Hasta Fecha:</label>
        <input
          type="date"
          value={hastaFecha}
          onChange={(e) => setHastaFecha(e.target.value)}
          onBlur={(e) => validarHasta(e.target.value)}
          className={`p-2 border rounded mb-1 text-indigo-950
            ${(erroresFecha.hastaInvalido || erroresFecha.ordenInvalido || (!hastaFecha && tipoSeleccionado))
              ? "border-red-500 bg-red-100"
              : ""}`}
        />
        {erroresFecha.hastaInvalido && <span className="text-red-600 text-sm mb-2 block">La fecha no puede ser menor a hoy</span>}
        {erroresFecha.ordenInvalido && <span className="text-red-600 text-sm mb-2 block">La fecha "Hasta" no puede ser anterior a "Desde"</span>}

        <label className="text-indigo-950 font-medium mb-1">Tipo de Habitaci√≥n:</label>
        <select
          value={tipoSeleccionado}
          onChange={(e) => setTipoSeleccionado(e.target.value as TipoHabitacion)}
          onFocus={() => {
            setErroresFecha(prev => ({
              desdeInvalido: prev.desdeInvalido || !desdeFecha,
              hastaInvalido: prev.hastaInvalido || !hastaFecha,
              ordenInvalido: prev.ordenInvalido
            }));
          }}
          className={`p-2 border rounded mb-4 text-indigo-950 ${!fechasValidas ? "bg-gray-200 cursor-not-allowed" : ""}`}
        >
          <option value="" disabled>Seleccionar tipo</option>
          <option value="IndividualEstandar">Individual Estandar</option>
          <option value="DobleEstandar">Doble Estandar</option>
          <option value="DobleSuperior">Doble Superior</option>
          <option value="SuperiorFamilyPlan">Superior Family Plan</option>
          <option value="Suite">Suite</option>
        </select>
      </form>

      {/* TABLA Y CONTENIDO DERECHO */}
      <section className="flex-2 max-h-[800px]">
        {tipoSeleccionado && fechasIntervalo.length > 0 ? (
          <>
            <table className="w-full border-collapse border shadow-lg">
              <thead className="bg-indigo-950 text-white sticky top-0 z-10">
                <tr>
                  <th className="p-2">Fecha</th>
                  <th colSpan={habitaciones.length} className="p-2">Habitaciones</th>
                </tr>
                {/* Fila de n√∫meros de habitaci√≥n */}
                <tr className="text-indigo-950 bg-white">
                   <td className="p-2 border"></td>
                   {habitaciones.map(h => (
                     <td key={h.numero} className="p-2 border text-center">{h.numero}</td>
                   ))}
                </tr>
              </thead>

              <tbody>
                {fechasIntervalo.map(fechaDate => {
                  const fechaString = format(fechaDate, "yyyy-MM-dd");
                  const fechaDisplay = format(fechaDate, "dd/MM/yyyy");

                  return (
                    <tr key={fechaString}>
                      <td className="p-2 border text-center font-medium bg-white">
                        {fechaDisplay}
                      </td>

                      {habitaciones.map(h => {
                        const esFueraServicio = h.estado === "FueraDeServicio";
                        const esOcupada = h.listaestadias?.some(e => fechaEnRango(fechaString, e.checkin, e.checkout));
                        const esReservada = h.listareservas?.some(r => fechaEnRango(fechaString, r.fecha_desde, r.fecha_hasta));

                        const key = `${fechaString}|${h.numero}`;
                        const esSeleccionada = seleccionados.includes(key);

                        let bg = "bg-white";
                        if (esFueraServicio) bg = "bg-gray-700";
                        else if (esOcupada) bg = "bg-blue-900";
                        else if (esSeleccionada) bg = "bg-green-500";
                        else if (esReservada) bg = "bg-red-500";

                        return (
                          <td
                            key={h.numero}
                            className={`p-4 border cursor-pointer ${bg}`}
                            onClick={() => handleClickCelda(fechaDate, h)}
                          ></td>
                        );
                      })}
                    </tr>
                  );
                })}
              </tbody>
            </table>

            {/* LEYENDA */}
            <ul className="flex items-center gap-2 mt-4 flex-wrap justify-center list-none p-0">
               <li className="flex items-center gap-2 mt-4 flex-wrap justify-center">
                 <span className="w-4 h-4 rounded-full bg-red-500"></span><span>RESERVADA</span>
                 <span className="w-4 h-4 rounded-full bg-white border"></span><span>DISPONIBLE</span>
                 <span className="w-4 h-4 rounded-full bg-gray-700"></span><span>FUERA DE SERVICIO</span>
                 <span className="w-4 h-4 rounded-full bg-blue-900"></span><span>OCUPADA</span>
                 <span className="w-4 h-4 rounded-full bg-green-500"></span><span>SELECCIONADA</span>
               </li>
            </ul>

            {/* BOTONES DE ACCI√ìN */}
            <div className="flex justify-center gap-4 mt-6">
                <Link href="/menu">
                <button className="px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800">
                  Cancelar
                </button>
                </Link>


                <button
                  className="px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800"
                  onClick={handleAceptar}
                  disabled={seleccionados.length === 0}
                >
                  Aceptar
                </button>
            </div>
          </>
        ) : (
            <div className="text-gray-400 text-center mt-20">
                Seleccione un rango de fechas y tipo para ver la disponibilidad.
            </div>
        )}
      </section>
    </main>
  );
}
//[ocuparHabitacion/tabla/page.tsx]
import { useState } from "react";

export type TipoHuesped = {
    id: number;
    nombre: string;
    apellido: string;
    fechaNacimiento: string;
    nacionalidad: string;
    ocupacion: string;
    email: string;
    telefono: string;

    direccionHuesped: {
        calle: string;
        numero: number;
        piso: number | null;
        departamento: string | null;
        codigoPostal: number;
        localidad: string;
        provincia: string;
        pais: string;
    };

    cuit: string;
    posicionIva: string;
    huespedID: {
        tipoDocumento: string;
        dni: string;
    };
};

type TablaProps = {
    huespedes: TipoHuesped[];
    toggleSeleccion: (h: TipoHuesped) => void;  
    seleccionados: TipoHuesped[];               
    setSeleccionado: (h: TipoHuesped) => void;
};

type SortKey = keyof TipoHuesped | "dni" | "tipoDocumento";

export default function Tabla({ huespedes, toggleSeleccion, seleccionados }: TablaProps) {

    const [sortConfig, setSortConfig] = useState<{ key: SortKey | null; direction: 'asc' | 'desc' }>({
        key: "apellido",
        direction: 'asc'
    });

    const sortedHuespedes = [...huespedes].sort((a, b) => {
        if (!sortConfig.key) return 0;

        const key = sortConfig.key;

        let aValue: any = a;
        let bValue: any = b;

        if (key === "dni") {
            aValue = a.huespedID.dni;
            bValue = b.huespedID.dni;
        } else if (key === "tipoDocumento") {
            aValue = a.huespedID.tipoDocumento;
            bValue = b.huespedID.tipoDocumento;
        } else {
            aValue = a[key];
            bValue = b[key];
        }

        if (aValue < bValue) return sortConfig.direction === "asc" ? -1 : 1;
        if (aValue > bValue) return sortConfig.direction === "asc" ? 1 : -1;
        return 0;
    });

    const handleSort = (key: SortKey) => {
        let direction: 'asc' | 'desc' = 'asc';

        if (sortConfig.key === key && sortConfig.direction === 'asc') {
            direction = 'desc';
        }

        setSortConfig({ key, direction });
    };

    return (
        <section className="flex-1 overflow-y-auto max-h-[400px]">
            <table className="w-full border-collapse border shadow-lg">
                <thead className="bg-indigo-950 text-white sticky top-0">
                    <tr>
                        <th className="p-3 border">Seleccionar</th>
                        <th className="p-3 border" onClick={() => handleSort("apellido")}>Apellido ‚Üë‚Üì</th>
                        <th className="p-3 border" onClick={() => handleSort("nombre")}>Nombre ‚Üë‚Üì</th>
                        <th className="p-3 border" onClick={() => handleSort("tipoDocumento")}>Tipo Doc ‚Üë‚Üì</th>
                        <th className="p-3 border" onClick={() => handleSort("dni")}>DNI ‚Üë‚Üì</th>
                    </tr>
                </thead>

                <tbody>
                    {sortedHuespedes.map((h) => {
                        const seleccionado = seleccionados.some(
                            (sel) =>
                                sel.huespedID.dni === h.huespedID.dni &&
                                sel.huespedID.tipoDocumento === h.huespedID.tipoDocumento
                        );

                        return (
                            <tr key={h.huespedID.tipoDocumento + h.huespedID.dni} className="bg-white hover:bg-indigo-100">
                                <td className="p-2 border text-center">
                                    <input
                                        type="checkbox"
                                        checked={seleccionados.some(
                                            (s) =>
                                                s.huespedID.dni === h.huespedID.dni &&
                                                s.huespedID.tipoDocumento === h.huespedID.tipoDocumento
                                        )}
                                        onChange={() => toggleSeleccion(h)}
                                    />
                                </td>
                                <td className="p-2 border">{h.apellido}</td>
                                <td className="p-2 border">{h.nombre}</td>
                                <td className="p-2 border">{h.huespedID.tipoDocumento}</td>
                                <td className="p-2 border">{h.huespedID.dni}</td>
                            </tr>
                        );
                    })}
                </tbody>
            </table>
        </section>
    );
}
//[ocuparHabitacion/tablaHuespedes/page.tsx]
"use client"
import { useEffect, useState } from "react";
import Tabla from "../tabla/page";
import axios from "axios";
import { TipoHuesped } from "../../tabla/page";
import CartelNoEncontrado from "../../carteles/huespedNoEncontrado";
import Link from "next/link";
import { useRouter } from "next/navigation";
import CartelNoSeleccionoHuesped from "../../carteles/CartelNoSeleccionoHuesped";
import SeleccionarRepresentantes from "../../carteles/SeleccionarRepresentantes";
import SeguirOcuparHabitacion from "../../carteles/SeguirOcuparHabitacion";

export default function BuscarHuespedOcuparHabitacion() { 

    const [dni, setDni] = useState("");
    const [nombre, setNombre] = useState("");
    const [apellido, setApellido] = useState("");
    const [tipoDoc, setTipoDoc] = useState("");
    const [huespedes, setHuespedes] = useState<TipoHuesped[]>([]);
    const [mostrarCartel, setMostrarCartel] = useState(false);

    // ‚úîÔ∏è AGREGAR ESTO ‚Äî hu√©sped √∫nico seleccionado
    const [huespedSeleccionado, setHuespedSeleccionado] = useState<TipoHuesped | null>(null);

    // ‚úîÔ∏è Selecciones m√∫ltiples
    const [huespedesSeleccionados, setHuespedesSeleccionados] = useState<TipoHuesped[]>([]);

    const [mostrarCartelNoSelecciono, setMostrarCartelNoSelecciono] = useState(false);
    const [mostrarCartelRepresentantes, setMostrarCartelRepresentantes] = useState(false);
    const [mostrarSeguir, setMostrarSeguir] = useState(false);

    const router = useRouter();

    // Estados para errores
    const [errorNombre, setErrorNombre] = useState(false);
    const [errorApellido, setErrorApellido] = useState(false);
    const [errorDni, setErrorDni] = useState(false);

    const buscarHuesped = async (e: React.FormEvent) => {
        e.preventDefault();

        const soloLetras = /^[A-Z√Å√â√ç√ì√ö√ë\s]*$/;
        const soloNumeros = /^[0-9]*$/;

        const nombreInvalido = nombre !== "" && !soloLetras.test(nombre);
        const apellidoInvalido = apellido !== "" && !soloLetras.test(apellido);
        const dniInvalido = dni !== "" && !soloNumeros.test(dni);

        setErrorNombre(nombreInvalido);
        setErrorApellido(apellidoInvalido);
        setErrorDni(dniInvalido);

        if (nombreInvalido || apellidoInvalido || dniInvalido) {
            return;
        }

        try {
            const response = await axios.get("http://localhost:8080/huespedes", {
                params: {
                    dni: dni || null,
                    tipoDocumento: tipoDoc || null,
                    nombre: nombre ? `${nombre}%` : null,
                    apellido: apellido ? `${apellido}%` : null
                }
            });

            setHuespedes(response.data);

            if (response.data.length === 0) {
                setMostrarCartel(true);
            }

        } catch (error) {
            console.log("error al cargar huespedes:", error);
        }
    };

    const toggleSeleccion = (huesped: TipoHuesped) => {
        setHuespedesSeleccionados(prev => {
            const existe = prev.some(h => h.huespedID.dni === huesped.huespedID.dni);
            if (existe) {
                return prev.filter(h => h.huespedID.dni !== huesped.huespedID.dni);
            } else {
                return [...prev, huesped];
            }
        });
    };

    // ‚úîÔ∏è funci√≥n que se llama al hacer clic en un √∫nico hu√©sped
    const setSeleccionado = (huesped: TipoHuesped) => {
        setHuespedSeleccionado(huesped);
        console.log("Hu√©sped seleccionado:", huesped);
    };

    const irADarAltaHuesped = () => {
        if (huespedesSeleccionados.length === 0) {
            setMostrarCartelNoSelecciono(true);
            return;
        }

        setMostrarCartelRepresentantes(true);
    };


    const recibirRepresentantes = (representante: TipoHuesped | null) => {
        if (representante) {
            console.log("Representante seleccionado:", representante);
            // Hac√©s lo que necesites con el representante
        }
    };



    return (
        <main className="flex gap-8 px-6 py-6 items-start">

            {/* FORMULARIO */}
            <form onSubmit={buscarHuesped} className="flex flex-col justify-center">
                
                <label className="text-indigo-950 font-medium mb-1">Apellido:</label>
                <input 
                    type="text"
                    placeholder="Apellido"
                    value={apellido}
                    onChange={(e) => setApellido(e.target.value.toUpperCase())}
                    className={`p-2 border rounded mb-1 placeholder-gray-400 text-indigo-950 
                        ${errorApellido ? "border-red-500" : ""}`}
                />
                {errorApellido && <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>}

                <label className="text-indigo-950 font-medium mb-1">Nombre:</label>
                <input 
                    type="text"
                    placeholder="Nombre"
                    value={nombre}
                    onChange={(e) => setNombre(e.target.value.toUpperCase())}
                    className={`p-2 border rounded mb-1 placeholder-gray-400 text-indigo-950
                        ${errorNombre ? "border-red-500" : ""}`}
                />
                {errorNombre && <p className="text-red-500 text-sm mb-3">Ingrese solo letras.</p>}

                <label className="text-indigo-950 font-medium mb-1">Tipo de Documento:</label>
                <select 
                    name="tipoDocumento"
                    value={tipoDoc}
                    onChange={(e) => setTipoDoc(e.target.value.toUpperCase())}
                    className="p-2 border rounded mb-4 text-gray-400 focus:text-indigo-950"
                >
                    <option value="" className="text-gray-400">Seleccionar tipo</option>
                    <option value="DNI">DNI</option>
                    <option value="PASAPORTE">PASAPORTE</option>
                    <option value="LE">LE</option>
                    <option value="LC">LC</option>
                </select>

                <label className="text-indigo-950 font-medium mb-1">N√∫mero de Documento:</label>
                <input 
                    type="text"
                    placeholder="N√∫mero de Documento"
                    value={dni}
                    onChange={(e) => setDni(e.target.value)}
                    className={`p-2 border rounded mb-1 placeholder-gray-400 text-indigo-950
                        ${errorDni ? "border-red-500" : ""}`}
                />
                {errorDni && <p className="text-red-500 text-sm mb-3">Ingrese solo n√∫meros.</p>}

                <button className="self-center px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition">
                    Buscar
                </button>
            </form>

            {/* TABLA */}
            <section className="flex-1 flex flex-col">
                <Tabla 
                    huespedes={huespedes}
                    toggleSeleccion={toggleSeleccion}
                    seleccionados={huespedesSeleccionados}
                    setSeleccionado={setSeleccionado}   // ‚Üê AGREGAR ESTO
                />

                <div className="mt-6 justify-center sticky bottom-0 flex gap-4">
                    <Link className="px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition" href="/menu">
                        Cancelar
                    </Link>
                    
                    <button onClick={irADarAltaHuesped} className="px-4 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition">
                        Siguiente
                    </button>
                </div>
            </section>

            {mostrarCartel && (
                <CartelNoEncontrado onClose={() => setMostrarCartel(false)} />
            )}

            {mostrarCartelNoSelecciono && (
                <CartelNoSeleccionoHuesped
                    onAceptar={() => setMostrarCartelNoSelecciono(false)}  
                />
                )}

            {mostrarCartelRepresentantes && (
                <SeleccionarRepresentantes
                    huespedes={huespedesSeleccionados}
                    onCerrar={() => setMostrarCartelRepresentantes(false)}
                    onAceptar={(rep) => {
                    recibirRepresentantes(rep);
                    setMostrarCartelRepresentantes(false); // cerrar cartel
                    }}
                    onSeguir={() => setMostrarSeguir(true)} // abrir el nuevo cartel
                />
            )}

            {mostrarSeguir && (
                <SeguirOcuparHabitacion
                    onSeguirCargando={() => {
                    console.log("Seguir Cargando Huespedes");
                    setMostrarSeguir(false);
                    }}
                    onCargarMasHabitaciones={() => {
                    console.log("Cargar m√°s Habitaciones");
                    setMostrarSeguir(false);
                    }}
                    onSalir={() => {
                    console.log("Salir");
                    setMostrarSeguir(false);
                    }}
                />
            )}



        </main>
    );
}
//[page.tsx]
import { redirect } from "next/navigation";

export default function Home() {
  redirect("/paginaPrincipal");
}
//[paginaPrincipal/page.tsx]
import { Cormorant_Garamond } from "next/font/google";
import Image from "next/image";
import Link from "next/link";

const cormorant = Cormorant_Garamond({
  subsets: ["latin"],
  weight: ["700"],
});


export default function Home() {
  return (
    <main className=" bg-gray-200">

      <div className="flex flex-col items-center justify-center min-h-screen bg-gray-100">
      <h1 className={`${cormorant.className} text-5xl font-serif text-indigo-950 mb-6`}>
        Welcome to HOTEL PREMIER
      </h1>
        <nav> 
          <Link href="/loging"> 
            <button className="px-6 py-2 bg-indigo-950 text-white rounded hover:bg-indigo-800 transition cursor-pointer">iniciar Sesion</button>
          </Link>
        </nav>

    </div>
    </main>
  );
}
//[reservarHabitacion/page.tsx]
'use client';

import React from "react";
import { useRouter } from "next/navigation";
import { useState, useEffect } from "react";
import { format, parseISO, eachDayOfInterval, isAfter } from "date-fns";
import { usePathname } from "next/navigation";
import OcuparHabitacionIgualmente from "../carteles/ocuparHabitacionIgualmente";
import CartelHabitacionNoDisponible from "../carteles/CartelHabitacionNoDisponible";
import habitacionesSeleccionadas from "../carteles/habitacionesSeleccionadas"
import axios from "axios";
import { FontAwesomeIcon } from "@fortawesome/react-fontawesome";
import { faTrashCan  } from "@fortawesome/free-solid-svg-icons";
import CartelListaHabitaciones from "../carteles/cartelListaHabitaciones";
import Link from "next/link";
import { validarFechasReserva, esSoloLetras, esSoloNumeros, esObligatorio, telefonoValido } from "@/app/validaciones/validaciones";
import ReservaConfirmada from "../carteles/reservaConfirmada";


// =========================
// TIPOS E INTERFACES (COINCIDEN CON  JSON)
// =========================
type TipoHabitacion = "IndividualEstandar" | "DobleEstandar" | "Suite" | "DobleSuperior" | "SuperiorFamilyPlan";

interface ReservaDTO {
  id_reserva?: number;
  fecha_desde: string;
  fecha_hasta: string;
  estado: string;
  nombre?: string;
  apellido?: string;
  telefono?: string;
  habitacion?: {
    numero: number;
    estado: string;
    precio: number;
    cantidadPersonas: number;
    tipohabitacion: string;
  };
}

interface EstadiaDTO {
  checkIn: string;
  checkOut: string;
}

interface HabitacionDTO {
  numero: number;
  estado: string; 
  precio: number;
  cantidadPersonas: number;
  tipohabitacion: string;
  listareservas?: ReservaDTO[]; 
  listaestadias?: EstadiaDTO[];
}

interface Props {
    ocultarTabla?: boolean;
}

export default function ReservarHabitacion({ ocultarTabla = false }: Props) {

  // =========================
  // ESTADOS
  // =========================
  const [desdeFecha, setDesdeFecha] = useState("");
  const [hastaFecha, setHastaFecha] = useState("");
  const [tipoSeleccionado, setTipoSeleccionado] = useState<"" | TipoHabitacion>("");
  const [erroresFecha, setErroresFecha] = useState({ desdeInvalido: false, hastaInvalido: false, ordenInvalido: false });
  const [fechasValidas, setFechasValidas] = useState(false);
  const [errorSeleccion, setErrorSeleccion] = useState("");
  
  const [seleccionados, setSeleccionados] = useState<string[]>([]);
  const [habitacionesSeleccionadasInfo, setHabitacionesSeleccionadasInfo] = useState<Record<number, HabitacionDTO>>({});
  const [mostrarCartelOH, setMostrarCartelOH] = useState(false);
  const [mostrarCartel, setMostrarCartel] = useState(false);
  
  const [habitaciones, setHabitaciones] = useState<HabitacionDTO[] | []>([]);
  const [rangos, setRangos] = useState<{ numero: number; desde: string; hasta: string }[]>([]);

  const [mostrarCartelLista, setMostrarCartelLista] = useState(false);
  const [listaBackend, setListaBackend] = useState<any[]>([]);
  const router = useRouter();
  //erne
  const [ultimoClick, setUltimoClick] = useState<string | null>(null);
  const [reservas, setReservas] = useState<ReservaDTO[]>([]);
  const [mostrarFormulario, setMostrarFormulario] = useState(false);
  const [nombre, setNombre] = useState("");
  const [apellido, setApellido] = useState("");
  const [telefono, setTelefono] = useState("");
  const [errorNombre, setErrorNombre] = useState(false);
  const [errorApellido, setErrorApellido] = useState(false);
  const [errorTelefono, setErrorTelefono] = useState(false);
  const [errorNombreObligatorio, setErrorNombreObligatorio] = useState(false);
  const [errorApellidoObligatorio, setErrorApellidoObligatorio] = useState(false);
  const [errorTelefonoObligatorio, setErrorTelefonoObligatorio] = useState(false);
  const [mostrarCartelConfirmacion, setMostrarCartelConfirmacion] = useState(false);

  // =========================
  // CONFIGURACI√ìN HABITACIONES
  // =========================
  const TipoHabitacion = {
    IndividualEstandar: "IndividualEstandar" ,
    DobleEstandar: "DobleEstandar",
    SuperiorFamilyPlan: "SuperiorFamilyPlan",
    Suite: "Suite",
    DobleSuperior: "DobleSuperior"
  }

  // =========================
  // VALIDAR FECHAS
  // =========================
  function validarDesde(fecha: string) {
    const result = validarFechasReserva(fecha, hastaFecha);
    setErroresFecha(result);
    setFechasValidas(result.valido);
  }

  function validarHasta(fecha: string) {
    const result = validarFechasReserva(desdeFecha, fecha);
    setErroresFecha(result);
    setFechasValidas(result.valido);
  }


  // =========================
  // FETCH DE DATOS
  // =========================
  // Validaciones de formulario
  useEffect(() => {
    setErrorNombre(nombre !== "" && !esSoloLetras(nombre));
  }, [nombre]);

  useEffect(() => {
    setErrorApellido(apellido !== "" && !esSoloLetras(apellido));
  }, [apellido]);

  useEffect(() => {
    setErrorTelefono(telefono !== "" && (!esSoloNumeros(telefono) || !telefonoValido(telefono)));
  }, [telefono]);

  useEffect(() => {
    const fetchHabitacionesYReservas = async () => {
      if (fechasValidas && tipoSeleccionado) {
        try {
          // Obtener habitaciones por tipo
          const responseHabitaciones = await axios.get(`http://localhost:8080/habitaciones`, {
            params: { 
              tipo: tipoSeleccionado
            },
          });

          // Obtener reservas en el rango de fechas
          const responseReservas = await axios.get(`http://localhost:8080/reservas`, {
            params: {
              desde: desdeFecha,
              hasta: hastaFecha
            },
          });

          const habitacionesData = responseHabitaciones.data || [];
          const reservasData = responseReservas.data || [];

<<<<<<< HEAD
          console.log("Habitaciones recibidas:", habitacionesData);
=======
         console.log("Habitaciones recibidas:", habitacionesData);
>>>>>>> f8acfdea9cff0c2da09ce16d810eda810d104088
          console.log("Reservas recibidas:", reservasData);
          
          // Ver estructura completa de una reserva para debug
          if (reservasData.length > 0) {
            console.log("Estructura completa primera reserva:", JSON.stringify(reservasData[0], null, 2));
            console.log("Todos los campos de la reserva:", Object.keys(reservasData[0]));
            console.log("Valor de habitacion en reserva:", reservasData[0].habitacion);
            console.log("Valor de nro_habitacion en reserva:", reservasData[0].nro_habitacion);
          }

          // Mapear reservas a cada habitaci√≥n
          // El endpoint puede devolver reservas con habitacion.numero, nro_habitacion, o habitacion como objeto
          const habitacionesConReservas = habitacionesData.map((h: any) => {
            const reservasDeEstaHabitacion = reservasData.filter((r: any) => {
              // Verificar todas las posibles formas en que puede venir el n√∫mero de habitaci√≥n
              let numeroReserva = null;
              
              // Caso 1: r.habitacion.numero (objeto habitacion con numero)
              if (r.habitacion && typeof r.habitacion === 'object' && r.habitacion.numero) {
                numeroReserva = r.habitacion.numero;
              }
              // Caso 2: r.nro_habitacion (campo directo)
              else if (r.nro_habitacion !== undefined && r.nro_habitacion !== null) {
                numeroReserva = r.nro_habitacion;
              }
              // Caso 3: r.habitacion es un n√∫mero directamente
              else if (typeof r.habitacion === 'number') {
                numeroReserva = r.habitacion;
              }
              
              const coincide = numeroReserva === h.numero;
              if (coincide) {
                console.log(`‚úì Reserva ${r.id_reserva} (${r.fecha_desde} a ${r.fecha_hasta}, estado: ${r.estado}) asignada a habitaci√≥n ${h.numero}`);
              }
              return coincide;
            });
            
            if (reservasDeEstaHabitacion.length > 0) {
              console.log(`Habitaci√≥n ${h.numero} tiene ${reservasDeEstaHabitacion.length} reserva(s)`);
            }

            return {
              ...h,
              listareservas: reservasDeEstaHabitacion,
              listaestadias: [] // No se usa en este caso de uso
            };
          });

          console.log("Habitaciones con reservas mapeadas:", habitacionesConReservas);
          setHabitaciones(habitacionesConReservas);
          setReservas(reservasData);
        } catch(err) {
          console.error("Error al cargar habitaciones y reservas:", err);
          setHabitaciones([]);
          setReservas([]);
        }
      }
    };

    fetchHabitacionesYReservas();
  }, [fechasValidas, tipoSeleccionado, desdeFecha, hastaFecha]);

  // =========================
  // L√ìGICA DE ESTADOS Y SELECCI√ìN
  // =========================
  const fechasIntervalo = (desdeFecha && hastaFecha && fechasValidas)
    ? eachDayOfInterval({ start: parseISO(desdeFecha), end: parseISO(hastaFecha) })
    : [];

  const fechaEnRango = (fechaTarget: string, inicio: string, fin: string) => {
    return fechaTarget >= inicio && fechaTarget <= fin;
  };

  const toggleSeleccion = (fechaDate: Date, habitacion: HabitacionDTO, event: React.MouseEvent<HTMLTableCellElement>) => {
    const fechaString = format(fechaDate, "yyyy-MM-dd");
    const keyActual = `${fechaString}|${habitacion.numero}`;

    // VALIDACIONES: No permitir seleccionar si est√° fuera de servicio
    // El estado puede venir como "FUERADESERVICIO" o "FUERA_DE_SERVICIO"
    if (habitacion.estado === "FUERADESERVICIO" || habitacion.estado === "FUERA_DE_SERVICIO") {
      setMostrarCartel(true);
      setTimeout(() => setMostrarCartel(false), 2500);
      return;
    }

    // Validar si hay reserva en estado "FINALIZADA" (ocupada)
    const tieneReservaFinalizada = habitacion.listareservas?.some((r: ReservaDTO) => {
      const enRango = fechaEnRango(fechaString, r.fecha_desde, r.fecha_hasta);
      return enRango && r.estado === "FINALIZADA";
    });
    if (tieneReservaFinalizada) {
      setMostrarCartel(true);
      setTimeout(() => setMostrarCartel(false), 2500);
      return;
    }

    // Validar si hay reserva en estado "ENCURSO" o "PENDIENTE" (reservada)
    const tieneReservaEnCurso = habitacion.listareservas?.some((r: ReservaDTO) => {
      const enRango = fechaEnRango(fechaString, r.fecha_desde, r.fecha_hasta);
      return enRango && (r.estado === "ENCURSO" || r.estado === "PENDIENTE");
    });
    if (tieneReservaEnCurso) {
      setMostrarCartel(true);
      setTimeout(() => setMostrarCartel(false), 2500);
      return;
    }

    // =============================================
    // SHIFT + CLICK ‚Äî seleccionar rango de fechas
    // =============================================
    if (event?.shiftKey && ultimoClick) {
      const [fechaPrev, numeroPrev] = ultimoClick.split("|");

      // Solo rango si es la misma habitaci√≥n
      if (Number(numeroPrev) === habitacion.numero) {
        const inicio = parseISO(fechaPrev);
        const fin = parseISO(fechaString);

        const intervalo = eachDayOfInterval({
          start: inicio < fin ? inicio : fin,
          end: inicio < fin ? fin : inicio,
        });

        const claves = intervalo.map((f: Date) =>
          `${format(f, "yyyy-MM-dd")}|${habitacion.numero}`
        );

        setSeleccionados((prev: string[]) => [...new Set([...prev, ...claves])]);
        
        // Guardar informaci√≥n de la habitaci√≥n
        setHabitacionesSeleccionadasInfo((prevInfo) => ({
          ...prevInfo,
          [habitacion.numero]: habitacion
        }));
        
        return;
      }
    }

    // Selecci√≥n simple
    setSeleccionados((prev: string[]) => {
      const estaSeleccionado = prev.includes(keyActual);
      const nuevaSeleccion = estaSeleccionado
        ? prev.filter((item: string) => item !== keyActual)
        : [...prev, keyActual];
      
      // Guardar informaci√≥n de la habitaci√≥n cuando se selecciona
      if (!estaSeleccionado) {
        setHabitacionesSeleccionadasInfo((prevInfo) => ({
          ...prevInfo,
          [habitacion.numero]: habitacion
        }));
      } else {
        // Si se deseleccion√≥, verificar si todav√≠a hay selecciones de esta habitaci√≥n
        const tieneOtrasSelecciones = nuevaSeleccion.some((sel: string) => {
          const [_, numero] = sel.split("|");
          return Number(numero) === habitacion.numero;
        });
        
        if (!tieneOtrasSelecciones) {
          setHabitacionesSeleccionadasInfo((prevInfo) => {
            const nuevaInfo = { ...prevInfo };
            delete nuevaInfo[habitacion.numero];
            return nuevaInfo;
          });
        }
      }
      
      return nuevaSeleccion;
    });

    // guardar √∫ltimo click
    setUltimoClick(keyActual);
  };

  const eliminarSeleccionados = () => {
    setSeleccionados([]);
    setHabitacionesSeleccionadasInfo({});
  };

  const deleteSeleccionado = (ran:{ numero: number; desde: string; hasta: string }) => {
    const fechasABorrar = eachDayOfInterval({
      start: parseISO(ran.desde),
      end: parseISO(ran.hasta)
    }).map((f: Date) => `${format(f,"yyyy-MM-dd")}|${ran.numero}`);

    setSeleccionados((prev: string[]) => {
      const nuevasSelecciones = prev.filter((sel: string) => !fechasABorrar.includes(sel));
      
      // Limpiar el mapa si ya no hay selecciones de esta habitaci√≥n
      const tieneSelecciones = nuevasSelecciones.some((sel: string) => {
        const [_, numero] = sel.split("|");
        return Number(numero) === ran.numero;
      });
      
      if (!tieneSelecciones) {
        setHabitacionesSeleccionadasInfo((prevInfo) => {
          const nuevaInfo = { ...prevInfo };
          delete nuevaInfo[ran.numero];
          return nuevaInfo;
        });
      }
      
      return nuevasSelecciones;
    });
  };

    const construirHabitacionesDTO = (): HabitacionDTO[] => {
      const lista: HabitacionDTO[] = seleccionados.map((sel: string) => {
        const [fecha, numero] = sel.split("|");
        const habitacion = (Array.isArray(habitaciones) ? habitaciones : []).find(h => h.numero === Number(numero));

        return {
          numero: Number(numero),
          estado: habitacion?.estado || "DISPONIBLE",
          precio: habitacion?.precio ?? 0,
          cantidadPersonas: habitacion?.cantidadPersonas ?? 1,
          tipohabitacion: habitacion?.tipohabitacion ?? (tipoSeleccionado as string),
          listareservas: [], 
          listaestadias: []
        };
      });
      return lista;
    };

const listaHabitacionUnica = (): HabitacionDTO[] => {
  const listaUnica: Record<number, HabitacionDTO> = {};

  seleccionados.forEach((sel: string) => {
    const [fecha, numero] = sel.split("|");
    const num = Number(numero);

    if (listaUnica[num]) return;

    // Primero intentar obtener la informaci√≥n guardada cuando se seleccion√≥
    const habitacionGuardada = habitacionesSeleccionadasInfo[num];
    
    // Si no est√° guardada, intentar buscarla en el estado actual de habitaciones
    const habitacion = habitacionGuardada || (Array.isArray(habitaciones) ? habitaciones : [])
      .find(h => h.numero === num);

    listaUnica[num] = {
      numero: num,
      estado: habitacion?.estado || "Disponible",
      precio: habitacion?.precio ?? 0,
      cantidadPersonas: habitacion?.cantidadPersonas ?? 1,
      tipohabitacion: habitacion?.tipohabitacion ?? (tipoSeleccionado as string),

      // Estas claves tienen que coincidir exactamente como las usa el backend
      listareservas: [],
      listaestadias: []
    };
  });

  return Object.values(listaUnica);
};

  function generarRangos(seleccionados: string[]) {
    const datos = seleccionados.map(sel => {
      const [fecha, numero] = sel.split("|");
      return {
        fecha: fecha,
        fechaDate: parseISO(fecha),
        numero: Number(numero)
      };
    });

    datos.sort((a, b) => {
      if (a.numero !== b.numero) return a.numero - b.numero;
      return a.fechaDate.getTime() - b.fechaDate.getTime();
    });

    const resultado: any[] = [];
    let actual = null;

    for (let item of datos) {
      if (!actual) {
        actual = { numero: item.numero, desde: item.fecha, hasta: item.fecha };
        continue;
      }

      const esMismaHab = item.numero === actual.numero;
      const diffDias =
        (item.fechaDate.getTime() - parseISO(actual.hasta).getTime()) /
        (1000 * 60 * 60 * 24);

      if (esMismaHab && diffDias === 1) {
        actual.hasta = item.fecha;
      } else {
        resultado.push(actual);
        actual = { numero: item.numero, desde: item.fecha, hasta: item.fecha };
      }
    }
    if (actual) resultado.push(actual);
    return resultado;
  }

  useEffect(() => {
    const nuevosRangos = generarRangos(seleccionados);
    setRangos(nuevosRangos);
  }, [seleccionados]);



// C√°lculo de fechas reales seg√∫n selecci√≥n
const fechaDesdeSeleccion = rangos.length
  ? rangos.reduce((min: string, r: { numero: number; desde: string; hasta: string }) => r.desde < min ? r.desde : min, rangos[0].desde)
  : desdeFecha;

const fechaHastaSeleccion = rangos.length
  ? rangos.reduce((max: string, r: { numero: number; desde: string; hasta: string }) => r.hasta > max ? r.hasta : max, rangos[0].hasta)
  : hastaFecha;

  // =========================
  // RENDER
  // =========================
  return (
    <main className="flex gap-8 px-8 py-8 items-start bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">

      {/* FORMULARIO DE FECHAS Y TIPO */}
      {!mostrarFormulario && (
      <div className="bg-white rounded-xl shadow-lg p-6 w-80 h-fit sticky top-4">
        <h2 className="text-2xl font-bold text-indigo-950 mb-6 pb-3 border-b-2 border-indigo-200">Filtros de B√∫squeda</h2>
        <form className="flex flex-col space-y-4">
          <div>
            <label className="text-indigo-950 font-semibold mb-2 block text-sm">Desde Fecha:</label>
            <input
              type="date"
              value={desdeFecha}
              onChange={(e: React.ChangeEvent<HTMLInputElement>) => setDesdeFecha(e.target.value)}
              onBlur={(e: React.FocusEvent<HTMLInputElement>) => validarDesde(e.target.value)}
              className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent
                ${(erroresFecha.desdeInvalido || erroresFecha.ordenInvalido || (!desdeFecha && tipoSeleccionado)) 
                  ? "border-red-500 bg-red-50" 
                  : "border-gray-300 hover:border-indigo-400"}`}
            />
            {erroresFecha.desdeInvalido && <span className="text-red-600 text-xs mt-1 block">La fecha no puede ser menor a hoy</span>}
            {erroresFecha.ordenInvalido && <span className="text-red-600 text-xs mt-1 block">La fecha "Desde" no puede ser posterior a "Hasta"</span>}
          </div>

          <div>
            <label className="text-indigo-950 font-semibold mb-2 block text-sm">Hasta Fecha:</label>
            <input
              type="date"
              value={hastaFecha}
              onChange={(e: React.ChangeEvent<HTMLInputElement>) => setHastaFecha(e.target.value)}
              onBlur={(e: React.FocusEvent<HTMLInputElement>) => validarHasta(e.target.value)}
              className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent
                ${(erroresFecha.hastaInvalido || erroresFecha.ordenInvalido || (!hastaFecha && tipoSeleccionado)) 
                  ? "border-red-500 bg-red-50" 
                  : "border-gray-300 hover:border-indigo-400"}`}
            />
            {erroresFecha.hastaInvalido && <span className="text-red-600 text-xs mt-1 block">La fecha no puede ser menor a hoy</span>}
            {erroresFecha.ordenInvalido && <span className="text-red-600 text-xs mt-1 block">La fecha "Hasta" no puede ser anterior a "Desde"</span>}
          </div>

          <div>
            <label className="text-indigo-950 font-semibold mb-2 block text-sm">Tipo de Habitaci√≥n:</label>
            <select
              value={tipoSeleccionado}
              onChange={(e: React.ChangeEvent<HTMLSelectElement>) => setTipoSeleccionado(e.target.value as TipoHabitacion)}
              onFocus={() => {
                setErroresFecha(prev => ({
                  desdeInvalido: prev.desdeInvalido || !desdeFecha,
                  hastaInvalido: prev.hastaInvalido || !hastaFecha,
                  ordenInvalido: prev.ordenInvalido
                }));
              }}
              className={`w-full p-3 border-2 rounded-lg transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent
                ${!fechasValidas 
                  ? "bg-gray-100 cursor-not-allowed text-gray-400 border-gray-300" 
                  : "text-indigo-950 border-gray-300 hover:border-indigo-400 bg-white"}`}
            >
              <option value="" disabled>Seleccionar tipo</option>
              <option value={TipoHabitacion.IndividualEstandar}>Individual Estandar</option>
              <option value={TipoHabitacion.DobleEstandar}>Doble Estandar</option>
              <option value={TipoHabitacion.DobleSuperior}>Doble Superior</option>
              <option value={TipoHabitacion.SuperiorFamilyPlan}>Superior Family Plan</option>
              <option value={TipoHabitacion.Suite}>Suite</option>
            </select>
          </div>
        </form>
      </div>
      )}

      {mostrarCartel && (
        <CartelHabitacionNoDisponible
          mensaje="La habitaci√≥n seleccionada no se encuentra disponible"
          onClose={() => setMostrarCartel(false)}
        />
      )}

      {mostrarCartelLista && (
           <CartelListaHabitaciones
             lista={listaBackend}
             seleccionados={seleccionados}
             desdeFecha={desdeFecha}
             hastaFecha={hastaFecha}
             rangos={rangos}
             onClose={() => {
               setMostrarCartelLista(false);
               setSeleccionados([]);
               setRangos([]);
               setHabitacionesSeleccionadasInfo({});
             }}
             onAceptar={() => {
               setMostrarCartelLista(false);
               setMostrarFormulario(true);
             }}
           />
       )}

      {mostrarCartelConfirmacion && (
        <ReservaConfirmada
          onClose={() => {
            setMostrarCartelConfirmacion(false);
          }}
        />
      )}

       {/* TABLA ESTADO HABITACI√ìN */}
       {!mostrarFormulario && (
       <section className="flex-1">
         {tipoSeleccionado && fechasIntervalo.length > 0 ? (
           
           <>
             <div className="bg-white rounded-xl shadow-xl overflow-hidden">
             <div className="max-h-[600px] overflow-y-auto overflow-x-auto">
             <table className="w-full border-collapse">
              <thead className="bg-gradient-to-r from-indigo-950 to-indigo-900 text-white sticky top-0 z-10 shadow-md">
                <tr>
                  <th className="p-4 font-semibold text-left">Fecha</th>
                  {tipoSeleccionado && (
                    <th colSpan={habitaciones.length} className="p-4 font-semibold text-center">Habitaciones</th>
                  )}
                </tr>
              </thead>

              <tbody>
                <tr className="bg-indigo-50">
                  <td className="p-3 border-b-2 border-indigo-200 font-semibold text-indigo-950"></td>
                  {tipoSeleccionado && habitaciones.map(hab => (
                    <td key={hab?.numero} className="p-3 border-b-2 border-indigo-200 text-center font-bold text-indigo-950">{hab?.numero}</td>
                  ))}
                </tr>

                {fechasIntervalo.map((fechaDate: Date) => {
                  const fechaString = format(fechaDate,"yyyy-MM-dd");
                  const fechaDisplay = format(fechaDate,"dd/MM/yyyy");

                  return (
                    <tr key={fechaString} className="hover:bg-indigo-50/50 transition-colors">
                      <td className="p-3 border-b border-gray-200 text-center font-semibold text-indigo-950 bg-white sticky left-0 z-5">{fechaDisplay}</td>
                      {tipoSeleccionado && habitaciones.map((hab: HabitacionDTO) => {
                        
                        const key = `${fechaString}|${hab?.numero}`;
                        const esSeleccionado = seleccionados.includes(key);

                        // 1. CHEQUEO FUERA DE SERVICIO
                        // El estado puede venir como "FUERADESERVICIO" o "FUERA_DE_SERVICIO"
                        const esFueraServicio = hab.estado === "FUERADESERVICIO" || hab.estado === "FUERA_DE_SERVICIO";

                        // 2. CHEQUEO RESERVA FINALIZADA (OCUPADA - ROJA)
                        const esOcupada = !esFueraServicio && hab.listareservas?.some((reserva: ReservaDTO) => {
                          const enRango = fechaEnRango(fechaString, reserva.fecha_desde, reserva.fecha_hasta);
                          return enRango && reserva.estado === "FINALIZADA";
                        });

                        // 3. CHEQUEO RESERVA EN CURSO/PENDIENTE (RESERVADA - AMARILLO CLARO)
                        const esReservada = !esFueraServicio && !esOcupada && hab.listareservas?.some((reserva: ReservaDTO) => {
                          const enRango = fechaEnRango(fechaString, reserva.fecha_desde, reserva.fecha_hasta);
                          return enRango && (reserva.estado === "ENCURSO" || reserva.estado === "PENDIENTE");
                        });
                        
                        // Debug: solo para la primera celda de la primera habitaci√≥n
                        if (hab.numero === habitaciones[0]?.numero && fechaString === fechasIntervalo[0]?.toISOString().split('T')[0]) {
                          console.log(`Debug celda - Hab: ${hab.numero}, Fecha: ${fechaString}`);
                          console.log(`  Estado habitaci√≥n: ${hab.estado}`);
                          console.log(`  Reservas de esta habitaci√≥n:`, hab.listareservas);
                          console.log(`  esFueraServicio: ${esFueraServicio}`);
                          console.log(`  esOcupada: ${esOcupada}`);
                          console.log(`  esReservada: ${esReservada}`);
                          console.log(`  esSeleccionado: ${esSeleccionado}`);
                        }
                        
                         let bgClass = ""; // Color claro para disponible (se aplica por CSS de la tabla) 
                         if (esFueraServicio) {
                             bgClass = "bg-gray-700"; // Gris para fuera de servicio
                         } else if (esOcupada) {
                             bgClass = "bg-red-500"; // Roja para ocupada (Finalizada)
                         } else if (esReservada) {
                             bgClass = "bg-yellow-200"; // Amarillo claro para reservada de BD (EN CURSO/Pendiente)
                         } else if (esSeleccionado) {
                             bgClass = "bg-yellow-500"; // Amarillo oscuro cuando el usuario selecciona
                         }

                        return (
                          <td
                            key={hab.numero}
                            className={`p-4 border-b border-gray-200 cursor-pointer transition-all hover:scale-105 hover:shadow-md ${bgClass}`}
                            onClick={(e: React.MouseEvent<HTMLTableCellElement>) => toggleSeleccion(fechaDate, hab, e)}
                            title={esFueraServicio ? "Fuera de servicio" : esOcupada ? "Ocupada" : esReservada ? "Reservada" : esSeleccionado ? "Seleccionada" : "Disponible"}
                          ></td>
                        );
                      })}
                    </tr>
                  );
                })}
              </tbody>
            </table>
            </div>
            </div>

             {/* LEYENDA */}
             <div className="bg-white rounded-xl shadow-lg p-4 mt-6">
               <h3 className="text-lg font-semibold text-indigo-950 mb-3 text-center">Leyenda</h3>
               <ul className="flex items-center gap-4 flex-wrap justify-center">
                 <li className="flex items-center gap-2">
                   <span className="w-5 h-5 rounded-full bg-yellow-200 border-2 border-yellow-300 shadow-sm"></span>
                   <span className="text-sm font-medium text-gray-700">RESERVADA</span>
                 </li>
                 <li className="flex items-center gap-2">
                   <span className="w-5 h-5 rounded-full bg-yellow-500 border-2 border-yellow-600 shadow-sm"></span>
                   <span className="text-sm font-medium text-gray-700">SELECCIONADA</span>
                 </li>
                 <li className="flex items-center gap-2">
                   <span className="w-5 h-5 rounded-full border-2 border-gray-300 shadow-sm" style={{backgroundColor: 'aliceblue'}}></span>
                   <span className="text-sm font-medium text-gray-700">DISPONIBLE</span>
                 </li>
                 <li className="flex items-center gap-2">
                   <span className="w-5 h-5 rounded-full bg-gray-700 border-2 border-gray-800 shadow-sm"></span>
                   <span className="text-sm font-medium text-gray-700">FUERA DE SERVICIO</span>
                 </li>
                 <li className="flex items-center gap-2">
                   <span className="w-5 h-5 rounded-full bg-red-500 border-2 border-red-600 shadow-sm"></span>
                   <span className="text-sm font-medium text-gray-700">OCUPADA</span>
                 </li>
               </ul>
             </div>

             {errorSeleccion && (
                 <div className="bg-red-50 border-l-4 border-red-500 text-red-700 p-4 rounded-lg mt-4 shadow-md">
                   <p className="font-semibold">{errorSeleccion}</p>
                 </div>
               )}
         
             <div className="flex justify-center gap-4 mt-6">
             <Link href="/menu">
               <button className="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all shadow-md hover:shadow-lg font-semibold">
                 Cancelar
               </button>
             </Link>

             <button
               className="px-6 py-3 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105"
                onClick={async () => {
                if (seleccionados.length === 0) {
                  setErrorSeleccion("Debes seleccionar al menos una habitaci√≥n.");
                  setTimeout(() => setErrorSeleccion(""), 2000);
                  return;
                }

                // Generar lista con formato del caso de uso
                const listaHab = listaHabitacionUnica();
                const listaFormateada = rangos.map((rango: { numero: number; desde: string; hasta: string }) => {
                  const hab = listaHab.find(h => h.numero === rango.numero);
                  return {
                    numero: rango.numero,
                    tipo: hab?.tipohabitacion || tipoSeleccionado,
                    desde: rango.desde,
                    hasta: rango.hasta
                  };
                });

                setListaBackend(listaFormateada);
                setMostrarCartelLista(true);
              }}
              > Aceptar
            </button>
            
          </div>

            {mostrarCartelOH && <OcuparHabitacionIgualmente onClose={() => setMostrarCartelOH(false)} />}
          </>
        ): (
             <div className="bg-white rounded-xl shadow-lg p-12 text-center">
               <div className="text-gray-400 text-lg mb-2">
                 üìÖ Seleccione un rango de fechas y tipo para ver la disponibilidad
               </div>
               <p className="text-sm text-gray-500">Complete los filtros en el panel lateral para comenzar</p>
             </div>
         )}
       </section>
       )}

       {/* FORMULARIO DE DATOS DEL HU√âSPED */}
       {mostrarFormulario && (
         <section className="flex-1 w-full flex justify-center">
          <div className="w-full max-w-2xl p-8 border-2 border-indigo-200 rounded-xl bg-white shadow-2xl">
            <div className="mb-6 pb-4 border-b-2 border-indigo-200">
              <h3 className="text-2xl font-bold text-indigo-950">
                Reserva a nombre de:
              </h3>
              <p className="text-sm text-gray-600 mt-1">Complete los datos del hu√©sped para confirmar la reserva</p>
            </div>
            <form onSubmit={async (e) => {
              e.preventDefault();

              // Validar campos obligatorios
              setErrorNombreObligatorio(!esObligatorio(nombre));
              setErrorApellidoObligatorio(!esObligatorio(apellido));
              setErrorTelefonoObligatorio(!esObligatorio(telefono));

              if (!esObligatorio(nombre) || !esObligatorio(apellido) || !esObligatorio(telefono)) {
                return;
              }

              if (errorNombre || errorApellido || errorTelefono) {
                return;
              }

              // Crear lista de reservas DTO seg√∫n formato esperado por el backend
              const listaReservasDTO = rangos.map((rango: { numero: number; desde: string; hasta: string }) => ({
                fecha_desde: rango.desde,
                fecha_hasta: rango.hasta,
                nombre: nombre,
                apellido: apellido,
                telefono: telefono,
                habitacion: {
                  numero: rango.numero
                }
              }));

              // Imprimir en consola lo que se env√≠a
              console.log("=== DTO ENVIADO A LA BASE DE DATOS ===");
              console.log(JSON.stringify(listaReservasDTO, null, 2));
              console.log("======================================");

              try {
                const response = await axios.post("http://localhost:8080/reservas", listaReservasDTO, {
                  headers: {
                    "Content-Type": "application/json",
                  },
                });

                if (response.status === 200 || response.status === 201) {
                  setMostrarFormulario(false);
                  setMostrarCartelConfirmacion(true);
                  setSeleccionados([]);
                  setRangos([]);
                  setHabitacionesSeleccionadasInfo({});
                  setNombre("");
                  setApellido("");
                  setTelefono("");
                  // Recargar datos
                  const fetchHabitacionesYReservas = async () => {
                    if (fechasValidas && tipoSeleccionado) {
                      try {
                        const responseHabitaciones = await axios.get(`http://localhost:8080/habitaciones`, {
                          params: { tipo: tipoSeleccionado },
                        });
                        const responseReservas = await axios.get(`http://localhost:8080/reservas`, {
                          params: { desde: desdeFecha, hasta: hastaFecha },
                        });
                        const habitacionesData = responseHabitaciones.data || [];
                        const reservasData = responseReservas.data || [];
                        const habitacionesConReservas = habitacionesData.map((h: any) => {
                          const reservasDeEstaHabitacion = reservasData.filter((r: ReservaDTO) => 
                            r.habitacion?.numero === h.numero
                          );
                          return {
                            ...h,
                            listareservas: reservasDeEstaHabitacion,
                            listaestadias: []
                          };
                        });
                        setHabitaciones(habitacionesConReservas);
                        setReservas(reservasData);
                      } catch(err) {
                        console.error("Error al recargar datos:", err);
                      }
                    }
                  };
                  fetchHabitacionesYReservas();
                }
              } catch (err) {
                console.error("Error al registrar reservas:", err);
                alert("Hubo un error al registrar las reservas.");
              }
            }}>
              <div className="space-y-5">
                <div>
                  <label className="text-indigo-950 font-semibold mb-2 block text-sm">Apellido:</label>
                  <input
                    type="text"
                    value={apellido}
                    onChange={(e: React.ChangeEvent<HTMLInputElement>) => {
                      const valor = e.target.value.toUpperCase();
                      setApellido(valor);
                      setErrorApellidoObligatorio(false);
                    }}
                    onKeyDown={(e: React.KeyboardEvent<HTMLInputElement>) => {
                      if (e.key === "Tab" && e.shiftKey) {
                        e.preventDefault();
                        const inputs = e.currentTarget.form?.querySelectorAll("input");
                        if (inputs) {
                          const index = Array.from(inputs).indexOf(e.currentTarget as HTMLInputElement);
                          if (index > 0) {
                            (inputs[index - 1] as HTMLInputElement).focus();
                          }
                        }
                      }
                    }}
                    className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                      errorApellido || errorApellidoObligatorio 
                        ? "border-red-500 bg-red-50" 
                        : "border-gray-300 hover:border-indigo-400"
                    }`}
                    autoFocus
                    placeholder="Ingrese el apellido"
                  />
                  {errorApellido && (
                    <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                      <span>‚ö†</span> Ingrese solo letras.
                    </p>
                  )}
                  {errorApellidoObligatorio && (
                    <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                      <span>‚ö†</span> El apellido es obligatorio.
                    </p>
                  )}
                </div>

                <div>
                  <label className="text-indigo-950 font-semibold mb-2 block text-sm">Nombre:</label>
                  <input
                    type="text"
                    value={nombre}
                    onChange={(e: React.ChangeEvent<HTMLInputElement>) => {
                      const valor = e.target.value.toUpperCase();
                      setNombre(valor);
                      setErrorNombreObligatorio(false);
                    }}
                    onKeyDown={(e: React.KeyboardEvent<HTMLInputElement>) => {
                      if (e.key === "Tab" && e.shiftKey) {
                        e.preventDefault();
                        const inputs = e.currentTarget.form?.querySelectorAll("input");
                        if (inputs) {
                          const index = Array.from(inputs).indexOf(e.currentTarget as HTMLInputElement);
                          if (index > 0) {
                            (inputs[index - 1] as HTMLInputElement).focus();
                          }
                        }
                      }
                    }}
                    className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                      errorNombre || errorNombreObligatorio 
                        ? "border-red-500 bg-red-50" 
                        : "border-gray-300 hover:border-indigo-400"
                    }`}
                    placeholder="Ingrese el nombre"
                  />
                  {errorNombre && (
                    <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                      <span>‚ö†</span> Ingrese solo letras.
                    </p>
                  )}
                  {errorNombreObligatorio && (
                    <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                      <span>‚ö†</span> El nombre es obligatorio.
                    </p>
                  )}
                </div>

                <div>
                  <label className="text-indigo-950 font-semibold mb-2 block text-sm">Tel√©fono:</label>
                  <input
                    type="text"
                    value={telefono}
                    onChange={(e: React.ChangeEvent<HTMLInputElement>) => {
                      const valor = e.target.value.toUpperCase();
                      setTelefono(valor);
                      setErrorTelefonoObligatorio(false);
                    }}
                    onKeyDown={(e: React.KeyboardEvent<HTMLInputElement>) => {
                      if (e.key === "Tab" && e.shiftKey) {
                        e.preventDefault();
                        const inputs = e.currentTarget.form?.querySelectorAll("input");
                        if (inputs) {
                          const index = Array.from(inputs).indexOf(e.currentTarget as HTMLInputElement);
                          if (index > 0) {
                            (inputs[index - 1] as HTMLInputElement).focus();
                          }
                        }
                      }
                    }}
                    className={`w-full p-3 border-2 rounded-lg text-indigo-950 transition-all focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent ${
                      errorTelefono || errorTelefonoObligatorio 
                        ? "border-red-500 bg-red-50" 
                        : "border-gray-300 hover:border-indigo-400"
                    }`}
                    placeholder="Ingrese el tel√©fono"
                  />
                  {errorTelefono && (
                    <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                      <span>‚ö†</span> Ingrese un tel√©fono v√°lido.
                    </p>
                  )}
                  {errorTelefonoObligatorio && (
                    <p className="text-red-600 text-xs mt-1 flex items-center gap-1">
                      <span>‚ö†</span> El tel√©fono es obligatorio.
                    </p>
                  )}
                </div>

                <div className="flex justify-center gap-4 mt-8 pt-4 border-t border-gray-200">
                  <button
                    type="button"
                    onClick={() => {
                      setMostrarFormulario(false);
                      setSeleccionados([]);
                      setRangos([]);
                      setHabitacionesSeleccionadasInfo({});
                    }}
                    className="px-6 py-3 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-all shadow-md hover:shadow-lg font-semibold"
                  >
                    Cancelar
                  </button>
                  <button
                    type="submit"
                    className="px-6 py-3 bg-gradient-to-r from-indigo-950 to-indigo-900 text-white rounded-lg hover:from-indigo-900 hover:to-indigo-800 transition-all shadow-md hover:shadow-lg font-semibold transform hover:scale-105"
                  >
                    Confirmar Reserva
                  </button>
                </div>
              </div>
             </form>
           </div>
         </section>
       )}

       {/* TABLA DERECHA */}
       {!ocultarTabla && !mostrarFormulario && seleccionados.length > 0 && (
        <section className="flex-1 bg-white rounded-xl shadow-xl p-6 h-fit sticky top-4">
          <div className="mb-4 pb-3 border-b-2 border-indigo-200">
            <h2 className="text-xl font-bold text-indigo-950">
              Habitaciones Seleccionadas
            </h2>
            <p className="text-sm text-gray-600 mt-1">{seleccionados.length} d√≠a(s) seleccionado(s)</p>
          </div>
          <div className="overflow-x-auto">
            <table className="w-full border-collapse">
              <thead className="bg-gradient-to-r from-indigo-950 to-indigo-900 text-white">
                <tr>
                  <th className="p-3 text-left font-semibold">Eliminar</th>
                  <th className="p-3 text-center font-semibold">Habitaci√≥n</th>
                  <th className="p-3 text-center font-semibold">Fecha Desde</th>
                  <th className="p-3 text-center font-semibold">Fecha Hasta</th>
                </tr>
              </thead>
              <tbody>
                {rangos.map((ran: { numero: number; desde: string; hasta: string }, index: number) => {
                  const fechaDesde = format(parseISO(ran.desde),"dd/MM/yyyy");
                  const fechaHasta = format(parseISO(ran.hasta),"dd/MM/yyyy");
                  return (
                    <tr key={index} className="bg-white hover:bg-indigo-50 transition-colors border-b border-gray-200">
                      <td className="p-3 text-center">
                        <button
                          onClick={() => deleteSeleccionado(ran)} 
                          className="p-2 rounded-lg hover:bg-red-100 transition-all text-red-600 hover:text-red-700"
                          title="Eliminar esta selecci√≥n"
                        >
                          <FontAwesomeIcon icon={faTrashCan} />
                        </button>
                      </td>
                      <td className="p-3 text-center font-semibold text-indigo-950">{ran.numero}</td>
                      <td className="p-3 text-center text-gray-700">{fechaDesde}</td>
                      <td className="p-3 text-center text-gray-700">{fechaHasta}</td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>

          <button
            onClick={eliminarSeleccionados}
            className="w-full mt-6 px-4 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-all shadow-md hover:shadow-lg font-semibold"
          >
            Eliminar Todas
          </button>
        </section>
      )}

    </main>
  );
}
//[tabla/page.tsx]
import { useState } from "react";


export type TipoHuesped = {
    id: number;
    nombre: string;
    apellido: string;
    //dni: string;
    //tipoDocumento: string;
    fechaNacimiento: string;
    nacionalidad: string;
    ocupacion: string;
    email: string;
    telefono: string;

    direccionHuesped: {
        calle: string;
        numero: number;
        piso: number | null;
        departamento: string | null;
        codigoPostal: number;
        localidad: string;
        provincia: string;
        pais: string;
    };

    cuit: string;
    posicionIva: string;
    huespedID:{
        tipoDocumento: string;
        dni: string;
    };
};

type TablaProps = {
    huespedes: TipoHuesped[];
    setSeleccionado: (huesped: TipoHuesped) => void;
};
type SortKey = keyof TipoHuesped | "dni" | "tipoDocumento";

export default function Tabla({huespedes, setSeleccionado}: TablaProps) {

    const [sortConfig, setSortConfig] = useState<{ key: SortKey | null; direction: 'asc' | 'desc' }>({
        key: "apellido",
        direction: 'asc'
    });

    const sortedHuespedes = [...huespedes].sort((a, b) => {
        if (!sortConfig.key) return 0;

        const key = sortConfig.key;

        let aValue: any = a;
        let bValue: any = b;

        // soportar campos anidados (h.huespedID.dni y h.huespedID.tipoDocumento)
        if (key === "dni") {
            aValue = a.huespedID.dni;
            bValue = b.huespedID.dni;
        } else if (key === "tipoDocumento") {
            aValue = a.huespedID.tipoDocumento;
            bValue = b.huespedID.tipoDocumento;
        } else {
            aValue = a[key];
            bValue = b[key];
        }

        if (aValue < bValue) return sortConfig.direction === "asc" ? -1 : 1;
        if (aValue > bValue) return sortConfig.direction === "asc" ? 1 : -1;
        return 0;
    });

    const handleSort = (key: keyof TipoHuesped | 'dni' | 'tipoDocumento') => {
        let direction: 'asc' | 'desc' = 'asc';

        if (sortConfig.key === key && sortConfig.direction === 'asc') {
            direction = 'desc';
        }

        setSortConfig({ key, direction });
    };



    return (
        <section className="flex-1 overflow-y-auto max-h-[400px]">
            <table className="w-full border-collapse border shadow-lg">
                <thead className="bg-indigo-950 text-white sticky top-0 ">
                    <tr>
                        <th className="p-3 border ">Seleccionar</th>
                        <th className="p-3 border" onClick={() => handleSort("apellido")}>Apellido ‚Üë‚Üì</th>
                        <th className="p-3 border" onClick={() => handleSort("nombre")}>Nombre ‚Üë‚Üì</th>
                        <th className="p-3 border" onClick={() => handleSort("tipoDocumento")}>Tipo de Documento ‚Üë‚Üì</th>
                        <th className="p-3 border" onClick={() => handleSort("dni")}>N√∫mero de Documento ‚Üë‚Üì</th>
                    </tr>
                </thead>
                <tbody> 
                    {sortedHuespedes.map((h) => (
                        <tr key={h.huespedID.tipoDocumento + h.huespedID.dni} className="bg-white hover:bg-indigo-100">
                        <td className="p-2 border text-center">
                            <input onClick={() => setSeleccionado(h)} type="radio" name="seleccion" />
                        </td>
                        <td className="p-2 border">{h.apellido}</td>
                        <td className="p-2 border">{h.nombre}</td>
                        <td className="p-2 border">{h.huespedID.tipoDocumento}</td>
                        <td className="p-2 border">{h.huespedID.dni}</td>
                        </tr>
                    ))}
                </tbody>
            </table>
        </section>
    );
}
//[validaciones/validaciones.ts]
// app/validaciones/validaciones.ts

import { parseISO, isAfter } from "date-fns";

//FUNCIONES GENERALES:

export const esSoloLetras = (valor: string) =>
  /^[A-Z√Å√â√ç√ì√ö√ë\s]*$/i.test(valor);

export const esSoloNumeros = (valor: string) =>
  /^[0-9]+$/.test(valor);

export const esEmailValido = (valor: string) =>
  /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(valor);

export const validarDNI = (valor: string) =>
  /^\d{8}$/.test(valor);

export const validarCUIT = (valor: string) => {
  // Permitir: 11 d√≠gitos o el formato XX-XXXXXXXX-X
  const regex = /^(\d{2}-?\d{8}-?\d{1})$/;

  return regex.test(valor);
};

export const esObligatorio = (valor: any) => {
  if (valor === null || valor === undefined) return false;
  if (typeof valor === "string") return valor.trim() !== "";
  return true; // para n√∫meros, fechas o cualquier otro tipo v√°lido
};

export const telefonoValido = (valor: string) => {
  return /^\d{6,15}$/.test(valor);
};;

//DAR ALTA HUESPED
export const validarFormularioHuesped = (formData: any) => {
  const camposRequeridos = [
    "apellido", "nombre", "tipoDocumento", "dni",
    "posicionIva", "calle", "numero",
    "codigoPostal", "localidad", "provincia", "pais",
    "fechaNacimiento", "telefono", "ocupacion", "nacionalidad"
  ];

  if (formData.posicionIva === "RESPONSABLE INSCRIPTO" && formData.cuit.trim() === "") {
    camposRequeridos.push("cuit");
  }

  const errores = camposRequeridos.filter(campo => !esObligatorio(formData[campo]));


  const erroresTipo: string[] = [];

  const camposSoloLetras = [
    "nombre", "apellido", "ocupacion", "nacionalidad",
    "provincia", "localidad", "pais", "calle", "departamento", "posicionIva"
  ];
  const camposSoloNumeros = [
    "dni", "numero", "piso", "codigoPostal", "telefono"
  ];

  for (const campo in formData) {
    const valor = formData[campo];


    if (camposSoloLetras.includes(campo) && valor && !esSoloLetras(valor)) {
      erroresTipo.push(campo);
    } 
    else if (camposSoloNumeros.includes(campo) && valor && !esSoloNumeros(valor)) {
      erroresTipo.push(campo);
    } 
    else if (campo === "email" && valor && !esEmailValido(valor)) {
      erroresTipo.push(campo);
    } 
    else if (campo === "fechaNacimiento" && valor) {
      const hoy = new Date();
      const fecha = new Date(valor);
      if (fecha > hoy) {
        erroresTipo.push(campo);
      }
    }

    if (campo === "dni" && valor){

       validarDNI(valor);
       if(!validarDNI(valor)){
        erroresTipo.push(campo); 
        } 
    }

    if(campo === "cuit" && valor){
        validarCUIT(valor);
        if(!validarCUIT(valor)){
            erroresTipo.push(campo);
        }
    }

    if (campo === "telefono" && valor && !telefonoValido(valor)) {
      erroresTipo.push(campo);
    }

  }

  return { errores, erroresTipo };
};




//RESERVAS
export const validarFechasReserva = (desde: string, hasta: string) => {
  const hoy = new Date();
  hoy.setHours(0, 0, 0, 0);

  const d = desde ? parseISO(desde) : null;
  const h = hasta ? parseISO(hasta) : null;

  const errores = {
    desdeInvalido: false,
    hastaInvalido: false,
    ordenInvalido: false,
    valido: false
  };

  if (d && d < hoy) errores.desdeInvalido = true;
  if (h && h < hoy) errores.hastaInvalido = true;
  if (d && h && isAfter(d, h)) errores.ordenInvalido = true;

  const valido =
    !!desde &&
    !!hasta &&
    !errores.desdeInvalido &&
    !errores.hastaInvalido &&
    !errores.ordenInvalido;

  return { ...errores, valido };
};
