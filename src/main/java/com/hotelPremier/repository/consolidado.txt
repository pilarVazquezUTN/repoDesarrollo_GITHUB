//[DireccionRepository.java]
package com.hotelPremier.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import com.hotelPremier.classes.Dominio.Direccion;

@Repository
public interface DireccionRepository extends JpaRepository<Direccion,Integer> {

    @Override
    Direccion save(Direccion direccion);
}
//[EstadiaRepository.java]
package com.hotelPremier.repository;

import com.hotelPremier.classes.Dominio.Estadia;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface EstadiaRepository extends JpaRepository<Estadia, Integer> {

    @Query("""
        SELECT e
        FROM Estadia e
        WHERE e.listafactura IS EMPTY
    """)
    List<Estadia> estadiasSinFactura();

    @Query("""
        SELECT e 
        FROM Estadia e
        WHERE e.habitacion.numero = :numero
        AND e.estado = 'ENCURSO'
    """)
    Estadia estadiaEnCurso(Integer numero);

}
//[FacturaRepository.java]
package com.hotelPremier.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import com.hotelPremier.classes.Dominio.Factura;
import java.util.List;



@Repository
public interface FacturaRepository extends JpaRepository<Factura,Integer> {
    @Query("""
        SELECT f
        FROM Factura f
        WHERE TYPE(f.responsablepago) = PersonaFisica
          AND f.responsablepago.huesped.huespedID.dni = :dni
    """)
    List<Factura> buscarPorDni(@Param("dni") String dni);


    
    
}
//[HabitacionRepository.java]
package com.hotelPremier.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import com.hotelPremier.classes.Dominio.Habitacion;

import java.sql.Date;
import java.util.List;

@Repository
public interface HabitacionRepository extends JpaRepository<Habitacion,Integer> {

    List<Habitacion> findAll();
   // List<Habitacion> findByTipo(String tipo);
    
   @Query("""
        SELECT h 
        FROM Habitacion h 
        WHERE h.tipohabitacion = :tipoHabitacion             
    """) 
   List<Habitacion> buscarPorTipoHabitacion(@Param("tipoHabitacion")    String tipoHabitacion);


   @Query(""" 
        SELECT h, r, e
        FROM Habitacion h
            LEFT JOIN Reserva r 
                WITH r.fecha_desde <= :fechaHasta 
                AND r.fecha_hasta >= :fechaDesde
            LEFT JOIN Estadia e 
                WITH e.checkin <= :fechaHasta 
                AND e.checkout >= :fechaDesde
        WHERE h.tipohabitacion = :tipoHabitacion
    """)
    List<Habitacion> buscarListaHabitaciones(
        @Param("tipoHabitacion") String tipoHabitacion,
        @Param("fechaDesde") Date fechaDesde,
        @Param("fechaHasta") Date fechaHasta
    );

    Habitacion findByNumero(Integer numero);

}
//[HuespedRepository.java]
package com.hotelPremier.repository;

import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import com.hotelPremier.classes.Dominio.Huesped;
import com.hotelPremier.classes.Dominio.HuespedID;

@Repository
public interface HuespedRepository extends JpaRepository<Huesped,HuespedID>{

    @Override
    List<Huesped> findAll();
    List<Huesped> findByHuespedID_Dni(String dni);
    //HuespedDTO addHuesped(HuespedDTO huespedDTO);  
    Huesped save(Huesped huesped);
    //void save(Direccion direccion); ------> VA EN REPOSITORY DIRECCION.

    /* QUERY PARA BUSQUEDA POR: EMPIEZA CON
    
            @Query("""
            SELECT h
            FROM Huesped h
            WHERE (:dni IS NULL OR h.huespedID.dni = :dni)
                AND (:nombre IS NULL OR CAST(h.nombre AS string) ILIKE CONCAT(:nombre, '%'))
                AND (:apellido IS NULL OR CAST(h.apellido AS string) ILIKE CONCAT(:apellido, '%'))
                AND (:tipoDocumento IS NULL OR h.huespedID.tipoDocumento = :tipoDocumento)
            """)
    */
    @Query("""
    SELECT h 
    FROM Huesped h
    WHERE 
        (:dni IS NULL OR :dni = '' OR h.huespedID.dni ILIKE CONCAT(:dni, '%'))
    AND (:nombre IS NULL OR :nombre = '' OR h.nombre ILIKE CONCAT(:nombre, '%'))
    AND (:apellido IS NULL OR :apellido = '' OR h.apellido ILIKE CONCAT(:apellido, '%'))
    AND (:tipoDocumento IS NULL OR :tipoDocumento = '' OR h.huespedID.tipoDocumento = :tipoDocumento)
""")
List<Huesped> buscarHuespedes(
    @Param("dni") String dni, 
    @Param("nombre") String nombre, 
    @Param("apellido") String apellido, 
    @Param("tipoDocumento") String tipoDocumento
);

}
//[NotaDeCreditoRepository.java]
package com.hotelPremier.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import com.hotelPremier.classes.Dominio.NotaDeCredito;


@Repository
public interface NotaDeCreditoRepository extends JpaRepository<NotaDeCredito,Integer> {


    
}
//[PagoRepository.java]
package com.hotelPremier.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import com.hotelPremier.classes.Dominio.Pago;

@Repository
public interface PagoRepository extends JpaRepository<Pago, Integer> {
}
//[ReservaRepository.java]
package com.hotelPremier.repository;

import com.hotelPremier.classes.Dominio.Reserva;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.Date;
import java.util.List;

@Repository
public interface ReservaRepository extends JpaRepository<Reserva, Integer> {

    // =============================
    // BUSCAR ENTRE FECHAS
    // =============================
    @Query("""
        SELECT r FROM Reserva r
        WHERE r.fecha_desde <= :hasta
          AND r.fecha_hasta >= :desde
    """)
    List<Reserva> buscarEntreFechas(
            @Param("desde") Date desde,
            @Param("hasta") Date hasta
    );

    // =============================
    // BUSCAR POR APELLIDO / NOMBRE
    // =============================
    List<Reserva> findByApellidoStartingWithIgnoreCase(String apellido);

    List<Reserva> findByNombreStartingWithIgnoreCase(String nombre);

    List<Reserva> findByApellidoStartingWithIgnoreCaseAndNombreStartingWithIgnoreCase(
            String apellido,
            String nombre
    );

    // =============================
    // VALIDAR SOLAPAMIENTO
    // =============================
    @Query("""
        SELECT COUNT(r) FROM Reserva r
        WHERE r.habitacion.numero = :numero
          AND r.fecha_desde <= :hasta
          AND r.fecha_hasta >= :desde
    """)
    Integer haySuperposicion(
            @Param("numero") Integer numero,
            @Param("desde") Date desde,
            @Param("hasta") Date hasta
    );
}
//[ResponsablePagoRepository.java]
package com.hotelPremier.repository;



import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.stereotype.Repository;

import com.hotelPremier.classes.Dominio.responsablePago.*;

@Repository
public interface ResponsablePagoRepository extends JpaRepository<ResponsablePago, Integer> {}
//[ServicioExtraRepository.java]
package com.hotelPremier.repository;

import com.hotelPremier.classes.Dominio.servicioExtra.ServicioExtra;
import com.hotelPremier.classes.Dominio.servicioExtra.ServicioExtraID;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.data.repository.query.Param;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public interface ServicioExtraRepository extends JpaRepository<ServicioExtra, ServicioExtraID> {

    @Query("SELECT s FROM ServicioExtra s WHERE s.servicioExtraID.id_estadia = :idEstadia")
    List<ServicioExtra> findByEstadiaId(@Param("idEstadia") Integer idEstadia);

    @Query("SELECT s FROM ServicioExtra s WHERE s.servicioExtraID.id_estadia = :idEstadia AND s.servicioExtraID.id_servicio IN :ids")
    List<ServicioExtra> findByEstadiaIdAndServicioIds(@Param("idEstadia") Integer idEstadia, @Param("ids") List<Integer> ids);
}

//[UsuarioRepository.java]
package com.hotelPremier.repository;

import java.util.*;

import org.springframework.data.repository.CrudRepository;
import org.springframework.stereotype.Repository;

import com.hotelPremier.classes.Dominio.Usuario;

@Repository
public interface UsuarioRepository extends CrudRepository<Usuario,String>{
    @Override
    List<Usuario> findAll();
    List<Usuario> findBynombre(String nombre);
   // List<Usuario> buscarUsuario(UsuarioDTO usuarioDTO);
    //Set<Usuario> usuarioEncontrado();
}
